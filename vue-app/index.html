<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emmy VASSE - Soins naturels pour vos animaux</title>
    <link rel="manifest" href="manifest.json">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/logo_emmy.png">
    <link rel="apple-touch-icon" href="images/logo_emmy.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=19.7">
    
    <!-- OneSignal -->
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" defer></script>
    <script>
        window.OneSignal = window.OneSignal || [];
        // On n'initialise pas OneSignal imm√©diatement, on attend la v√©rification du statut admin
    </script>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Firebase Functions -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <!-- Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
</head>
<body>
    <div id="app">
        <header class="header">
            <nav class="nav-container">
                <a href="#" class="logo" @click.prevent="navigateTo('home')">
                    <img src="images/logo_emmy.png" alt="Logo Emmy" style="height: 50px; margin-right: 10px;">
                    Emmy Vasse
                </a>
                <div class="hamburger" @click="toggleMenu" :class="{ active: isMenuOpen }">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="nav-links" :class="{ active: isMenuOpen, 'tutorial-padding': showTutorial && isMobile }">
                    <div class="close-menu-btn" @click="closeMenu" v-if="isMenuOpen">
                        <span>&times;</span>
                    </div>
                    
                    <!-- Navigation principale -->
                    <div class="nav-section">
                    <a href="#" @click.prevent="navigateToSection('about'); closeMenu()">√Ä propos</a>
                    <a href="#" @click.prevent="navigateToSection('services'); closeMenu()">Outils th√©rapeutiques</a>
                    <a href="#" @click.prevent="navigateToSection('blog'); closeMenu()">√âvenement</a>
                    <a href="#" @click.prevent="navigateToSection('contact'); closeMenu()">Contact</a>
                    </div>
                    
                    <!-- Actions utilisateur -->
                    <template v-if="isAuthenticated">
                        <div class="nav-separator"></div>
                        <div class="nav-section user-actions">
                        <a href="#" @click.prevent="navigateTo('appointment'); closeMenu()">Prendre RDV</a>
                        <a href="#" @click.prevent="navigateTo('dossier'); closeMenu()">Dossier Animaux</a>
                            <a href="#" @click.prevent="navigateTo('profile'); closeMenu()">Mon Profil</a>
                        <a href="#" @click.prevent="navigateTo('admin')" v-if="isAdmin">Administration</a>
                        </div>
                        <div class="nav-separator"></div>
                        <div class="nav-section">
                            <a href="#" @click.prevent="logout(); closeMenu()" class="nav-logout">D√©connexion</a>
                        </div>
                    </template>
                    <template v-if="!isAuthenticated">
                        <div class="nav-separator"></div>
                        <div class="nav-section">
                            <a href="#" @click.prevent="showAuth = true; closeMenu()" class="nav-login">Connexion</a>
                        </div>
                    </template>
                </div>
            </nav>
        </header>

        <div class="page-container">
            <!-- Page d'accueil -->
            <template v-if="currentPage === 'home'">
                <section class="hero">
                    <div class="hero-content">
                        <h1>Soins naturels pour vos animaux</h1>
                        <p>Th√©rapeute manuelle animalier, je vous propose des soins adapt√©s √† chaque esp√®ce pour am√©liorer leur bien-√™tre et leur qualit√© de vie.</p>
                        <a href="#" @click.prevent="navigateTo('appointment')" class="btn" v-if="isAuthenticated">Prendre rendez-vous</a>
                        <a href="#" class="btn" v-else @click.prevent="showAuth = true">Se connecter pour prendre RDV</a>
                    </div>
                </section>

                <!-- Bandeau des zones d'intervention -->
                <section class="intervention-zones">
                    <h2 class="section-title">J'interviens notamment √† :</h2>
                    <div class="marquee-container">
                        <div class="marquee-content">
                            <div class="marquee-tag">Thoirette-Coisia</div>
                            <div class="marquee-tag">Lons-le-Saunier</div>
                            <div class="marquee-tag">Bourg-en-Bresse</div>
                            <div class="marquee-tag">Oyonnax</div>
                            <div class="marquee-tag">Belley</div>
                            <div class="marquee-tag">Amb√©rieu-en-Bugey</div>
                            <div class="marquee-tag">Saint-Claude</div>
                            <div class="marquee-tag">Morez</div>
                            <div class="marquee-tag">Champagnole</div>
                            <div class="marquee-tag">Nantua</div>
                            <div class="marquee-tag">Poncin</div>
                            <div class="marquee-tag">Culoz</div>
                            <div class="marquee-tag">Hauteville-Lompnes</div>
                            <div class="marquee-tag">Saint-Martin-du-Fr√™ne</div>
                            <div class="marquee-tag">Jeurre</div>
                            <div class="marquee-tag">Arinthod</div>
                            <div class="marquee-tag">Orgelet</div>
                            <div class="marquee-tag">Saint-Julien</div>
                            <div class="marquee-tag">Viriat</div>
                            <div class="marquee-tag">Montr√©al-la-Cluse</div>
                            <div class="marquee-tag">Izernore</div>
                            <div class="marquee-tag">Saint-Germain-de-Joux</div>
                            <div class="marquee-tag">Thoirette-Coisia</div>
                            <div class="marquee-tag">Lons-le-Saunier</div>
                            <div class="marquee-tag">Bourg-en-Bresse</div>
                            <div class="marquee-tag">Oyonnax</div>
                            <div class="marquee-tag">Belley</div>
                            <div class="marquee-tag">Amb√©rieu-en-Bugey</div>
                            <div class="marquee-tag">Saint-Claude</div>
                            <div class="marquee-tag">Morez</div>
                            <div class="marquee-tag">Champagnole</div>
                            <div class="marquee-tag">Nantua</div>
                            <div class="marquee-tag">Poncin</div>
                            <div class="marquee-tag">Culoz</div>
                            <div class="marquee-tag">Hauteville-Lompnes</div>
                            <div class="marquee-tag">Saint-Martin-du-Fr√™ne</div>
                            <div class="marquee-tag">Jeurre</div>
                            <div class="marquee-tag">Arinthod</div>
                            <div class="marquee-tag">Orgelet</div>
                            <div class="marquee-tag">Saint-Julien</div>
                            <div class="marquee-tag">Viriat</div>
                            <div class="marquee-tag">Montr√©al-la-Cluse</div>
                            <div class="marquee-tag">Izernore</div>
                            <div class="marquee-tag">Saint-Germain-de-Joux</div>
                        </div>
                    </div>
                </section>

                <section id="about" class="section">
                    <h2 class="section-title">√Ä Propos de moi</h2>
                    <div class="about">
                        <div>
                            <h3>Je suis Emmy VASSE,</h3>
                            <p><strong>Th√©rapeute manuelle animalier</strong>, sp√©cialis√©e dans une approche globale du bien-√™tre animal.</p>

                            <p>Form√©e pendant cinq ans en <strong>ost√©opathie animale</strong> au CNESOA, j'ai acquis de nombreuses techniques de soin (structurelles, cr√¢niennes, tissulaires‚Ä¶). Mon parcours m'a permis de travailler avec une grande diversit√© d'animaux : chiens, chats, chevaux, ruminants, NAC...</p>

                            <p>Je me suis ensuite form√©e en <strong>√©ducation canine (MEC1)</strong>, en <strong>naturopathie animali√®re</strong> (nutrition, hom√©opathie, fleurs de Bach, etc.) et en <strong>magn√©tisme</strong>, afin d'int√©grer une dimension <strong>√©nerg√©tique et √©motionnelle</strong> √† ma pratique.</p>

                            <p>Aujourd'hui, j'interviens √† domicile dans l'<strong>Ain</strong> et le <strong>Jura</strong>, ainsi qu'au <strong>club canin Jura Sud (ACJS)</strong> √† Jeurre, o√π je propose √©galement des cours d'√©ducation.</p>
                        </div>
                        <div class="carousel-container" 
                             @mouseenter="stopCarouselAutoPlay" 
                             @mouseleave="startCarouselAutoPlay">
                            <div class="carousel-wrapper" :style="{ transform: `translateX(-${currentCarouselIndex * 12.5}%)` }">
                                <img src="images/Carroussel1.jpeg" alt="Emmy en pratique" class="carousel-image">
                                <img src="images/Carroussel2.JPG" alt="Emmy en pratique" class="carousel-image">
                                <img src="images/Carroussel3.JPG" alt="Emmy en pratique" class="carousel-image">
                                <img src="images/Carroussel4.JPG" alt="Emmy en pratique" class="carousel-image">
                                <img src="images/Carroussel5.JPG" alt="Emmy en pratique" class="carousel-image">
                                <img src="images/Carroussel6.jpg" alt="Emmy en pratique" class="carousel-image">
                                <img src="images/Carroussel7.jpg" alt="Emmy en pratique" class="carousel-image">
                                <img src="images/Carroussel8.jpg" alt="Emmy en pratique" class="carousel-image">
                            </div>
                            <div class="carousel-controls">
                                <div class="carousel-indicators">
                                    <span v-for="(image, index) in 8" :key="index" 
                                          class="indicator" 
                                          :class="{ active: currentCarouselIndex === index }"
                                          @click="goToCarouselImage(index); stopCarouselAutoPlay()">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section "La th√©rapie manuelle pour qui ?" -->
                <section class="therapy-for-who-section">
                    <div class="therapy-for-who-container">
                        <h2 class="therapy-for-who-title">La th√©rapie manuelle pour qui ?</h2>
                        
                        <div class="therapy-for-who-description">
                            <p><span class="section-subtitle">Pour tous les animaux :</span> la th√©rapie manuelle animale est une approche globale et naturelle dont tous les animaux peuvent b√©n√©ficier quelque soit sa <strong>race</strong>, son <strong>√¢ge</strong> (jeune, adulte ou s√©nior), ou son <strong>activit√©</strong> (sportif ou non).</p>
                            <p><span class="section-subtitle">Adapt√©e √† votre animal :</span> c'est une approche th√©rapeutique manuelle visant √† r√©harmoniser le corps. Enti√®rement personnalis√©e, elle s'<strong>adapte √† chaque individu</strong> quelles que soient ses probl√©matiques, car <strong>chaque animal est unique</strong>.</p>
                        </div>
                        
                        <div class="animals-grid">
                            <div class="animal-card" @click="navigateTo('chien')">
                                <div class="animal-image">
                                    <img src="images/body_map_chien.svg" alt="Th√©rapie manuelle pour chiens" class="animal-svg">
                                </div>
                                <h4 class="animal-title">Th√©rapie manuelle Chien</h4>
                            </div>
                            
                            <div class="animal-card" @click="navigateTo('chat')">
                                <div class="animal-image">
                                    <img src="images/body_map_chat.svg" alt="Th√©rapie manuelle pour chats" class="animal-svg">
                                </div>
                                <h4 class="animal-title">Th√©rapie manuelle Chat</h4>
                            </div>
                            
                            <div class="animal-card" @click="navigateTo('cheval')">
                                <div class="animal-image">
                                    <img src="images/body_map_cheval.svg" alt="Th√©rapie manuelle pour chevaux" class="animal-svg">
                                </div>
                                <h4 class="animal-title">Th√©rapie manuelle Cheval</h4>
                            </div>
                            
                            <div class="animal-card" @click="navigateTo('nac')">
                                <div class="animal-image">
                                    <img src="images/body_map_nac.svg" alt="Th√©rapie manuelle pour NAC" class="animal-svg">
                                </div>
                                <h4 class="animal-title">Th√©rapie manuelle NAC</h4>
                            </div>
                            
                            <div class="animal-card" @click="navigateTo('bovins')">
                                <div class="animal-image">
                                    <img src="images/body_map_vache.svg" alt="Th√©rapie manuelle pour bovins" class="animal-svg">
                                </div>
                                <h4 class="animal-title">Th√©rapie manuelle Bovins</h4>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="services" class="section services">
                    <h2 class="section-title">Mes Outils Th√©rapeutiques</h2>
                    <div class="services-grid">
                        <div class="service-card">
                            <h3>R√©√©quilibrage corporel</h3>
                            <p>Permet de retrouver √©quilibre et harmonie dans l'ensemble des sph√®res du corps (articulaire, musculaire, visc√©rale, cr√¢nienne)</p>
                        </div>
                        <div class="service-card">
                            <h3>Soin √©motionnel</h3>
                            <p>Lib√©ration d'√©motions cristalis√©s dans les tissus pouvant √™tre la cause de trouble psycologique et physique.</p>
                        </div>
                        <div class="service-card">
                            <h3>Soin √©nerg√©tique</h3>
                            <p>R√©√©quilibrage des √©nergies afin de favoriser le bien-√™tre physique, √©motionnel et mental de l'animal.</p>
                        </div>
                        <div class="service-card">
                            <h3>Naturopathie</h3>
                            <p>Traitement naturel par les plantes : fleurs de Bach, aromath√©rapie, phytoth√©rapie, hom√©opathie.</p>
                        </div>
                        <div class="service-card">
                            <h3>Massage et √©tirement</h3>
                            <p>Permet une d√©tente musculaire et un apaisement global. Permet √† l'animal de r√©cup√©rer une √©lasticit√© musculaire optimal.</p>
                        </div>
                        <div class="service-card">
                            <h3>Nutrition</h3>
                            <p>Analyse et personnalisation des rations propos√©es √† l'animal en fonction de ses besoins et sp√©cificit√©.</p>
                        </div>
                    </div>
                </section>

                <section id="blog" class="blog-section">
                    <div class="blog-container">
                        <div class="blog-header">
                            <h2 class="section-title">Actualit√©s & √âv√©nements</h2>
                            <div v-if="isAdmin" class="admin-controls">
                                <button class="btn" @click="resetBlogForm(); showAddPostModal = true">
                                    Ajouter un article
                                </button>
                            </div>
                        </div>
                        <div class="blog-grid">
                            <article v-for="post in blogPosts" :key="post.id" class="blog-post" @click="showPostDetails(post)">
                                <img :src="post.imageUrl" :alt="post.title" class="blog-post-image">
                                <div class="blog-post-content">
                                    <div class="blog-post-date">{{ formatDate(post.date) }}</div>
                                    <h3 class="blog-post-title">{{ post.title }}</h3>
                                    <p class="blog-post-excerpt">{{ post.excerpt }}</p>
                                    <div class="blog-post-link">
                                        Lire la suite
                                    </div>
                                </div>
                            </article>
                        </div>
                    </div>
                </section>

                <section id="contact" class="section contact">
                    <div class="contact-grid" style="background:none; box-shadow:none; border:none;">
                        <div class="contact-form-container">
                            <div class="contact-title" style="text-align:left;">Avez-vous des questions? <br>Contactez-moi!</div>
                            <form @submit.prevent="sendMessage">
                                <div class="form-group">
                                    <label for="name">Nom</label>
                                    <input type="text" id="name" v-model="contactForm.name" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" v-model="contactForm.email" required>
                                </div>
                                <div class="form-group">
                                    <label for="message">Message</label>
                                    <textarea id="message" v-model="contactForm.message" rows="5" required></textarea>
                                </div>
                                <button type="submit" class="btn">Envoyer</button>
                            </form>
                        </div>
                        <div class="contact-info-container">
                            <p style="margin-bottom: 0.7rem;">Pour toute demande, contactez-moi par t√©l√©phone, mail ou via les r√©seaux sociaux.<br>Je vous r√©pondrai dans les plus brefs d√©lais.</p>
                            <div class="contact-info-block" style="background: #f8fafc; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding: 1.2rem 1.5rem; margin-bottom: 1.2rem;">
                                <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 0.5rem;">
                                    <img src="images/location.svg" alt="Adresse" style="width: 22px; height: 22px; opacity: 0.7;">
                                    <a href="https://www.google.com/maps/place//data=!4m2!3m1!1s0x6c2f3832ff1c07a1:0xc10ae36728d79394?sa=X&ved=1t:8290&hl=fr&ictx=111" target="_blank" style="color: var(--primary-color); text-decoration: none; font-weight: 500;">Thoirette-Coisia</a>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 0.5rem;">
                                    <img src="images/phone.svg" alt="T√©l√©phone" style="width: 22px; height: 22px; opacity: 0.7;">
                                    <a href="tel:0651082126" style="color: var(--primary-color); text-decoration: none; font-weight: 500;">06 51 08 21 26</a>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 0.5rem;">
                                    <img src="images/mail.svg" alt="Mail" style="width: 22px; height: 22px; opacity: 0.7;">
                                    <a href="mailto:mystereandemmy@gmail.com" style="color: var(--primary-color); text-decoration: none; font-weight: 500; overflow-wrap: anywhere; word-break: break-all;">emmyvasse.pro@gmail.com</a>
                                </div>
                            </div>
                            <div class="contact-socials" style="display: flex; gap: 1.2rem; align-items: center; margin-top: 0.5rem;">
                                <a href="https://www.facebook.com/people/Th%C3%A9rapeute-Manuelle-Animalier-Emmy-Vasse/61555277590644/" target="_blank" aria-label="Facebook" style="display: flex; align-items: center; gap: 0.5rem; color: #1877f3; font-weight: 600; text-decoration: none; font-size: 1.1rem;">
                                    <img src="images/facebook.svg" alt="Facebook" style="width: 28px; height: 28px;"> Facebook
                                </a>
                                <a href="https://www.instagram.com/emmyvasse.therapieanimale?igsh=MWNsZTMxYzBnaXVqeA==" target="_blank" aria-label="Instagram" style="display: flex; align-items: center; gap: 0.5rem; color: #e4405f; font-weight: 600; text-decoration: none; font-size: 1.1rem;">
                                    <img src="images/instagram.svg" alt="Instagram" style="width: 28px; height: 28px;"> Instagram
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            </template>

            <!-- Page de rendez-vous -->
            <template v-if="currentPage === 'appointment'">
                <section class="appointment-page">
                    <div class="appointment-header">
                        <h1>Prendre un rendez-vous</h1>
                        <p>Choisissez une date et une heure qui vous conviennent pour votre consultation</p>
                    </div>

                    <div class="appointment-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <h3>Choisissez votre animal</h3>
                            <p>S√©lectionnez un animal existant dans votre dossier ou cr√©ez un nouveau profil en renseignant ses informations</p>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <h3>S√©lectionnez la date et l'heure</h3>
                            <p>Choisissez une date parmi celles disponibles, puis s√©lectionnez le cr√©neau horaire qui vous convient</p>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <h3>Confirmez votre rendez-vous</h3>
                            <p>Votre rendez-vous est imm√©diatement enregistr√© et ajout√© √† l'historique de votre animal</p>
                        </div>
                    </div>

                    <div class="appointment-form">
                        <div v-if="appointmentSuccess" class="success-message" style="background: var(--light-bg); color: var(--text-color); padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
                            <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Demande de rendez-vous enregistr√©e</h3>
                            <p style="margin-bottom: 0.8rem;">Votre demande de rendez-vous a bien √©t√© prise en compte. Cependant, elle doit encore √™tre valid√©e.</p>
                            <p style="margin-bottom: 0.8rem;">Vous recevrez prochainement une confirmation par SMS ou par email. Le rendez-vous ne sera d√©finitif qu'apr√®s cette confirmation de notre part.</p>
                            <p>En cas de question, n'h√©sitez pas √† nous contacter directement.</p>
                        </div>
                        <div v-if="appointmentError" class="error-message">
                            {{ appointmentError }}
                        </div>
                        <form @submit.prevent="submitAppointment">
                            <div class="form-group">
                                <label for="consultationType">Type de consultation</label>
                                <select id="consultationType" v-model="appointmentForm.consultationType" required>
                                    <option value="">S√©lectionnez le type de consultation</option>
                                    <option value="premiere">Premi√®re consultation</option>
                                    <option value="suivi">Consultation de suivi</option>
                                    <option value="particulier">Consultation pour motif particulier</option>
                                </select>
                            </div>

                            <!-- Message pour premi√®re consultation ou motif particulier -->
                            <div v-if="appointmentForm.consultationType === 'premiere' || appointmentForm.consultationType === 'particulier'" class="info-message" style="background: var(--light-bg); padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Prise de contact n√©cessaire</h3>
                                <p style="margin-bottom: 1rem;">Pour ce type de consultation, merci de me contacter directement via :</p>
                                <ul style="list-style: none; margin-bottom: 1rem;">
                                    <li style="margin-bottom: 0.5rem;">üìû T√©l√©phone : <a href="tel:0651082126">06 51 08 21 26</a></li>
                                    <li style="margin-bottom: 0.5rem;">üìß Email : <a href="mailto:emmyvasse.pro@gmail.com">emmyvasse.pro@gmail.com</a></li>
                                    <li style="margin-bottom: 0.5rem;">üì± R√©seaux sociaux : 
                                        <a href="https://www.instagram.com/emmyvasse.therapieanimale?igsh=MWNsZTMxYzBnaXVqeA==" target="_blank" style="margin-right: 0.5rem;">Instagram</a>
                                        <a href="https://www.facebook.com/people/Th%C3%A9rapeute-Manuelle-Animalier-Emmy-Vasse/61555277590644/" target="_blank">Facebook</a>
                                    </li>
                                </ul>
                                <p>Ou utilisez le <a href="#" @click.prevent="scrollToContact">formulaire de contact</a> ci-dessous.</p>
                            </div>

                            <!-- Formulaire pour consultation de suivi -->
                            <template v-if="appointmentForm.consultationType === 'suivi'">
                            <div class="form-group">
                                    <label for="animalSelect">S√©lectionner un animal</label>
                                    <select id="animalSelect" v-model="appointmentForm.selectedAnimalId" @change="onAnimalSelected" required>
                                        <option value="">S√©lectionnez un animal</option>
                                        <option v-for="animal in animals" :key="animal.id" :value="animal.id">
                                            {{ animal.name }} ({{ animal.species }})
                                        </option>
                                        <option value="autre">Autre animal</option>
                                </select>
                            </div>

                                <!-- Message pour "Autre animal" -->
                                <div v-if="appointmentForm.selectedAnimalId === 'autre'" class="info-message" style="background: var(--light-bg); padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Nouvel animal</h3>
                                    <p style="margin-bottom: 1rem;">Pour un nouvel animal, merci de me contacter directement via :</p>
                                    <ul style="list-style: none; margin-bottom: 1rem;">
                                        <li style="margin-bottom: 0.5rem;">üìû T√©l√©phone : <a href="tel:0651082126">06 51 08 21 26</a></li>
                                        <li style="margin-bottom: 0.5rem;">üìß Email : <a href="mailto:emmyvasse.pro@gmail.com">emmyvasse.pro@gmail.com</a></li>
                                        <li style="margin-bottom: 0.5rem;">üì± R√©seaux sociaux : 
                                            <a href="https://www.instagram.com/emmyvasse.therapieanimale?igsh=MWNsZTMxYzBnaXVqeA==" target="_blank" style="margin-right: 0.5rem;">Instagram</a>
                                            <a href="https://www.facebook.com/people/Th%C3%A9rapeute-Manuelle-Animalier-Emmy-Vasse/61555277590644/" target="_blank">Facebook</a>
                                        </li>
                                    </ul>
                                    <p>Ou utilisez le <a href="#" @click.prevent="scrollToContact">formulaire de contact</a> ci-dessous.</p>
                            </div>

                                <!-- Formulaire de rendez-vous pour un animal existant -->
                                <template v-if="appointmentForm.selectedAnimalId && appointmentForm.selectedAnimalId !== 'autre'">
                            <div class="form-group">
                                <label for="phone">Num√©ro de t√©l√©phone</label>
                                <input type="tel" id="phone" v-model="appointmentForm.phone" 
                                       pattern="[0-9]{10}" 
                                       placeholder="0612345678" 
                                       required>
                                <small style="color: var(--text-color); font-size: 0.8rem;">Format: 10 chiffres (ex: 0612345678)</small>
                            </div>

                            <div class="form-group">
                                <label for="appointmentDate">Date du rendez-vous</label>
                                <select id="appointmentDate" 
                                        v-model="appointmentForm.date" 
                                        required
                                        :disabled="isLoadingDates">
                                    <option value="">S√©lectionnez une date</option>
                                    <option v-for="date in availableDates" 
                                            :key="date" 
                                            :value="date">
                                        {{ formatDateFr(date) }}
                                    </option>
                                </select>
                                <div v-if="isLoadingDates" class="loading-message">
                                    Chargement des dates disponibles...
                                </div>
                                <div v-if="!isLoadingDates && availableDates.length === 0" class="no-slots-message" style="color: var(--text-color);">
                                    Aucune date disponible pour les 30 prochains jours.
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Heure du rendez-vous</label>
                                <div v-if="displayedTimeSlots.length === 0" class="no-slots-message">
                                    Aucun cr√©neau disponible pour cette date.
                                </div>
                                <div v-else class="time-slots">
                                    <button v-for="slot in displayedTimeSlots" 
                                         :key="slot"
                                         type="button"
                                         class="time-slot"
                                         :class="{ 'selected': appointmentForm.time === slot }"
                                         @click="appointmentForm.time = slot">
                                        {{ slot }}
                                    </button>
                                    </div>
                                <div class="info-message" style="margin-top: 1rem; color: var(--text-color); font-style: italic; background: var(--light-bg); padding: 1rem; border-radius: 8px;">
                                    D'autres cr√©neaux peuvent √™tre disponibles. N'h√©sitez pas √† me contacter directement :
                                    <ul style="list-style: none; margin-top: 0.5rem;">
                                        <li style="margin-bottom: 0.3rem;">üìû Par t√©l√©phone : <a href="tel:0651082126">06 51 08 21 26</a></li>
                                        <li style="margin-bottom: 0.3rem;">üìß Par email : <a href="mailto:emmyvasse.pro@gmail.com">emmyvasse.pro@gmail.com</a></li>
                                        <li>üí¨ Par message : <a href="#" @click.prevent="scrollToContact">formulaire de contact</a></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="notes">Notes suppl√©mentaires</label>
                                <textarea id="notes" v-model="appointmentForm.notes" rows="3"></textarea>
                            </div>

                            <button type="submit" class="btn primary">Confirmer le rendez-vous</button>
                                </template>
                            </template>
                        </form>
                    </div>
                </section>
            </template>

            <!-- Page de dossier ost√©opathique -->
            <template v-if="currentPage === 'dossier'">
                <section class="dossier-page">
                    <div class="dossier-header">
                        <h1>Dossier Ost√©opathique</h1>
                        <p>Consultez les dossiers de vos animaux</p>
                    </div>

                    <div class="dossier-content">
                        <div v-if="!animals.length" class="no-animals">
                            <p>Vous n'avez pas encore d'animaux enregistr√©s.</p>
                            <p>Contactez votre ost√©opathe pour cr√©er un dossier.</p>
                        </div>

                        <div v-else class="animals-list">
                            <div v-for="animal in animals" :key="animal.id" class="animal-card">
                                <div class="animal-info">
                                    <div v-if="animal.photos && animal.photos.length > 0" class="animal-photos-container">
                                        <img :src="animal.photos[0]" :alt="animal.name" class="animal-photo">
                                        <div v-if="animal.photos.length > 1" class="photo-count-badge">
                                            +{{ animal.photos.length - 1 }}
                                        </div>
                                    </div>
                                    <div v-else-if="animal.photoBase64" class="animal-photo-container">
                                        <img :src="animal.photoBase64" :alt="animal.name" class="animal-photo">
                                    </div>
                                    <div v-else class="animal-photo placeholder">
                                        <span>Pas de photo</span>
                                    </div>
                                    <h3>{{ animal.name }}</h3>
                                    <p class="animal-birthdate">N√© le: {{ formatDate(animal.birthdate, animal.birthdateType, animal.birthdateApprox) }}</p>
                                </div>
                                <div class="animal-actions">
                                    <button v-if="animal.documents && animal.documents.length > 0" 
                                            class="btn primary" 
                                            @click="viewAnimalDocuments(animal)">
                                        Voir les documents ({{ animal.documents.length }})
                            </button>
                        </div>
                    </div>
                        </div>
                    </div>
                </section>
            </template>

            <!-- Page CGU -->
            <template v-if="currentPage === 'cgu'">
                <section class="cgu-page">
                    <div class="cgu-header">
                        <h1 class="section-title">Conditions G√©n√©rales d'Utilisation</h1>
                        <p>Derni√®re mise √† jour : {{ new Date().toLocaleDateString('fr-FR') }}</p>
                    </div>
                    
                    <div class="cgu-content">
                        <div class="cgu-section">
                            <h2>1. Pr√©sentation du service</h2>
                            <p>Ce site web est d√©di√© √† la gestion des dossiers animaux et des rendez-vous pour les services de th√©rapie manuelle animale d'Emmy Vasse. Il permet aux propri√©taires d'animaux de consulter les dossiers de leurs animaux et de prendre rendez-vous avec la th√©rapeute manuelle.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>2. Acceptation des conditions</h2>
                            <p>L'utilisation de ce site implique l'acceptation pleine et enti√®re des pr√©sentes conditions g√©n√©rales d'utilisation. Si vous n'acceptez pas ces conditions, veuillez ne pas utiliser ce service.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>3. Inscription et compte utilisateur</h2>
                            <p>Pour acc√©der aux fonctionnalit√©s du site, vous devez cr√©er un compte en fournissant des informations exactes et √† jour. Vous √™tes responsable de la confidentialit√© de vos identifiants de connexion.</p>
                            <p>Emmy Vasse se r√©serve le droit de refuser l'inscription ou de suspendre un compte en cas de non-respect des pr√©sentes conditions.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>4. Utilisation du service</h2>
                            <p>Vous vous engagez √† :</p>
                            <ul>
                                <li>Utiliser le service de mani√®re conforme √† sa destination</li>
                                <li>Ne pas tenter d'acc√©der √† des donn√©es d'autres utilisateurs</li>
                                <li>Ne pas perturber le fonctionnement du site</li>
                                <li>Fournir des informations exactes concernant vos animaux</li>
                            </ul>
                        </div>

                        <div class="cgu-section">
                            <h2>5. Protection des donn√©es personnelles</h2>
                            <p>Conform√©ment au R√®glement G√©n√©ral sur la Protection des Donn√©es (RGPD), vos donn√©es personnelles sont collect√©es et trait√©es uniquement dans le cadre de la gestion des dossiers animaux et des rendez-vous.</p>
                            <p>Vous disposez d'un droit d'acc√®s, de rectification, de suppression et d'opposition aux donn√©es vous concernant. Pour exercer ces droits, contactez Emmy Vasse.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>6. Responsabilit√©</h2>
                            <p>Emmy Vasse s'efforce de maintenir le site accessible et fonctionnel, mais ne peut garantir une disponibilit√© continue. Le service peut √™tre temporairement indisponible pour maintenance.</p>
                            <p>Emmy Vasse ne peut √™tre tenue responsable des dommages indirects r√©sultant de l'utilisation du site.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>7. Propri√©t√© intellectuelle</h2>
                            <p>Le contenu du site (textes, images, logos) est prot√©g√© par les droits de propri√©t√© intellectuelle. Toute reproduction sans autorisation est interdite.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>8. Modification des conditions</h2>
                            <p>Emmy Vasse se r√©serve le droit de modifier ces conditions √† tout moment. Les nouvelles conditions seront publi√©es sur le site et entreront en vigueur d√®s leur publication.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>9. Droit applicable</h2>
                            <p>Les pr√©sentes conditions sont soumises au droit fran√ßais. En cas de litige, les tribunaux fran√ßais seront seuls comp√©tents.</p>
                        </div>

                        <div class="cgu-section">
                            <h2>10. Contact</h2>
                            <p>Pour toute question concernant ces conditions, vous pouvez contacter Emmy Vasse via le formulaire de contact disponible sur le site.</p>
                        </div>
                    </div>
                </section>
            </template>

            <!-- Page d'administration -->
            <template v-if="currentPage === 'admin' && isAdmin">
                <section class="admin-page">
                    <div class="admin-header">
                        <h1 class="section-title">Interface Administrateur</h1>
                        <p>Gestion des dossiers animaux et des rendez-vous</p>
                    </div>

                    <div class="admin-tabs">
                        <button 
                            :class="['admin-tab', { active: adminActiveTab === 'animals' }]"
                                @click="switchAdminTab('animals')">
                            Dossiers Animaux
                        </button>
                        <button 
                            :class="['admin-tab', { active: adminActiveTab === 'appointments' }]"
                                @click="switchAdminTab('appointments')">
                            Rendez-vous
                        </button>
                        <button 
                            :class="['admin-tab', { active: adminActiveTab === 'slots' }]"
                            @click="switchToSlotsTab">
                            Cr√©neaux
                        </button>
                        <button 
                            :class="['admin-tab', { active: adminActiveTab === 'clients' }]"
                                @click="switchAdminTab('clients')">
                            Clients
                        </button>
                        <button 
                            :class="['admin-tab', { active: adminActiveTab === 'messages' }]"
                                @click="switchAdminTab('messages')">
                            Messages
                            <span v-if="unreadMessagesCount > 0" class="notification-badge">{{ unreadMessagesCount }}</span>
                        </button>

                    </div>

                    <!-- Onglet Dossiers Animaux -->
                    <div v-if="adminActiveTab === 'animals'" class="admin-content">
                        <div class="admin-header-actions">
                        <div class="search-bar">
                            <input 
                                type="text" 
                                v-model="animalsSearch" 
                                placeholder="Rechercher un animal...">
                            </div>
                            <button class="btn primary" @click="showAddAnimalModal = true">
                                Ajouter un animal
                            </button>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Type</th>
                                    <th>Propri√©taire</th>
                                    <th>Date de naissance</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="animal in filteredAnimals" :key="animal.id">
                                    <td>{{ animal.name }}</td>
                                    <td>{{ animal.species }}</td>
                                    <td>{{ getUserFullName(animal.userId) }}</td>
                                    <td>{{ formatDate(animal.birthdate, animal.birthdateType, animal.birthdateApprox) }}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-view" @click="viewAnimalDetails(animal)">
                                                Voir
                                            </button>
                                            <button class="btn-delete" @click="deleteAnimal(animal)">
                                                Supprimer
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr v-if="filteredAnimals.length === 0">
                                    <td colspan="5" class="text-center">Aucun animal trouv√©</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Modal d'ajout d'animal -->
                        <div v-if="showAddAnimalModal" class="modal">
                            <div class="modal-content">
                                <h2>Ajouter un animal</h2>
                                <form @submit.prevent="addAnimal">
                                    <div class="form-group">
                                        <label for="animalOwner">Propri√©taire</label>
                                        <div class="searchable-select">
                                            <input 
                                                type="text" 
                                                id="animalOwnerSearch" 
                                                v-model="ownerSearch"
                                                placeholder="Rechercher un client..."
                                                @focus="showOwnerDropdown = true"
                                                @blur="setTimeout(() => showOwnerDropdown = false, 200)"
                                                autocomplete="off">
                                            <div class="select-dropdown" v-show="showOwnerDropdown && filteredOwnerClients.length > 0">
                                                <div 
                                                    v-for="client in filteredOwnerClients" 
                                                    :key="client.id"
                                                    class="select-option"
                                                    @click="selectOwner(client)"
                                                    :class="{ selected: newAnimal.userId === client.id }">
                                                    <strong>{{ client.firstName }} {{ client.lastName }}</strong>
                                                    <span class="client-email">{{ client.email }}</span>
                                                    <span class="client-phone">{{ client.phone || 'N/A' }}</span>
                                                </div>
                                            </div>
                                            <div v-if="newAnimal.userId" class="selected-owner">
                                                <span>{{ getSelectedOwnerName() }}</span>
                                                <button type="button" @click="clearOwnerSelection" class="clear-btn">√ó</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalName">Nom de l'animal</label>
                                        <input type="text" id="newAnimalName" v-model="newAnimal.name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalSpecies">Esp√®ce</label>
                                        <select id="newAnimalSpecies" v-model="newAnimal.species" required>
                                            <option value="">S√©lectionnez une esp√®ce</option>
                                            <option value="chien">Chien</option>
                                            <option value="chat">Chat</option>
                                            <option value="cheval">Cheval</option>
                                            <option value="autre">Autre</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalRace">Race</label>
                                        <input type="text" id="newAnimalRace" v-model="newAnimal.race">
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalBirthdate">Date de naissance</label>
                                        <div class="birthdate-input-container">
                                            <div class="radio-buttons">
                                                <button type="button" class="radio-btn" :class="{ selected: newAnimal.birthdateType === 'exact' }" @click="newAnimal.birthdateType = 'exact'; handleBirthdateTypeChange()">
                                                    Date exacte
                                                </button>
                                                <button type="button" class="radio-btn" :class="{ selected: newAnimal.birthdateType === 'approximate' }" @click="newAnimal.birthdateType = 'approximate'; handleBirthdateTypeChange()">
                                                    Date approximative
                                                </button>
                                            </div>
                                            <div v-if="newAnimal.birthdateType === 'exact'" class="birthdate-exact">
                                        <input type="date" id="newAnimalBirthdate" v-model="newAnimal.birthdate" required>
                                    </div>
                                            <div v-else-if="newAnimal.birthdateType === 'approximate'" class="birthdate-approximate">
                                                <input type="text" id="newAnimalBirthdateApprox" v-model="newAnimal.birthdateApprox" 
                                                       placeholder="Ex: 2018, 2 ans, d√©but 2020, etc.">
                                                <small style="color: var(--text-color); font-size: 0.8rem;">Vous pouvez indiquer l'ann√©e, l'√¢ge approximatif, ou une p√©riode</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>St√©rilisation :</label>
                                        <div class="radio-buttons">
                                            <button type="button" class="radio-btn" :class="{ selected: newAnimal.sterilization === true }" @click="newAnimal.sterilization = true; toggleSterilizationDetails()">
                                                Oui
                                            </button>
                                            <button type="button" class="radio-btn" :class="{ selected: newAnimal.sterilization === false }" @click="newAnimal.sterilization = false; toggleSterilizationDetails()">
                                                Non
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group sterilization-details" v-show="newAnimal.sterilization === true">
                                        <label>D√©tails de la st√©rilisation :</label>
                                        <textarea v-model="newAnimal.sterilizationDetails" rows="2" placeholder="Date de st√©rilisation, type d'intervention, v√©t√©rinaire, etc."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalDiet">Alimentation</label>
                                        <textarea id="newAnimalDiet" v-model="newAnimal.diet" rows="2" 
                                                placeholder="Type d'alimentation, fr√©quence des repas, etc."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalActivity">Activit√©</label>
                                        <select id="newAnimalActivity" v-model="newAnimal.activity" required>
                                            <option value="">S√©lectionnez le niveau d'activit√©</option>
                                            <option value="s√©dentaire">S√©dentaire (tr√®s peu d'activit√©)</option>
                                            <option value="peu_actif">Peu actif (activit√© occasionnelle)</option>
                                            <option value="actif">Actif (activit√© r√©guli√®re)</option>
                                            <option value="tr√®s_actif">Tr√®s actif (activit√© intense et fr√©quente)</option>
                                            <option value="sportif">Sportif/Comp√©tition</option>
                                        </select>
                                        <textarea id="newAnimalActivityDetails" v-model="newAnimal.activityDetails" rows="2"
                                                placeholder="D√©tails sur le type d'activit√© (promenades, sport, etc.)"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalMedicalHistory">Ant√©c√©dents m√©dicaux</label>
                                        <textarea id="newAnimalMedicalHistory" v-model="newAnimal.medicalHistory" rows="3"
                                                placeholder="Maladies, op√©rations, blessures pass√©es, etc."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalTreatment">Traitement en cours</label>
                                        <textarea id="newAnimalTreatment" v-model="newAnimal.treatment" rows="2"
                                                placeholder="M√©dicaments, posologie, dur√©e, etc."></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label for="newAnimalBehavior">Particularit√©s comportementales</label>
                                        <textarea id="newAnimalBehavior" v-model="newAnimal.behavior" rows="2"
                                                placeholder="Comportements particuliers, anxi√©t√©, agressivit√©, etc."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalNotes">Notes suppl√©mentaires</label>
                                        <textarea id="newAnimalNotes" v-model="newAnimal.notes" rows="3"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalPhotos">Photos de l'animal</label>
                                        <input type="file" id="newAnimalPhotos" accept="image/*" multiple @change="handlePhotosUpload">
                                        <small style="color: var(--text-color); font-size: 0.8rem;">Format recommand√© : JPG, PNG (max 5MB par image, max 10 images)</small>
                                        <div v-if="newAnimal.photosPreview && newAnimal.photosPreview.length > 0" class="photos-preview">
                                            <div v-for="(preview, index) in newAnimal.photosPreview" :key="index" class="photo-item">
                                                <img :src="preview" alt="Aper√ßu de la photo" style="max-width: 150px; max-height: 150px; object-fit: cover; margin: 0.5rem;">
                                                <button type="button" @click="removePhoto(index)" class="btn-remove-photo">√ó</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="newAnimalDocuments">Documents</label>
                                        <input type="file" id="newAnimalDocuments" @change="handleDocumentUpload" accept="image/*" multiple>
                                        <small style="color: var(--text-color); font-size: 0.8rem;">Formats accept√©s : JPG, PNG (max 10MB)</small>
                                        
                                        <!-- Preview des documents -->
                                        <div v-if="newAnimal.documents && newAnimal.documents.length > 0" class="documents-preview" style="margin-top: 1rem;">
                                            <h4 style="margin-bottom: 0.5rem; color: var(--primary-color);">Documents s√©lectionn√©s :</h4>
                                            <div class="documents-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem;">
                                                <div v-for="(doc, index) in newAnimal.documents" :key="doc.id" class="document-card" style="background: white; padding: 0.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative;">
                                                    <img :src="doc.data" :alt="doc.name" style="width: 100%; height: 100px; object-fit: cover; border-radius: 4px; margin-bottom: 0.5rem;">
                                                    <p style="font-size: 0.8rem; color: var(--text-color); margin: 0; word-break: break-word;">{{ doc.name }}</p>
                                                    <p style="font-size: 0.7rem; color: var(--secondary-color); margin: 0.2rem 0 0 0;">{{ formatDate(doc.date) }}</p>
                                                    <button type="button" @click="removeDocument(index)" class="btn-remove-photo" style="position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.8); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer;">√ó</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-actions">
                                        <button type="button" class="btn secondary" @click="showAddAnimalModal = false">Annuler</button>
                                        <button type="submit" class="btn primary">Enregistrer</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Rendez-vous -->
                    <div v-if="adminActiveTab === 'appointments'" class="admin-content">
                        <div class="admin-header-actions">
                        <div class="search-bar">
                            <input 
                                type="text" 
                                    v-model="appointmentsSearch" 
                                placeholder="Rechercher un rendez-vous...">
                            </div>
                            <button class="btn primary" @click="showAdminNewAppointmentModal = true">
                                Nouveau rendez-vous
                            </button>

                            <div class="view-toggle">
                                <button 
                                    :class="['btn', appointmentsView === 'list' ? 'primary' : 'secondary']"
                                    @click="appointmentsView = 'list'">
                                    Vue Liste
                                </button>
                                <button 
                                    :class="['btn', appointmentsView === 'calendar' ? 'primary' : 'secondary']"
                                    @click="appointmentsView = 'calendar'">
                                    Vue Calendrier
                                </button>
                            </div>
                        </div>

                        <!-- Vue Liste -->
                        <div v-if="appointmentsView === 'list'" class="appointments-list-view">
                        <table class="data-table">
                            <thead>
                                <tr>
                                        <th class="sortable" @click="sortAppointments('date')">
                                            Date
                                            <span class="sort-icon" v-if="sortField === 'date'">
                                                {{ sortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                                            </span>
                                        </th>
                                    <th>Heure</th>
                                    <th>Animal</th>
                                    <th>Client</th>
                                    <th>T√©l√©phone</th>
                                        <th>Adresse</th>
                                        <th>Temps de trajet</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                    <tr v-for="appointment in sortedAppointments" :key="appointment.id">
                                    <td>{{ formatDate(appointment.date) }}</td>
                                    <td>{{ appointment.time }}</td>
                                    <td>{{ appointment.animalName }}</td>
                                    <td>{{ getUserFullName(appointment.userId) }}</td>
                                    <td>{{ appointment.phone }}</td>
                                        <td>{{ userEmails[appointment.userId]?.address || 'Non renseign√©e' }}</td>
                                        <td>{{ appointment.travelTime || 'Non renseign√©' }}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-edit" @click="editAppointment(appointment)">
                                                Modifier
                                            </button>
                                            <button class="btn-delete" @click="deleteAppointment(appointment)">
                                                Supprimer
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr v-if="sortedAppointments.length === 0">
                                    <td colspan="8" class="text-center">Aucun rendez-vous trouv√©</td>
                                </tr>
                            </tbody>
                        </table>
                        </div>

                        <!-- Vue Calendrier -->
                        <div v-else class="appointments-calendar-view">
                            <div class="calendar-header">
                                <button class="btn secondary" @click="previousMonth">
                                    <
                                </button>
                                <h3>{{ currentMonthName }} {{ currentYear }}</h3>
                                <button class="btn secondary" @click="nextMonth">
                                    >
                                </button>
                            </div>

                            <div class="calendar-grid">
                                <div class="calendar-weekday" v-for="day in weekDays" :key="day">
                                    {{ day }}
                                </div>
                                <div v-for="day in calendarDays" 
                                     :key="day.date"
                                     class="calendar-day"
                                     :class="{ 
                                         'today': isToday(day.date),
                                         'other-month': !isCurrentMonth(day.date),
                                         'has-appointments': hasAppointments(day.date)
                                     }"
                                     @click="selectDate(day.date)">
                                    {{ day.day }}
                                    <div v-if="hasAppointments(day.date)" class="appointments-indicator">
                                        {{ getAppointmentsCount(day.date) }} RDV
                                    </div>
                                </div>
                            </div>

                            <!-- Liste des rendez-vous pour la date s√©lectionn√©e -->
                            <div v-if="selectedDate && getDayAppointments(selectedDate).length > 0" class="day-appointments">
                                <h3>Rendez-vous du {{ formatDate(selectedDate) }}</h3>
                                <div class="appointments-cards">
                                    <div v-for="appointment in getDayAppointments(selectedDate)" 
                                         :key="appointment.id"
                                         class="appointment-card">
                                        <div class="appointment-time">{{ appointment.time }}</div>
                                        <div class="appointment-details">
                                            <div class="appointment-animal">{{ appointment.animalName }}</div>
                                            <div class="appointment-client">{{ getUserFullName(appointment.userId) }}</div>
                                            <div class="appointment-contact">
                                                <div>üìû {{ appointment.phone }}</div>
                                                <div>üöó {{ appointment.travelTime || 'Non renseign√©' }}</div>
                                            </div>
                                        </div>
                                        <div class="appointment-actions">
                                            <button class="btn-edit" @click="editAppointment(appointment)">
                                                Modifier
                                            </button>
                                            <button class="btn-delete" @click="deleteAppointment(appointment)">
                                                Supprimer
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Modal de nouveau rendez-vous admin -->
                        <div v-if="showAdminNewAppointmentModal" class="modal">
                            <div class="modal-content appointment-form-modal">
                                <h2>Nouveau rendez-vous</h2>
                                <form @submit.prevent="submitAdminAppointment">
                                    <div class="form-group">
                                        <label for="adminAppointmentClient">Client</label>
                                        <select 
                                            id="adminAppointmentClient" 
                                            v-model="adminAppointmentForm.userId"
                                            required
                                            @change="loadClientAnimals">
                                            <option value="">S√©lectionnez un client</option>
                                            <option v-for="client in allClients" 
                                                    :key="client.id" 
                                                    :value="client.id">
                                                {{ client.firstName }} {{ client.lastName }} ({{ client.email }})
                                            </option>
                                        </select>
                                    </div>

                                    <div v-if="adminAppointmentForm.userId" class="form-group">
                                        <label for="adminAppointmentAnimal">Animal</label>
                                        <select 
                                            id="adminAppointmentAnimal" 
                                            v-model="adminAppointmentForm.selectedAnimalId"
                                            required>
                                            <option value="">S√©lectionnez un animal</option>
                                            <option v-for="animal in clientAnimals" 
                                                    :key="animal.id" 
                                                    :value="animal.id">
                                                {{ animal.name }} ({{ animal.species }})
                                            </option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="adminAppointmentPhone">Num√©ro de t√©l√©phone</label>
                                        <input 
                                            type="tel" 
                                            id="adminAppointmentPhone" 
                                            v-model="adminAppointmentForm.phone"
                                            pattern="[0-9]{10}"
                                            placeholder="0612345678"
                                            required>
                                        <small>Format: 10 chiffres (ex: 0612345678)</small>
                                    </div>

                                    <div class="form-group">
                                        <label for="adminAppointmentDate">Date du rendez-vous</label>
                                        <div v-if="isLoadingDates" class="loading-message">
                                            Chargement des dates disponibles...
                                        </div>
                                        <div v-else-if="availableDates.length === 0" class="no-slots-message">
                                            Aucune date disponible pour les 30 prochains jours.
                                        </div>
                                        <select v-else
                                            id="adminAppointmentDate" 
                                            v-model="adminAppointmentForm.date" 
                                            required>
                                            <option value="">S√©lectionnez une date</option>
                                            <option v-for="date in availableDates" 
                                                    :key="date" 
                                                    :value="date">
                                                {{ formatDateFr(date) }}
                                            </option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label>Heure du rendez-vous</label>
                                        <div v-if="displayedTimeSlots.length === 0" class="no-slots-message">
                                            Aucun cr√©neau disponible pour cette date.
                                        </div>
                                        <div v-else class="time-slots">
                                            <button v-for="slot in displayedTimeSlots" 
                                                 :key="slot"
                                                 type="button"
                                                 class="time-slot"
                                                 :class="{ 'selected': adminAppointmentForm.time === slot }"
                                                 @click="adminAppointmentForm.time = slot">
                                                {{ slot }}
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="adminAppointmentNotes">Notes</label>
                                        <textarea 
                                            id="adminAppointmentNotes" 
                                            v-model="adminAppointmentForm.notes" 
                                            rows="3">
                                        </textarea>
                                    </div>

                                    <div class="modal-actions">
                                        <button type="button" 
                                                class="btn secondary" 
                                                @click="cancelAdminAppointment">
                                            Annuler
                                        </button>
                                        <button type="submit" 
                                                class="btn primary">
                                            Confirmer le rendez-vous
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Cr√©neaux -->
                    <div v-if="adminActiveTab === 'slots'" class="admin-content">
                            <div class="slots-header">
                                <h2>Gestion des cr√©neaux horaires</h2>
                                <button class="btn primary" @click="showAddSlotModal = true">
                                    Ajouter un cr√©neau
                                </button>
                            </div>
                        <div>
                                <div class="calendar-header">
                                    <button class="btn secondary" @click="previousMonth">
                                        <
                                    </button>
                                    <h3>{{ currentMonthName }} {{ currentYear }}</h3>
                                    <button class="btn secondary" @click="nextMonth">
                                        >
                                    </button>
                                </div>
                                <div class="calendar-grid">
                                    <div class="calendar-weekday" v-for="day in weekDays" :key="day">
                                        {{ day }}
                                    </div>
                                    <div v-for="day in calendarDays" 
                                         :key="day.date"
                                         class="calendar-day"
                                         :class="{ 
                                             'today': isToday(day.date),
                                             'other-month': !isCurrentMonth(day.date),
                                             'has-slots': hasSlots(day.date)
                                         }"
                                         @click="selectDate(day.date)">
                                        {{ day.day }}
                                        <div class="day-slots" v-if="hasSlots(day.date)">
                                            {{ getSlotsCount(day.date) }} cr√©neau(s)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <div v-if="selectedDate">
                                <h3>Cr√©neaux du {{ formatDate(selectedDate) }}</h3>
                                <div class="slots-actions">
                                    <button class="btn primary" @click="showAddSlotModal = true">
                                        Ajouter un cr√©neau
                                    </button>
                                    <button class="btn secondary" @click="selectedDate = null">
                                        Fermer
                                    </button>
                                </div>
                                <div class="time-slots-grid">
                                    <div v-for="slot in getDateSlots(selectedDate)" 
                                         :key="slot.id"
                                         class="time-slot-card"
                                         :class="{ 'unavailable': slot.unavailable }">
                                        <div class="slot-time">{{ slot.time }}</div>
                                        <div class="slot-status">{{ slot.unavailable ? 'Indisponible' : 'Disponible' }}</div>
                                        <div class="slot-actions">
                                            <button class="btn-edit" @click="toggleSlotAvailability(slot)">
                                                {{ slot.unavailable ? 'Rendre disponible' : 'Rendre indisponible' }}
                                            </button>
                                            <button class="btn-delete" @click="deleteSlot(slot)">
                                                Supprimer
                                            </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Clients -->
                    <div v-if="adminActiveTab === 'clients'" class="admin-content">
                        <div class="admin-header-actions">
                        <div class="search-bar">
                            <input 
                                type="text" 
                                    v-model="clientsSearch" 
                                placeholder="Rechercher un client...">
                            </div>
                            <button class="btn primary" @click="showAddClientModal = true">
                                Nouveau client
                            </button>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>Email</th>
                                    <th>T√©l√©phone</th>
                                    <th>Temps de trajet</th>
                                    <th>Date d'inscription</th>
                                    <th>Nombre d'animaux</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="client in filteredClients" :key="client.id">
                                    <td>{{ client.lastName || 'N/A' }}</td>
                                    <td>{{ client.firstName || 'N/A' }}</td>
                                    <td>{{ client.email }}</td>
                                    <td>{{ client.phone || 'N/A' }}</td>
                                    <td>{{ client.travelTime || 'Non renseign√©' }}</td>
                                    <td>{{ formatDate(client.createdAt) }}</td>
                                    <td>{{ client.animalsCount }}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-view" @click="viewClientAnimals(client)">
                                                Voir les dossiers
                                            </button>
                                            <button class="btn-edit" @click="editClient(client)">
                                                Modifier
                                            </button>
                                            <button class="btn-delete" @click="deleteClient(client)">
                                                Supprimer
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr v-if="filteredClients.length === 0">
                                    <td colspan="8" class="text-center">Aucun client trouv√©</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Onglet Messages -->
                    <div v-if="adminActiveTab === 'messages'" class="admin-content">
                        <div class="search-bar">
                            <input 
                                type="text" 
                                v-model="messagesSearch" 
                                placeholder="Rechercher un message...">
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Message</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="message in filteredMessages" :key="message.id" :class="{ 'unread': message.status === 'unread' }">
                                    <td>{{ formatDate(message.createdAt) }}</td>
                                    <td>{{ message.name }}</td>
                                    <td>{{ message.email }}</td>
                                    <td>{{ message.message }}</td>
                                    <td>
                                        <span :class="['status-badge', message.status]">
                                            {{ message.status === 'unread' ? 'Non lu' : 'Lu' }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-view" @click="toggleMessageStatus(message)">
                                                {{ message.status === 'unread' ? 'Marquer comme lu' : 'Marquer comme non lu' }}
                                            </button>
                                            <button class="btn-delete" @click="deleteMessage(message)">
                                                Supprimer
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr v-if="filteredMessages.length === 0">
                                    <td colspan="6" class="text-center">Aucun message trouv√©</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </template>

            <!-- Page de profil client -->
            <template v-if="currentPage === 'profile'">
                <section class="profile-page">
                    <div class="profile-header">
                        <h1>Mon Profil</h1>
                        <p>G√©rez vos informations personnelles et votre mot de passe</p>
                    </div>

                    <div class="profile-content">
                        <div v-if="profileSuccess" class="success-message">
                            <h3>Profil mis √† jour avec succ√®s</h3>
                            <p>Vos informations ont √©t√© modifi√©es avec succ√®s.</p>
                        </div>
                        
                        <div v-if="profileError" class="error-message">
                            {{ profileError }}
                        </div>

                        <form @submit.prevent="updateProfile" class="profile-form">
                            <div class="profile-section">
                                <h3>Informations personnelles</h3>
                                
                                <div class="form-group">
                                    <label for="profileFirstName">Pr√©nom</label>
                                    <input type="text" id="profileFirstName" v-model="profileForm.firstName" required>
                                </div>

                                <div class="form-group">
                                    <label for="profileLastName">Nom</label>
                                    <input type="text" id="profileLastName" v-model="profileForm.lastName" required>
                                </div>

                                <div class="form-group">
                                    <label for="profileEmail">Email</label>
                                    <input type="email" id="profileEmail" v-model="profileForm.email" required>
                                </div>

                                <div class="form-group">
                                    <label for="profileAddress">Adresse compl√®te</label>
                                    <textarea id="profileAddress" v-model="profileForm.address" rows="3" required></textarea>
                                </div>
                            </div>

                            <div class="profile-section">
                                <h3>Modifier le mot de passe</h3>
                                <p class="password-info">Laissez vide si vous ne souhaitez pas changer votre mot de passe</p>
                                
                                <div class="form-group">
                                    <label for="profileCurrentPassword">Mot de passe actuel</label>
                                    <input type="password" id="profileCurrentPassword" v-model="profileForm.currentPassword">
                                </div>

                                <div class="form-group">
                                    <label for="profileNewPassword">Nouveau mot de passe</label>
                                    <input type="password" id="profileNewPassword" v-model="profileForm.newPassword" 
                                           :disabled="!profileForm.currentPassword">
                                </div>

                                <div class="form-group">
                                    <label for="profileConfirmPassword">Confirmer le nouveau mot de passe</label>
                                    <input type="password" id="profileConfirmPassword" v-model="profileForm.confirmPassword" 
                                           :disabled="!profileForm.currentPassword">
                                </div>
                            </div>

                            <div class="profile-actions">
                                <button type="submit" class="btn primary" :disabled="isUpdatingProfile">
                                    <span v-if="isUpdatingProfile">Mise √† jour...</span>
                                    <span v-else>Sauvegarder les modifications</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </template>

            <!-- Page Chien -->
            <template v-if="currentPage === 'chien'">
                <section class="animal-page chien-page">
                    <!-- Hero Section -->
                    <div class="animal-hero">
                        <div class="hero-background">
                            <img src="images/Carroussel2.JPG" alt="Th√©rapie pour chiens" class="hero-image">
                            <div class="hero-overlay"></div>
                        </div>
                        <div class="hero-content">
                            <h1>Th√©rapie Manuelle pour Chiens</h1>
                            <h2>SOULAGEMENT ET BIEN-√äTRE POUR VOTRE CHIEN</h2>
                            <p>Je propose des services de th√©rapie manuelle pour vos chiens de toute race et de tout √¢ge, quelque soit son activit√©.</p>
                        </div>
                    </div>

                    <!-- Avantages Section -->
                    <div class="advantages-section">
                        <div class="container">
                            <h2>Avantages de la th√©rapie manuelle pour votre chien</h2>
                            <div class="advantages-grid">
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü¶¥</div>
                                    <h4>Perte de mobilit√©, difficult√©s √† se lever ou √† sauter, boiterie</h4>
                                    <p>Am√©lioration de la mobilit√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üöë</div>
                                    <h4>Suites d'une chute, d'un choc ou d'un accident</h4>
                                    <p>R√©duction des douleurs et r√©cup√©ration</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üè•</div>
                                    <h4>Apr√®s une chirurgie, pour accompagner la r√©√©ducation</h4>
                                    <p>Acc√©l√©ration de la gu√©rison</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üõ°Ô∏è</div>
                                    <h4>Pr√©vention et entretien (pour tous les chiens)</h4>
                                    <p>Maintien de la sant√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                                    <h4>Optimisation des performances (pour les chiens sportifs)</h4>
                                    <p>Agility, canicross, chasse, etc.</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üêï‚Äçü¶∫</div>
                                    <h4>Chiots en croissance, pour v√©rifier un bon d√©veloppement ost√©o-articulaire</h4>
                                    <p>Pr√©vention des probl√®mes futurs</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üë¥</div>
                                    <h4>Aide au confort chez les chiens √¢g√©s</h4>
                                    <p>Am√©lioration de la qualit√© de vie</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü•ó</div>
                                    <h4>Conseils alimentaires</h4>
                                    <p>Choix de croquettes, ration m√©nag√®re, BARF, compl√©ments</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üåø</div>
                                    <h4>Conseils en phytoth√©rapie, aromath√©rapie, fleurs de Bach</h4>
                                    <p>Adapt√©s aux animaux</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pourquoi choisir Section -->
                    <div class="why-choose-section">
                        <div class="container">
                            <h2>Pourquoi choisir EMMY VASSE pour votre chien ?</h2>
                            <div class="why-choose-content">
                                <p>Chaque chien est unique, et c'est cette singularit√© qui guide chacune de mes s√©ances. J'utilise diff√©rentes techniques manuelles afin de m'adapter √† la sensibilit√© propre de votre compagnon et lui offrir un accompagnement √† la fois respectueux, personnalis√© et bienveillant.</p>
                                <p>Consciente que les chiens ressentent intens√©ment tout ce qui les entoure, je place leur √©quilibre √©motionnel au c≈ìur de mes soins pour favoriser leur bien-√™tre global.</p>
                                <p>Mon monitorat d'√©ducation canine me permet d'int√©grer une approche comportementale √† mes soins. Forte de mon exp√©rience aupr√®s des chiens de sport et d'utilit√©, j'ai d√©velopp√© une expertise en optimisation des performances et en pr√©vention des blessures, toujours dans le respect du rythme et des besoins de l'animal.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tarifs Section -->
                    <div class="pricing-section">
                        <div class="container">
                            <h2>TARIFS S√âANCES DE TH√âRAPIE MANUELLE</h2>
                            <div class="pricing-grid">
                                <div class="pricing-card featured">
                                    <h3>S√©ance de th√©rapie manuelle √† domicile</h3>
                                    <div class="price">50‚Ç¨</div>
                                    <p class="location">Hors frais de d√©placement</p>
                                    <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary">PRENDRE RENDEZ-VOUS</a>
                                </div>
                            </div>
                            <div class="pricing-info">
                                <h4>Frais de d√©placement</h4>
                                <p>Temps de route entre Thoirette et votre domicile :</p>
                                <ul>
                                    <li>Moins de 30 min ‚Üí Gratuit</li>
                                    <li>De 30 min √† 1h ‚Üí 7‚Ç¨</li>
                                    <li>De 1h √† 1h30 ‚Üí 12‚Ç¨</li>
                                    <li>Plus de 1h30 ‚Üí Sur devis</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="instructions-section">
                        <div class="container">
                            <div class="instructions-grid">
                                <div class="instruction-card">
                                    <h3>Avant la s√©ance</h3>
                                    <ul>
                                        <li>√âvitez les longues promenades 2h avant la consultation</li>
                                        <li>Ne donnez pas d'anti-inflammatoires 24h avant</li>
                                        <li>Pr√©parez un espace calme et confortable</li>
                                        <li>Apportez le carnet de sant√© si disponible</li>
                                    </ul>
                                </div>
                                <div class="instruction-card">
                                    <h3>Apr√®s la s√©ance</h3>
                                    <ul>
                                        <li>Repos complet pendant 24-48h</li>
                                        <li>√âvitez les exercices intenses pendant 1 semaine</li>
                                        <li>Surveillez le comportement et l'app√©tit</li>
                                        <li>Contactez-moi en cas de r√©action inhabituelle</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CTA Section -->
                    <div class="cta-section">
                        <div class="container">
                            <h2>R√©servez une s√©ance avec Emmy</h2>
                            <p>Contactez-moi d√®s aujourd'hui pour prendre rendez-vous et offrir √† votre animal les bienfaits de la th√©rapie manuelle. Ensemble, nous pouvons am√©liorer sa qualit√© de vie.</p>
                            <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary large">R√âSERVER UNE S√âANCE EN LIGNE</a>
                        </div>
                    </div>
                </section>
            </template>

            <!-- Page Chat -->
            <template v-if="currentPage === 'chat'">
                <section class="animal-page chat-page">
                    <!-- Hero Section -->
                    <div class="animal-hero">
                        <div class="hero-background">
                            <img src="images/Carroussel.jpg" alt="Th√©rapie pour chats" class="hero-image">
                            <div class="hero-overlay"></div>
                        </div>
                        <div class="hero-content">
                            <h1>Th√©rapie Manuelle pour Chats</h1>
                            <h2>SOULAGEMENT ET BIEN-√äTRE POUR VOTRE CHAT</h2>
                            <p>Je propose des services de th√©rapie manuelle pour vos chats et chatons de toute race et de tout √¢ge, adapt√©s √† leur sensibilit√© naturelle.</p>
                        </div>
                    </div>

                    <!-- Avantages Section -->
                    <div class="advantages-section">
                        <div class="container">
                            <h2>Avantages de la th√©rapie manuelle pour votre chat</h2>
                            <div class="advantages-grid">
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü¶¥</div>
                                    <h4>Perte de mobilit√©, difficult√©s √† se lever ou √† sauter, boiterie</h4>
                                    <p>Am√©lioration de la mobilit√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üöë</div>
                                    <h4>Suites d'une chute, d'un choc ou d'un accident</h4>
                                    <p>R√©duction des douleurs et r√©cup√©ration</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üè•</div>
                                    <h4>Apr√®s une chirurgie, pour accompagner la r√©√©ducation</h4>
                                    <p>Acc√©l√©ration de la gu√©rison</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üõ°Ô∏è</div>
                                    <h4>Pr√©vention et entretien (pour tous les chats)</h4>
                                    <p>Maintien de la sant√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                                    <h4>Optimisation des performances (pour les chats sportifs)</h4>
                                    <p>Agility, chasse, etc.</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üê±</div>
                                    <h4>Chatons en croissance, pour v√©rifier un bon d√©veloppement ost√©o-articulaire</h4>
                                    <p>Pr√©vention des probl√®mes futurs</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üë¥</div>
                                    <h4>Aide au confort chez les chats √¢g√©s</h4>
                                    <p>Am√©lioration de la qualit√© de vie</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü•ó</div>
                                    <h4>Conseils alimentaires</h4>
                                    <p>Choix de croquettes, ration m√©nag√®re, BARF, compl√©ments</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üåø</div>
                                    <h4>Conseils en phytoth√©rapie, aromath√©rapie, fleurs de Bach</h4>
                                    <p>Adapt√©s aux animaux</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pourquoi choisir Section -->
                    <div class="why-choose-section">
                        <div class="container">
                            <h2>Pourquoi choisir EMMY VASSE pour votre chat ?</h2>
                            <div class="why-choose-content">
                                <p>Les chats sont des √™tres sensibles et subtils, et chaque individu m√©rite une attention particuli√®re. Gr√¢ce √† ma douceur et √† mon exp√©rience, je m'adapte √† leur caract√®re et √† leur sensibilit√© pour leur offrir des soins respectueux et rassurants. J'utilise une grande diversit√© de techniques, choisies et modul√©es selon les besoins de chaque chat, afin de garantir un accompagnement personnalis√© et harmonieux. Mon objectif est toujours le m√™me : favoriser leur bien-√™tre global tout en respectant leur rythme, leur confiance et leur √©quilibre √©motionnel.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tarifs Section -->
                    <div class="pricing-section">
                        <div class="container">
                            <h2>TARIFS S√âANCES DE TH√âRAPIE MANUELLE</h2>
                            <div class="pricing-grid">
                                <div class="pricing-card featured">
                                    <h3>S√©ance de th√©rapie manuelle √† domicile</h3>
                                    <div class="price">50‚Ç¨</div>
                                    <p class="location">Hors frais de d√©placement</p>
                                    <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary">PRENDRE RENDEZ-VOUS</a>
                                </div>
                            </div>
                            <div class="pricing-info">
                                <h4>Frais de d√©placement</h4>
                                <p>Temps de route entre Thoirette et votre domicile :</p>
                                <ul>
                                    <li>Moins de 30 min ‚Üí Gratuit</li>
                                    <li>De 30 min √† 1h ‚Üí 7‚Ç¨</li>
                                    <li>De 1h √† 1h30 ‚Üí 12‚Ç¨</li>
                                    <li>Plus de 1h30 ‚Üí Sur devis</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="instructions-section">
                        <div class="container">
                            <div class="instructions-grid">
                                <div class="instruction-card">
                                    <h3>Avant la s√©ance</h3>
                                    <ul>
                                        <li>Cr√©ez un environnement calme et familier</li>
                                        <li>√âvitez les changements d'alimentation 24h avant</li>
                                        <li>Pr√©parez une couverture ou un coussin confortable</li>
                                        <li>Laissez le chat s'habituer √† l'espace</li>
                                    </ul>
                                </div>
                                <div class="instruction-card">
                                    <h3>Apr√®s la s√©ance</h3>
                                    <ul>
                                        <li>Repos dans un endroit calme pendant 24h</li>
                                        <li>√âvitez les interactions avec d'autres animaux</li>
                                        <li>Surveillez l'app√©tit et le comportement</li>
                                        <li>Respectez son besoin de tranquillit√©</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CTA Section -->
                    <div class="cta-section">
                        <div class="container">
                            <h2>R√©servez une s√©ance avec Emmy</h2>
                            <p>Contactez-moi d√®s aujourd'hui pour prendre rendez-vous et offrir √† votre chat les bienfaits de la th√©rapie manuelle. Ensemble, nous pouvons am√©liorer sa qualit√© de vie.</p>
                            <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary large">R√âSERVER UNE S√âANCE EN LIGNE</a>
                        </div>
                    </div>
                </section>
            </template>

            <!-- Page Cheval -->
            <template v-if="currentPage === 'cheval'">
                <section class="animal-page cheval-page">
                    <!-- Hero Section -->
                    <div class="animal-hero">
                        <div class="hero-background">
                            <img src="images/Carroussel4.JPG" alt="Th√©rapie pour chevaux" class="hero-image">
                            <div class="hero-overlay"></div>
                        </div>
                        <div class="hero-content">
                            <h1>Th√©rapie Manuelle pour Chevaux</h1>
                            <h2>OPTIMISATION DES PERFORMANCES ET BIEN-√äTRE √âQUIN</h2>
                            <p>Je propose des services de th√©rapie manuelle pour vos chevaux de toute race et de tout √¢ge, adapt√©s aux besoins sp√©cifiques de chaque √©quid√©.</p>
                        </div>
                    </div>

                    <!-- Avantages Section -->
                    <div class="advantages-section">
                        <div class="container">
                            <h2>Avantages de la th√©rapie manuelle pour votre cheval</h2>
                            <div class="advantages-grid">
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü¶¥</div>
                                    <h4>Perte de mobilit√©, difficult√©s √† se lever ou √† sauter, boiterie</h4>
                                    <p>Am√©lioration de la mobilit√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üöë</div>
                                    <h4>Suites d'une chute, d'un choc ou d'un accident</h4>
                                    <p>R√©duction des douleurs et r√©cup√©ration</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üè•</div>
                                    <h4>Apr√®s une chirurgie, pour accompagner la r√©√©ducation</h4>
                                    <p>Acc√©l√©ration de la gu√©rison</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üõ°Ô∏è</div>
                                    <h4>Pr√©vention et entretien (pour tous les chevaux)</h4>
                                    <p>Maintien de la sant√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                                    <h4>Optimisation des performances (pour les chevaux sportifs)</h4>
                                    <p>Dressage, saut d'obstacles, course, etc.</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üê¥</div>
                                    <h4>Poulains en croissance, pour v√©rifier un bon d√©veloppement ost√©o-articulaire</h4>
                                    <p>Pr√©vention des probl√®mes futurs</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üë¥</div>
                                    <h4>Aide au confort chez les chevaux √¢g√©s</h4>
                                    <p>Am√©lioration de la qualit√© de vie</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü•ó</div>
                                    <h4>Conseils alimentaires</h4>
                                    <p>Choix de fourrages, granul√©s, compl√©ments</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üåø</div>
                                    <h4>Conseils en phytoth√©rapie, aromath√©rapie, fleurs de Bach</h4>
                                    <p>Adapt√©s aux animaux</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pourquoi choisir Section -->
                    <div class="why-choose-section">
                        <div class="container">
                            <h2>Pourquoi choisir EMMY VASSE pour votre cheval ?</h2>
                            <div class="why-choose-content">
                                <p>Chaque cheval a sa personnalit√© et ses besoins, qui varient selon sa discipline et son mode de vie. C'est pourquoi j'adapte mes soins √† chaque individu, en choisissant parmi une grande vari√©t√© de techniques celles qui respectent sa sensibilit√© et soutiennent son confort. Que ce soit pour un cheval de sport ou loisir, mon objectif est toujours le m√™me : pr√©server son √©quilibre, optimiser ses performances et veiller √† son bien-√™tre global.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tarifs Section -->
                    <div class="pricing-section">
                        <div class="container">
                            <h2>TARIFS S√âANCES DE TH√âRAPIE MANUELLE</h2>
                            <div class="pricing-grid">
                                <div class="pricing-card featured">
                                    <h3>S√©ance de th√©rapie manuelle</h3>
                                    <div class="price">80‚Ç¨</div>
                                    <p class="location">Hors frais de d√©placement</p>
                                    <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary">PRENDRE RENDEZ-VOUS</a>
                                </div>
                            </div>
                            <div class="pricing-info">
                                <h4>Frais de d√©placement</h4>
                                <p>Temps de route entre Thoirette et votre domicile :</p>
                                <ul>
                                    <li>Moins de 30 min ‚Üí Gratuit</li>
                                    <li>De 30 min √† 1h ‚Üí 7‚Ç¨</li>
                                    <li>De 1h √† 1h30 ‚Üí 12‚Ç¨</li>
                                    <li>Plus de 1h30 ‚Üí Sur devis</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="instructions-section">
                        <div class="container">
                            <div class="instructions-grid">
                                <div class="instruction-card">
                                    <h3>Avant la s√©ance</h3>
                                    <ul>
                                        <li>Pas de travail intense 24h avant la consultation</li>
                                        <li>√âvitez les anti-inflammatoires 48h avant</li>
                                        <li>Pr√©parez un box ou un espace calme</li>
                                        <li>Le cheval doit √™tre propre et sec</li>
                                    </ul>
                                </div>
                                <div class="instruction-card">
                                    <h3>Apr√®s la s√©ance</h3>
                                    <ul>
                                        <li>Repos complet pendant 48-72h</li>
                                        <li>Reprise progressive du travail</li>
                                        <li>Surveillance de l'attitude et de l'app√©tit</li>
                                        <li>√âvitez les terrains difficiles pendant 1 semaine</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CTA Section -->
                    <div class="cta-section">
                        <div class="container">
                            <h2>R√©servez une s√©ance avec Emmy</h2>
                            <p>Contactez-moi d√®s aujourd'hui pour prendre rendez-vous et offrir √† votre cheval les bienfaits de la th√©rapie manuelle. Ensemble, nous pouvons am√©liorer ses performances et sa qualit√© de vie.</p>
                            <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary large">R√âSERVER UNE S√âANCE EN LIGNE</a>
                        </div>
                    </div>
                </section>
            </template>

            <!-- Page NAC -->
            <template v-if="currentPage === 'nac'">
                <section class="animal-page nac-page">
                    <!-- Hero Section -->
                    <div class="animal-hero">
                        <div class="hero-background">
                            <img src="images/Carroussel1.jpg" alt="Th√©rapie pour NAC" class="hero-image">
                            <div class="hero-overlay"></div>
                        </div>
                        <div class="hero-content">
                            <h1>Th√©rapie Manuelle pour NAC</h1>
                            <h2>SOINS SP√âCIALIS√âS POUR NOUVEAUX ANIMAUX DE COMPAGNIE</h2>
                            <p>Je propose des services de th√©rapie manuelle pour vos NAC (lapins, rongeurs, oiseaux...) de toute esp√®ce, adapt√©s √† leurs besoins sp√©cifiques.</p>
                        </div>
                    </div>

                    <!-- Avantages Section -->
                    <div class="advantages-section">
                        <div class="container">
                            <h2>Avantages de la th√©rapie manuelle pour votre NAC</h2>
                            <div class="advantages-grid">
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü¶¥</div>
                                    <h4>Perte de mobilit√©, difficult√©s √† se lever ou √† sauter, boiterie</h4>
                                    <p>Am√©lioration de la mobilit√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üöë</div>
                                    <h4>Suites d'une chute, d'un choc ou d'un accident</h4>
                                    <p>R√©duction des douleurs et r√©cup√©ration</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üõ°Ô∏è</div>
                                    <h4>Pr√©vention et entretien (pour tous les NAC)</h4>
                                    <p>Maintien de la sant√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üë¥</div>
                                    <h4>Aide au confort chez les NAC √¢g√©s</h4>
                                    <p>Am√©lioration de la qualit√© de vie</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü•ó</div>
                                    <h4>Conseils alimentaires</h4>
                                    <p>Choix de granul√©s, l√©gumes, compl√©ments</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üåø</div>
                                    <h4>Conseils en phytoth√©rapie, aromath√©rapie, fleurs de Bach</h4>
                                    <p>Adapt√©s aux animaux</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pourquoi choisir Section -->
                    <div class="why-choose-section">
                        <div class="container">
                            <h2>Pourquoi choisir EMMY VASSE pour votre NAC ?</h2>
                            <div class="why-choose-content">
                                <p>Les NAC (nouveaux animaux de compagnie) sont des √™tres d√©licats et souvent tr√®s sensibles, dont chaque esp√®ce et chaque individu a des besoins sp√©cifiques. Gr√¢ce √† mon exp√©rience et √† ma douceur, j'adapte mes soins √† leur physiologie, √† leur caract√®re et √† leur sensibilit√©. J'utilise une grande vari√©t√© de techniques, choisies et modul√©es selon l'animal, afin de lui offrir un accompagnement personnalis√© et respectueux. Mon objectif est de favoriser leur bien-√™tre global, tout en respectant leur rythme, leur confort et leur √©quilibre √©motionnel.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tarifs Section -->
                    <div class="pricing-section">
                        <div class="container">
                            <h2>TARIFS S√âANCES DE TH√âRAPIE MANUELLE</h2>
                            <div class="pricing-grid">
                                <div class="pricing-card featured">
                                    <h3>S√©ance de th√©rapie manuelle √† domicile</h3>
                                    <div class="price">50‚Ç¨</div>
                                    <p class="location">Hors frais de d√©placement</p>
                                    <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary">PRENDRE RENDEZ-VOUS</a>
                                </div>
                            </div>
                            <div class="pricing-info">
                                <h4>Frais de d√©placement</h4>
                                <p>Temps de route entre Thoirette et votre domicile :</p>
                                <ul>
                                    <li>Moins de 30 min ‚Üí Gratuit</li>
                                    <li>De 30 min √† 1h ‚Üí 7‚Ç¨</li>
                                    <li>De 1h √† 1h30 ‚Üí 12‚Ç¨</li>
                                    <li>Plus de 1h30 ‚Üí Sur devis</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="instructions-section">
                        <div class="container">
                            <div class="instructions-grid">
                                <div class="instruction-card">
                                    <h3>Avant la s√©ance</h3>
                                    <ul>
                                        <li>Cr√©ez un environnement calme et s√©curis√©</li>
                                        <li>√âvitez les changements d'habitat 24h avant</li>
                                        <li>Pr√©parez une cage ou un espace familier</li>
                                        <li>Laissez l'animal s'habituer √† votre pr√©sence</li>
                                    </ul>
                                </div>
                                <div class="instruction-card">
                                    <h3>Apr√®s la s√©ance</h3>
                                    <ul>
                                        <li>Repos dans son habitat habituel</li>
                                        <li>Surveillance attentive du comportement</li>
                                        <li>√âvitez les manipulations inutiles</li>
                                        <li>Contactez-moi en cas de changement notable</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CTA Section -->
                    <div class="cta-section">
                        <div class="container">
                            <h2>R√©servez une s√©ance avec Emmy</h2>
                            <p>Contactez-moi d√®s aujourd'hui pour prendre rendez-vous et offrir √† votre NAC les bienfaits de la th√©rapie manuelle. Ensemble, nous pouvons am√©liorer sa qualit√© de vie.</p>
                            <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary large">R√âSERVER UNE S√âANCE EN LIGNE</a>
                        </div>
                    </div>
                </section>
            </template>

            <!-- Page Bovins -->
            <template v-if="currentPage === 'bovins'">
                <section class="animal-page bovins-page">
                    <!-- Hero Section -->
                    <div class="animal-hero">
                        <div class="hero-background">
                            <img src="images/Carroussel5.JPG" alt="Th√©rapie pour bovins" class="hero-image">
                            <div class="hero-overlay"></div>
                        </div>
                        <div class="hero-content">
                            <h1>Th√©rapie Manuelle pour Bovins</h1>
                            <h2>OPTIMISATION DE LA PRODUCTION ET BIEN-√äTRE DU TROUPEAU</h2>
                            <p>Je propose des services de th√©rapie manuelle pour vos bovins de toute race et de tout √¢ge, adapt√©s aux besoins sp√©cifiques de chaque animal et de votre exploitation.</p>
                        </div>
                    </div>

                    <!-- Avantages Section -->
                    <div class="advantages-section">
                        <div class="container">
                            <h2>Avantages de la th√©rapie manuelle pour vos bovins</h2>
                            <div class="advantages-grid">
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü§±</div>
                                    <h4>Suites de v√™lage</h4>
                                    <p>Confort, r√©cup√©ration, pr√©vention des complications</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü¶¥</div>
                                    <h4>Perte de mobilit√©, raideurs, difficult√©s √† se relever</h4>
                                    <p>Am√©lioration de la mobilit√© articulaire</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üöë</div>
                                    <h4>Suites d'un traumatisme</h4>
                                    <p>Chute, choc, accident</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">ü•õ</div>
                                    <h4>Optimisation des performances laiti√®res ou de reproduction</h4>
                                    <p>Am√©lioration de la production</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üõ°Ô∏è</div>
                                    <h4>Pr√©vention et entretien du troupeau</h4>
                                    <p>Maintien de la sant√© du troupeau</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üêÑ</div>
                                    <h4>Veaux en croissance</h4>
                                    <p>D√©veloppement ost√©o-articulaire, digestion, difficult√©s √† t√©ter</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üåø</div>
                                    <h4>Utilisation raisonn√©e de la phytoth√©rapie, aromath√©rapie, fleurs de Bach</h4>
                                    <p>Adapt√©es aux bovins</p>
                                </div>
                                <div class="advantage-item">
                                    <div class="advantage-icon">üè•</div>
                                    <h4>Accompagnement doux des animaux convalescents</h4>
                                    <p>Toujours en compl√©ment du suivi v√©t√©rinaire</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pourquoi choisir Section -->
                    <div class="why-choose-section">
                        <div class="container">
                            <h2>Pourquoi choisir EMMY VASSE pour vos bovins ?</h2>
                            <div class="why-choose-content">
                                <p>Ayant grandi dans une exploitation de vaches laiti√®res, j'ai une connaissance concr√®te des besoins des agriculteurs et des contraintes li√©es √† leur quotidien. Cette exp√©rience me permet de comprendre leurs priorit√©s et d'adapter mes soins en cons√©quence. Chaque animal √©tant unique, j'utilise une diversit√© de techniques pour r√©pondre au mieux √† la sensibilit√© et aux besoins sp√©cifiques de chaque patient. Consciente des impr√©vus de l'√©levage, je propose √©galement des cr√©neaux d'urgence d√©di√©s, afin d'apporter un accompagnement r√©actif, respectueux et efficace, toujours au service du bien-√™tre des animaux et de la s√©r√©nit√© des √©leveurs.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tarifs Section -->
                    <div class="pricing-section">
                        <div class="container">
                            <h2>TARIFS S√âANCES DE TH√âRAPIE MANUELLE</h2>
                            <div class="pricing-grid">
                                <div class="pricing-card featured">
                                    <h3>Tarif : 60‚Ç¨ s√©ance classique<br>30‚Ç¨ s√©ance diagnostique</h3>
                                    <div class="price"></div>
                                    <p class="location"></p>
                                    <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary">PRENDRE RENDEZ-VOUS</a>
                                </div>
                            </div>
                            <div class="pricing-info">
                                <h4>Frais de d√©placement</h4>
                                <p>Temps de route entre Thoirette et votre domicile :</p>
                                <ul>
                                    <li>Moins de 30 min ‚Üí Gratuit</li>
                                    <li>De 30 min √† 1h ‚Üí 7‚Ç¨</li>
                                    <li>De 1h √† 1h30 ‚Üí 12‚Ç¨</li>
                                    <li>Plus de 1h30 ‚Üí Sur devis</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="instructions-section">
                        <div class="container">
                            <div class="instructions-grid">
                                <div class="instruction-card">
                                    <h3>Avant la s√©ance</h3>
                                    <ul>
                                        <li>Isolez l'animal dans un espace calme</li>
                                        <li>√âvitez les traitements m√©dicamenteux 24h avant</li>
                                        <li>Pr√©parez un espace de travail s√©curis√©</li>
                                        <li>V√©rifiez l'√©tat g√©n√©ral de l'animal</li>
                                    </ul>
                                </div>
                                <div class="instruction-card">
                                    <h3>Apr√®s la s√©ance</h3>
                                    <ul>
                                        <li>Repos dans un environnement calme</li>
                                        <li>Surveillance de l'app√©tit et du comportement</li>
                                        <li>√âvitez les manipulations inutiles</li>
                                        <li>Contactez-moi en cas de r√©action inhabituelle</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CTA Section -->
                    <div class="cta-section">
                        <div class="container">
                            <h2>R√©servez une s√©ance avec Emmy</h2>
                            <p>Contactez-moi d√®s aujourd'hui pour prendre rendez-vous et offrir √† vos bovins les bienfaits de la th√©rapie manuelle. Ensemble, nous pouvons am√©liorer la sant√© et les performances de votre troupeau.</p>
                            <a href="#" @click.prevent="navigateTo('appointment')" class="btn-primary large">R√âSERVER UNE S√âANCE EN LIGNE</a>
                        </div>
                    </div>
                </section>
            </template>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <p>&copy; 2025 Th√©rapeute manuelle. Tous droits r√©serv√©s.</p>
                </div>
                <div class="footer-section">
                    <a href="#" @click.prevent="currentPage = 'cgu'" class="footer-link">Conditions G√©n√©rales d'Utilisation</a>
                </div>
            </div>
        </footer>

        <!-- Bouton flottant du tutoriel -->
        <button class="tutorial-btn" @click="startTutorial" v-if="!showAuth && !isAdmin">
            <i>?</i>
        </button>

        <!-- Composant du tutoriel -->
        <template v-if="showTutorial && !isAdmin">
            <div class="tutorial-overlay" @click="skipTutorial"></div>
            <div class="tutorial-step" :style="currentTutorialStep.position">
                <h3>{{ currentTutorialStep.title }}</h3>
                <p>{{ currentTutorialStep.content }}</p>
                <div class="btn-group">
                    <button class="btn-skip" @click="skipTutorial">Passer</button>
                    <button class="btn-next" @click="nextTutorialStep" v-if="!isLastTutorialStep">
                        Suivant
                    </button>
                    <button class="btn-next" @click="skipTutorial" v-else>
                        Terminer
                    </button>
                </div>
            </div>
        </template>

        <!-- Modal d'authentification -->
        <div v-if="showAuth" class="auth-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
            <div class="auth-form">
                <!-- Formulaire de connexion -->
                <div v-if="!showContactInfo">
                    <h3>Connexion</h3>
                <input type="email" v-model="email" placeholder="Email">
                <input type="password" v-model="password" placeholder="Mot de passe">
                    <button class="primary" @click="login()">Se connecter</button>
                    <a href="#" @click.prevent="showContactInfo = true" class="contact-link">Pas encore de compte ?</a>
                    <button class="forgot-password" @click="showForgotPassword = true">Mot de passe oubli√© ?</button>
                <button class="close" @click="showAuth = false">Fermer</button>
                <p class="error" v-if="error">{{ error }}</p>
        </div>

                <!-- Informations de contact pour cr√©ation de compte -->
                <div v-if="showContactInfo" class="contact-info-section">
                    <div class="contact-info-header">
                        <h4>Comment cr√©er un compte ?</h4>
                        <button class="close-info" @click="showContactInfo = false">√ó</button>
                    </div>
                    <div class="contact-info-content">
                        <p>Pour cr√©er un compte et acc√©der aux fonctionnalit√©s du site, veuillez contacter Emmy Vasse :</p>
                        <div class="contact-details">
                            <div class="contact-item">
                                <strong>üìß Email :</strong>
                                <a href="mailto:emmy.vasse@example.com">emmy.vasse@example.com</a>
                    </div>
                            <div class="contact-item">
                                <strong>üìû T√©l√©phone :</strong>
                                <a href="tel:+33612345678">06 12 34 56 78</a>
                    </div>
                    </div>
                        <p class="contact-note">Emmy vous cr√©era un compte avec vos informations et vous transmettra vos identifiants de connexion.</p>
                    </div>
                    </div>
                    </div>
        </div>

        <!-- Modal de mot de passe oubli√© -->
        <div v-if="showForgotPassword" class="auth-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
            <div class="auth-form">
                <h3>Mot de passe oubli√©</h3>
                <p style="margin-bottom: 1rem; color: var(--text-color); font-size: 0.9rem;">
                    Entrez votre adresse email pour recevoir un lien de r√©initialisation.
                </p>
                <input type="email" v-model="forgotPasswordEmail" placeholder="Votre adresse email" required>
                <button class="primary" @click="sendPasswordResetEmail">Envoyer le lien</button>
                <button class="secondary" @click="showForgotPassword = false">Retour √† la connexion</button>
                <button class="close" @click="showForgotPassword = false">Fermer</button>
                <p class="error" v-if="forgotPasswordError">{{ forgotPasswordError }}</p>
                <p class="success" v-if="forgotPasswordSuccess">{{ forgotPasswordSuccess }}</p>
            </div>
        </div>

        <!-- Modal d'√©dition pour les rendez-vous -->
        <div v-if="showEditAppointmentModal" class="edit-modal">
            <div class="edit-modal-content">
                <h2>Modifier le rendez-vous</h2>
                <form @submit.prevent="updateAppointment">
                    <div class="edit-form-group">
                        <label for="editAppointmentDate">Date</label>
                        <input type="date" id="editAppointmentDate" v-model="editingAppointment.date" required>
                    </div>
                    <div class="edit-form-group">
                        <label>Heure</label>
                        <div class="time-slots">
                            <button v-for="slot in timeSlots" 
                                 :key="slot"
                                 type="button"
                                 class="time-slot"
                                 :class="{ 
                                     'selected': editingAppointment.time === slot,
                                     'unavailable': isTimeSlotUnavailable(slot) && editingAppointment.time !== slot
                                 }"
                                 @click="!isTimeSlotUnavailable(slot) && (editingAppointment.time = slot)">
                                {{ slot }}
                            </button>
                        </div>
                    </div>
                    <div class="edit-form-group">
                        <label for="editAppointmentPhone">Num√©ro de t√©l√©phone</label>
                        <input type="tel" id="editAppointmentPhone" v-model="editingAppointment.phone" 
                               pattern="[0-9]{10}" 
                               placeholder="0612345678" 
                               required>
                        <small style="color: var(--text-color); font-size: 0.8rem;">Format: 10 chiffres (ex: 0612345678)</small>
                    </div>
                    <div class="edit-form-group">
                        <label for="editAppointmentNotes">Notes</label>
                        <textarea id="editAppointmentNotes" v-model="editingAppointment.notes" rows="3"></textarea>
                    </div>
                    <div class="edit-modal-actions">
                        <button type="button" class="btn secondary" @click="showEditAppointmentModal = false">Annuler</button>
                        <button type="submit" class="btn primary">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal d'ajout de cr√©neau -->
        <div v-if="showAddSlotModal" class="edit-modal">
            <div class="edit-modal-content">
                <h2>{{ selectedDate ? 'Ajouter un cr√©neau' : 'Ajouter des cr√©neaux' }}</h2>
                <form @submit.prevent="addSlots">
                    <div class="edit-form-group">
                        <label for="slotTime">Heure</label>
                        <input type="time" id="slotTime" v-model="newSlot.time" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="slotDuration">Dur√©e (minutes)</label>
                        <select id="slotDuration" v-model="newSlot.duration" required>
                            <option value="30">30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">1 heure</option>
                            <option value="90">1 heure 30</option>
                            <option value="120">2 heures</option>
                        </select>
                    </div>
                    <div class="edit-form-group">
                        <label for="slotDate">Date de d√©but</label>
                        <input type="date" id="slotDate" v-model="newSlot.date" required 
                               :min="minDate">
                    </div>
                    <div class="edit-form-group">
                        <label for="slotRecurrence">R√©currence</label>
                        <select id="slotRecurrence" v-model="newSlot.recurrence">
                            <option value="none">Aucune</option>
                            <option value="daily">Tous les jours</option>
                            <option value="weekly">Toutes les semaines</option>
                            <option value="monthly">Tous les mois</option>
                        </select>
                    </div>
                    <div class="edit-form-group" v-if="newSlot.recurrence !== 'none'">
                        <label for="slotEndDate">Date de fin</label>
                        <input type="date" id="slotEndDate" v-model="newSlot.endDate" required
                               :min="newSlot.date">
                    </div>
                    <div class="edit-modal-actions">
                        <button type="button" class="btn secondary" @click="showAddSlotModal = false">Annuler</button>
                        <button type="submit" class="btn primary">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal d'√©dition pour les clients -->
        <div v-if="showEditClientModal" class="edit-modal">
            <div class="edit-modal-content">
                <h2>Modifier le client</h2>
                <form @submit.prevent="updateClient">
                    <div class="edit-form-group">
                        <label for="editClientFirstName">Pr√©nom</label>
                        <input type="text" id="editClientFirstName" v-model="editingClient.firstName" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="editClientLastName">Nom</label>
                        <input type="text" id="editClientLastName" v-model="editingClient.lastName" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="editClientEmail">Email</label>
                        <input type="email" id="editClientEmail" v-model="editingClient.email" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="editClientPhone">T√©l√©phone</label>
                        <input type="tel" id="editClientPhone" v-model="editingClient.phone" pattern="[0-9]{10}" placeholder="0612345678" required>
                        <small style="color: var(--text-color); font-size: 0.8rem;">Format: 10 chiffres (ex: 0612345678)</small>
                    </div>
                    <div class="edit-form-group">
                        <label for="editClientAddress">Adresse</label>
                        <textarea id="editClientAddress" v-model="editingClient.address" rows="3" required></textarea>
                    </div>
                    <div class="edit-form-group">
                        <label for="editClientTravelTime">Temps de trajet</label>
                        <input type="text" id="editClientTravelTime" v-model="editingClient.travelTime" placeholder="Ex: 15 minutes, 30 min, 1h, etc.">
                        <small style="color: var(--text-color); font-size: 0.8rem;">Temps estim√© pour se rendre chez ce client</small>
                    </div>
                    <div class="edit-modal-actions">
                        <button type="button" class="btn secondary" @click="showEditClientModal = false">Annuler</button>
                        <button type="submit" class="btn primary">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal d'ajout de client -->
        <div v-if="showAddClientModal" class="edit-modal">
            <div class="edit-modal-content">
                <h2>Nouveau client</h2>
                <form @submit.prevent="addClient">
                    <div class="edit-form-group">
                        <label for="newClientFirstName">Pr√©nom</label>
                        <input type="text" id="newClientFirstName" v-model="newClient.firstName" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="newClientLastName">Nom</label>
                        <input type="text" id="newClientLastName" v-model="newClient.lastName" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="newClientEmail">Email</label>
                        <input type="email" id="newClientEmail" v-model="newClient.email" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="newClientPhone">T√©l√©phone</label>
                        <input type="tel" id="newClientPhone" v-model="newClient.phone" pattern="[0-9]{10}" placeholder="0612345678" required>
                        <small style="color: var(--text-color); font-size: 0.8rem;">Format: 10 chiffres (ex: 0612345678)</small>
                    </div>
                    <div class="edit-form-group">
                        <label for="newClientAddress">Adresse compl√®te</label>
                        <textarea id="newClientAddress" v-model="newClient.address" rows="3" required></textarea>
                    </div>
                    <div class="edit-form-group">
                        <label for="newClientTravelTime">Temps de trajet</label>
                        <input type="text" id="newClientTravelTime" v-model="newClient.travelTime" placeholder="Ex: 15 minutes, 30 min, 1h, etc.">
                        <small style="color: var(--text-color); font-size: 0.8rem;">Temps estim√© pour se rendre chez ce client</small>
                    </div>
                    <div class="edit-form-group">
                        <label for="newClientPassword">Mot de passe</label>
                        <input type="text" id="newClientPassword" v-model="newClient.password" placeholder="Mot de passe pour le client" required>
                        <small style="color: var(--text-color); font-size: 0.8rem;">Mot de passe que le client utilisera pour se connecter</small>
                    </div>
                    <div class="edit-modal-actions">
                        <button type="button" class="btn secondary" @click="showAddClientModal = false">Annuler</button>
                        <button type="submit" class="btn primary">Cr√©er le client</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal pour voir les dossiers d'animaux d'un client -->
        <div v-if="showClientAnimalsModal" class="modal">
            <div class="modal-content" style="max-width: 900px;">
                <h2>Dossiers des animaux de {{ selectedClient ? (selectedClient.firstName + ' ' + selectedClient.lastName) : '' }}</h2>
                
                <div class="animals-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div v-for="animal in clientAnimals" :key="animal.id" class="animal-card" style="background: white; padding: 1rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s ease; cursor: pointer;" @mouseenter="$event.target.style.transform = 'translateY(-2px)'" @mouseleave="$event.target.style.transform = 'translateY(0)'">
                        <div class="animal-info">
                            <div v-if="animal.photos && animal.photos.length > 0" class="animal-photos-container" style="position: relative; margin-bottom: 0.8rem;">
                                <img :src="animal.photos[0]" :alt="animal.name" class="animal-photo" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 0;">
                                <div v-if="animal.photos.length > 1" class="photo-count-badge" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;">
                                    +{{ animal.photos.length - 1 }}
                            </div>
                            </div>
                            <div v-else-if="animal.photoBase64" class="animal-photo-container" style="margin-bottom: 0.8rem;">
                                <img :src="animal.photoBase64" :alt="animal.name" class="animal-photo" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px;">
                            </div>
                            <div v-else class="animal-photo placeholder" style="width: 100%; height: 120px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.8rem; border: 2px dashed #ccc;">
                                <span style="color: #666; font-size: 0.8rem;">Pas de photo</span>
                            </div>
                            <h3 style="margin: 0 0 0.8rem 0; color: var(--primary-color); font-size: 1.1rem; font-family: 'Playfair Display', serif;">{{ animal.name }}</h3>
                        </div>
                        <div class="animal-actions">
                            <button class="btn" @click="viewAnimalDetails(animal)" style="width: 100%; padding: 0.6rem; font-size: 0.9rem;">Voir le dossier</button>
                        </div>
                    </div>
                    <div v-if="clientAnimals.length === 0" class="no-animals" style="grid-column: 1/-1; text-align: center; padding: 2rem;">
                        <p>Ce client n'a pas encore d'animaux enregistr√©s.</p>
                    </div>
                </div>

                <div class="modal-actions" style="margin-top: 2rem;">
                    <button class="btn secondary" @click="showClientAnimalsModal = false">Fermer</button>
                </div>
            </div>
        </div>

        <!-- Modal d'ajout/modification d'article -->
        <div v-if="showAddPostModal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <h2>{{ editingPost ? 'Modifier l\'article' : 'Nouvel article' }}</h2>
                <form @submit.prevent="addBlogPost" class="blog-form">
                    <div class="form-group">
                        <label for="postTitle">Titre</label>
                        <input type="text" id="postTitle" v-model="newPost.title" required>
                    </div>
                    <div class="form-group">
                        <label for="postDate">Date de publication</label>
                        <input type="date" id="postDate" v-model="newPost.date" required>
                    </div>
                    <div class="form-group">
                        <label for="postImage">Image de l'article</label>
                        <input type="file" id="postImage" accept="image/*" @change="handleBlogImageUpload" :required="!editingPost">
                        <small style="color: var(--text-color); font-size: 0.8rem;">Format recommand√© : JPG, PNG (max 5MB){{ editingPost ? ' - Optionnel lors de la modification' : '' }}</small>
                        <div v-if="newPost.imagePreview" class="image-preview" style="margin-top: 1rem;">
                            <img :src="newPost.imagePreview" alt="Aper√ßu de l'image" style="max-width: 300px; max-height: 200px; object-fit: cover; border-radius: 8px;">
                            <button type="button" @click="removeBlogImage" class="btn-remove-photo" style="position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.8); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer;">√ó</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="postExcerpt">Extrait (r√©sum√© court)</label>
                        <textarea id="postExcerpt" v-model="newPost.excerpt" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="postContent">Contenu</label>
                        <textarea id="postContent" v-model="newPost.content" rows="10" required></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn secondary" @click="resetBlogForm(); showAddPostModal = false">Annuler</button>
                        <button type="submit" class="btn primary">{{ editingPost ? 'Mettre √† jour' : 'Publier' }}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const { createApp, watch } = Vue

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB9noXR2BudT0VMELFTvnjthCfTA4pxVgU",
            authDomain: "osteopatheanimalier-50728.firebaseapp.com",
            projectId: "osteopatheanimalier-50728",
            storageBucket: "osteopatheanimalier-50728.firebasestorage.app",
            messagingSenderId: "9417853053",
            appId: "1:9417853053:web:ee7ba42a04e8b6f27cc914",
            measurementId: "G-79QK6LZGNC"
        };

        // Initialisation de Firebase
        const app = firebase.initializeApp(firebaseConfig);
        
        // Configuration de Firestore avec gestion d'erreurs
        const db = firebase.firestore();
        
        // D√©sactiver le mode √©mulateur en production
        if (window.location.hostname === "localhost") {
            console.log("Mode d√©veloppement - Utilisation de l'√©mulateur Firestore");
            db.useEmulator("localhost", 8080);
        }

        // Configuration des param√®tres de Firestore
        db.settings({
            cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED,
            merge: true,
            ignoreUndefinedProperties: true
        });

        // Gestion des erreurs de connexion
        db.enablePersistence()
            .catch((err) => {
                if (err.code === 'failed-precondition') {
                    console.warn("Le mode hors ligne n'est pas disponible avec plusieurs onglets ouverts");
                } else if (err.code === 'unimplemented') {
                    console.warn("Le navigateur ne supporte pas le mode hors ligne");
                }
            });

        const functions = firebase.functions();

        createApp({
            data() {
                return {
                    currentPage: 'home',
                    message: 'Ost√©opathe Animalier',
                    email: '',
                    password: '',
                    firstName: '',
                    lastName: '',
                    phone: '',
                    address: '',
                    error: '',
                    // Donn√©es pour le mot de passe oubli√©
                    showForgotPassword: false,
                    forgotPasswordEmail: '',
                    forgotPasswordError: '',
                    forgotPasswordSuccess: '',
                    isAuthenticated: false,
                    userEmail: '',
                    showAuth: false,
                    showContactInfo: false,

                    isMenuOpen: false,
                    contactForm: {
                        name: '',
                        email: '',
                        message: ''
                    },
                    appointmentForm: {
                        consultationType: '',
                        animalType: '',
                        animalName: '',
                        date: '',
                        time: '',
                        notes: '',
                        phone: '',
                        selectedAnimalId: ''
                    },
                    appointmentSuccess: false,
                    appointmentError: '',
                    timeSlots: [
                        '09:00', '10:00', '11:00', '14:00', '15:00', '16:00', '17:00'
                    ],
                    availableSlots: [],
                    unavailableSlots: [],
                    animals: [],
                    showAddAnimalModal: false,
                    newAnimal: {
                        name: '',
                        species: '',
                        race: '',
                        birthdate: '',
                        birthdateType: 'exact',
                        birthdateApprox: '',
                        sterilization: false,
                        sterilizationDetails: '',
                        diet: '',
                        activity: '',
                        activityDetails: '',
                        medicalHistory: '',
                        treatment: '',
                        behavior: '',
                        notes: '',
                        photoUrl: '',
                        photoPreview: '',
                        photoBase64: null,
                        documents: [],
                        appointments: [],
                        travelTime: '' // Ajout du champ temps de trajet
                    },
                    unsubscribeAnimals: null,
                    isAdmin: false,
                    adminActiveTab: 'animals',
                    adminSearch: '',
                    animalsSearch: '',
                    appointmentsSearch: '',
                    clientsSearch: '',
                    messagesSearch: '',
                    allAnimals: [],
                    allAppointments: [],
                    userEmails: {},
                    showEditAppointmentModal: false,
                    editingAppointment: null,
                    currentMonth: new Date().getMonth(),
                    currentYear: new Date().getFullYear(),
                    selectedDate: null,
                    showAddSlotModal: false,
                    newSlot: {
                        time: '',
                        date: '',
                        duration: '60',
                        recurrence: 'none',
                        endDate: ''
                    },
                    weekDays: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
                    slots: [],
                    availableDates: [],
                    isLoadingDates: false,
                    unsubscribeSlots: null,
                    currentCarouselIndex: 0,
                    carouselInterval: null,
                    unsubscribeAppointments: null,
                    unsubscribeAdminSlots: null,
                    unsubscribeAvailableDates: null,
                    editingClient: null,
                    showEditClientModal: false,
                    showAddClientModal: false,
                    showClientAnimalsModal: false,
                    selectedClient: null,
                    clientAnimals: [],
                    messages: [],
                    unreadMessagesCount: 0,
                    unsubscribeMessages: null,
                    unsubscribeClients: null,
                    allClients: [], // Ajouter allClients dans data
                    clientsData: [], // Nouvelle propri√©t√© pour stocker les donn√©es brutes des clients
                    newClient: {
                        firstName: '',
                        lastName: '',
                        email: '',
                        phone: '',
                        address: '',
                        travelTime: '',
                        password: ''
                    },
                    // Propri√©t√©s pour les s√©lecteurs avec recherche
                    ownerSearch: '',
                    editOwnerSearch: '',
                    showOwnerDropdown: false,
                    // Donn√©es pour le tutoriel
                    showTutorial: false,
                    currentTutorialStepIndex: 0,
                    tutorialSteps: [
                        {
                            title: "Bienvenue !",
                            content: "Je vais vous guider √† travers les principales fonctionnalit√©s de l'application pour g√©rer vos animaux et prendre rendez-vous.",
                            position: {
                                top: '50%',
                                left: '50%',
                                transform: 'translate(-50%, -50%)'
                            }
                        },
                        {
                            title: "Connexion/D√©connexion",
                            content: "Pour commencer, connectez-vous ou cr√©ez un compte en cliquant sur 'Connexion' dans le menu. Vous pourrez ensuite vous d√©connecter via le m√™me bouton.",
                            position: {
                                top: '80px',
                                right: '20px'
                            }
                        },
                        {
                            title: "Dossier de vos animaux",
                            content: "Acc√©dez √† votre dossier animaux pour voir les fiches de soin de vos compagnons et leur historique de traitements.",
                            position: {
                                top: '80px',
                                right: '20px'
                            }
                        },
                        {
                            title: "Contacter Emmy VASSE",
                            content: "Pour ajouter le dossier de votre animal sur votre compte et garantir son suivi, contactez Emmy VASSE directement.",
                            position: {
                                top: '80px',
                                right: '20px'
                            }
                        },
                        {
                            title: "Prendre rendez-vous",
                            content: "Prenez rendez-vous pour votre animal en quelques clics. S√©lectionnez la date et l'heure qui vous conviennent.",
                            position: {
                                top: '80px',
                                right: '20px'
                            }
                        },
                        {
                            title: "Profil",
                            content: "G√©rez vos informations de compte et changez votre mot de passe dans votre profil.",
                            position: {
                                top: '80px',
                                right: '20px'
                            }
                        }
                    ],
                    isMobile: window.innerWidth <= 768,
                    blogPosts: [],
                    showAddPostModal: false,
                    newPost: {
                        title: '',
                        content: '',
                        excerpt: '',
                        imageUrl: '',
                        imagePreview: '',
                        imageBase64: '',
                        date: new Date().toISOString().split('T')[0]
                    },
                    unsubscribeBlogPosts: null,
                    editingPost: null,
                    appointmentsView: 'list',
                    sortField: 'date',
                    sortOrder: 'asc',
                    showAdminNewAppointmentModal: false,
                    adminAppointmentForm: {
                        userId: '',
                        selectedAnimalId: '',
                        phone: '',
                        date: '',
                        time: '',
                        notes: ''
                    },
                    // Donn√©es pour la page de profil
                    profileForm: {
                        firstName: '',
                        lastName: '',
                        email: '',
                        address: '',
                        currentPassword: '',
                        newPassword: '',
                        confirmPassword: ''
                    },
                    profileSuccess: false,
                    profileError: '',
                    isUpdatingProfile: false
                }
            },
            computed: {
                minDate() {
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    return tomorrow.toISOString().split('T')[0];
                },
                maxDate() {
                    const max = new Date();
                    max.setDate(max.getDate() + 30);
                    return max.toISOString().split('T')[0];
                },
                filteredAnimals() {
                    if (!this.animalsSearch) return this.allAnimals;
                    const search = this.animalsSearch.toLowerCase();
                    return this.allAnimals.filter(animal => 
                        (animal.name || '').toLowerCase().includes(search) ||
                        (animal.species || '').toLowerCase().includes(search) ||
                        (this.getUserFullName(animal.userId) || '').toLowerCase().includes(search)
                    );
                },
                filteredAppointments() {
                    if (!this.appointmentsSearch) return this.allAppointments;
                    const search = this.appointmentsSearch.toLowerCase();
                    return this.allAppointments.filter(apt => 
                        (apt.animalName || '').toLowerCase().includes(search) ||
                        (this.getUserFullName(apt.userId) || '').toLowerCase().includes(search)
                    );
                },
                currentMonthName() {
                    return new Date(this.currentYear, this.currentMonth).toLocaleString('fr-FR', { month: 'long' });
                },
                calendarDays() {
                    const firstDay = new Date(this.currentYear, this.currentMonth, 1);
                    const lastDay = new Date(this.currentYear, this.currentMonth + 1, 0);
                    const days = [];
                    
                    // Ajouter les jours du mois pr√©c√©dent
                    const prevMonthDays = firstDay.getDay();
                    const prevMonth = new Date(this.currentYear, this.currentMonth, 0);
                    for (let i = prevMonthDays - 1; i >= 0; i--) {
                        days.push({
                            date: new Date(this.currentYear, this.currentMonth - 1, prevMonth.getDate() - i),
                            day: prevMonth.getDate() - i,
                            isCurrentMonth: false
                        });
                    }
                    
                    // Ajouter les jours du mois courant
                    for (let i = 1; i <= lastDay.getDate(); i++) {
                        days.push({
                            date: new Date(this.currentYear, this.currentMonth, i),
                            day: i,
                            isCurrentMonth: true
                        });
                    }
                    
                    // Ajouter les jours du mois suivant
                    const nextMonthDays = 42 - days.length; // 6 semaines * 7 jours
                    for (let i = 1; i <= nextMonthDays; i++) {
                        days.push({
                            date: new Date(this.currentYear, this.currentMonth + 1, i),
                            day: i,
                            isCurrentMonth: false
                        });
                    }
                    
                    return days;
                },
                displayedTimeSlots() {
                    // Utiliser la date du formulaire actif (admin ou client)
                    const selectedDate = this.adminAppointmentForm.date || this.appointmentForm.date;
                    if (!selectedDate) return [];
                    
                    // Retourner les cr√©neaux disponibles pour la date s√©lectionn√©e
                    return this.availableSlots || [];
                },
                filteredMessages() {
                    if (!this.messagesSearch) return this.messages;
                    const search = this.messagesSearch.toLowerCase();
                    return this.messages.filter(message => 
                        message.name.toLowerCase().includes(search) ||
                        message.email.toLowerCase().includes(search) ||
                        message.message.toLowerCase().includes(search)
                    );
                },
                filteredClients() {
                    if (!this.clientsSearch) return this.allClients;
                    const search = this.clientsSearch.toLowerCase();
                    return this.allClients.filter(client => 
                        (client.lastName || '').toLowerCase().includes(search) ||
                        (client.firstName || '').toLowerCase().includes(search) ||
                        client.email.toLowerCase().includes(search) ||
                        (client.phone || '').toLowerCase().includes(search)
                    );
                },
                filteredOwnerClients() {
                    if (!this.ownerSearch) return this.allClients;
                    const search = this.ownerSearch.toLowerCase();
                    return this.allClients.filter(client => 
                        (client.lastName || '').toLowerCase().includes(search) ||
                        (client.firstName || '').toLowerCase().includes(search) ||
                        client.email.toLowerCase().includes(search) ||
                        (client.phone || '').toLowerCase().includes(search)
                    );
                },
                getClientAnimalsCount() {
                    return (clientId) => {
                        return this.allAnimals.filter(animal => animal.userId === clientId).length;
                    };
                },
                currentTutorialStep() {
                    return this.tutorialSteps[this.currentTutorialStepIndex];
                },
                isLastTutorialStep() {
                    return this.currentTutorialStepIndex === this.tutorialSteps.length - 1;
                },
                hasAppointments() {
                    return (date) => {
                        return this.allAppointments.some(appointment => {
                            const appointmentDate = new Date(appointment.date);
                            return appointmentDate.toDateString() === date.toDateString();
                        });
                    };
                },
                getAppointmentsCount() {
                    return (date) => {
                        return this.allAppointments.filter(appointment => {
                            const appointmentDate = new Date(appointment.date);
                            return appointmentDate.toDateString() === date.toDateString();
                        }).length;
                    };
                },
                getDayAppointments() {
                    return (date) => {
                        return this.allAppointments
                            .filter(appointment => {
                                const appointmentDate = new Date(appointment.date);
                                return appointmentDate.toDateString() === date.toDateString();
                            })
                            .sort((a, b) => {
                                // Convertir les heures en minutes pour faciliter la comparaison
                                const timeA = a.time.split(':').map(Number);
                                const timeB = b.time.split(':').map(Number);
                                const minutesA = timeA[0] * 60 + timeA[1];
                                const minutesB = timeB[0] * 60 + timeB[1];
                                return minutesA - minutesB;
                            });
                    };
                },
                sortedAppointments() {
                    return this.filteredAppointments.slice().sort((a, b) => {
                        if (this.sortOrder === 'asc') {
                            return new Date(a.date) - new Date(b.date);
                        } else {
                            return new Date(b.date) - new Date(a.date);
                        }
                    });
                }
            },
            watch: {
                'appointmentForm.date': {
                    immediate: true,
                    async handler(newDate) {
                        if (newDate) {
                            await this.loadUnavailableSlots();
                        }
                    }
                },
                'adminAppointmentForm.date': {
                    immediate: true,
                    async handler(newDate) {
                        if (newDate) {
                            await this.loadUnavailableSlots();
                        }
                    }
                },
                'newAnimal.sterilization': {
                    handler(newValue) {
                        // G√©rer l'affichage du champ de d√©tails de st√©rilisation
                        this.$nextTick(() => {
                            const detailsField = document.getElementById('newAnimalSterilizationDetails');
                            if (detailsField) {
                                const parentGroup = detailsField.closest('.form-group');
                                if (parentGroup) {
                                    parentGroup.style.display = newValue ? 'block' : 'none';
                                }
                            }
                        });
                    }
                },
                currentPage() {
                    setTimeout(() => {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 100);
                    
                    // Recharger les cr√©neaux si on va sur la page de rendez-vous
                    if (this.currentPage === 'appointment' && this.isAuthenticated) {
                        setTimeout(() => {
                            this.loadAvailableDates();
                        }, 200);
                    }
                },
                adminActiveTab() {
                    // Recharger les cr√©neaux quand on va sur l'onglet Cr√©neaux
                    if (this.adminActiveTab === 'slots' && this.isAdmin) {
                        setTimeout(() => {
                            this.loadSlots();
                        }, 100);
                    }
                },
            },
            methods: {
                    // Fonction pour traduire les erreurs Firebase
                    translateFirebaseError(error) {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        
                        // Traductions des erreurs Firebase les plus courantes
                        const translations = {
                            // Erreurs d'authentification
                            'auth/user-not-found': 'Aucun compte trouv√© avec cet email.',
                            'auth/wrong-password': 'Mot de passe incorrect.',
                            'auth/invalid-login-credentials': 'Email ou mot de passe incorrect.',
                            'auth/invalid-email': 'Adresse email invalide.',
                            'auth/user-disabled': 'Ce compte a √©t√© d√©sactiv√©.',
                            'auth/too-many-requests': 'Trop de tentatives. Veuillez r√©essayer plus tard.',
                            'auth/operation-not-allowed': 'Cette op√©ration n\'est pas autoris√©e.',
                            
                            // Erreurs d'inscription
                            'auth/email-already-in-use': 'Cette adresse email est d√©j√† utilis√©e.',
                            'auth/weak-password': 'Le mot de passe doit contenir au moins 6 caract√®res.',
                            'auth/invalid-password': 'Le mot de passe ne respecte pas les crit√®res de s√©curit√©.',
                            
                            // Erreurs g√©n√©rales
                            'auth/network-request-failed': 'Erreur de connexion r√©seau. V√©rifiez votre connexion internet.',
                            'auth/internal-error': 'Erreur interne. Veuillez r√©essayer.',
                            'auth/invalid-credential': 'Identifiants invalides.',
                            'auth/account-exists-with-different-credential': 'Un compte existe d√©j√† avec ces identifiants.',
                            'auth/requires-recent-login': 'Cette action n√©cessite une reconnexion r√©cente.',
                            'auth/credential-already-in-use': 'Ces identifiants sont d√©j√† utilis√©s.',
                            'auth/operation-not-supported-in-this-environment': 'Cette op√©ration n\'est pas support√©e dans cet environnement.',
                            'auth/timeout': 'D√©lai d\'attente d√©pass√©. Veuillez r√©essayer.',
                            'auth/network-request-failed': 'Erreur de r√©seau. V√©rifiez votre connexion.',
                            'auth/quota-exceeded': 'Quota d√©pass√©. Veuillez r√©essayer plus tard.',
                            'auth/unavailable': 'Service temporairement indisponible. Veuillez r√©essayer.',
                            'auth/argument-error': 'Erreur de param√®tre.',
                            'auth/invalid-verification-code': 'Code de v√©rification invalide.',
                            'auth/invalid-verification-id': 'ID de v√©rification invalide.',
                            'auth/missing-verification-code': 'Code de v√©rification manquant.',
                            'auth/missing-verification-id': 'ID de v√©rification manquant.',
                            'auth/code-expired': 'Code expir√©. Veuillez demander un nouveau code.',
                            'auth/invalid-phone-number': 'Num√©ro de t√©l√©phone invalide.',
                            'auth/missing-phone-number': 'Num√©ro de t√©l√©phone manquant.',
                            'auth/quota-exceeded': 'Limite de requ√™tes d√©pass√©e. Veuillez r√©essayer plus tard.',
                            'auth/captcha-check-failed': 'V√©rification CAPTCHA √©chou√©e.',
                            'auth/invalid-app-credential': 'Identifiants d\'application invalides.',
                            'auth/invalid-app-id': 'ID d\'application invalide.',
                            'auth/invalid-user-token': 'Token utilisateur invalide.',
                            'auth/invalid-tenant-id': 'ID de locataire invalide.',
                            'auth/unauthorized-continue-uri': 'URI de continuation non autoris√©e.',
                            'auth/invalid-dynamic-link-domain': 'Domaine de lien dynamique invalide.',
                            'auth/argument-error': 'Erreur d\'argument.',
                            'auth/invalid-persistence-type': 'Type de persistance invalide.',
                            'auth/unsupported-persistence-type': 'Type de persistance non support√©.',
                            'auth/invalid-credential': 'Identifiants invalides.',
                            'auth/account-exists-with-different-credential': 'Un compte existe d√©j√† avec ces identifiants.',
                            'auth/requires-recent-login': 'Cette action n√©cessite une reconnexion r√©cente.',
                            'auth/credential-already-in-use': 'Ces identifiants sont d√©j√† utilis√©s.',
                            'auth/operation-not-supported-in-this-environment': 'Cette op√©ration n\'est pas support√©e dans cet environnement.',
                            'auth/timeout': 'D√©lai d\'attente d√©pass√©. Veuillez r√©essayer.',
                            'auth/network-request-failed': 'Erreur de r√©seau. V√©rifiez votre connexion.',
                            'auth/quota-exceeded': 'Quota d√©pass√©. Veuillez r√©essayer plus tard.',
                            'auth/unavailable': 'Service temporairement indisponible. Veuillez r√©essayer.',
                            'auth/argument-error': 'Erreur de param√®tre.',
                            'auth/invalid-verification-code': 'Code de v√©rification invalide.',
                            'auth/invalid-verification-id': 'ID de v√©rification invalide.',
                            'auth/missing-verification-code': 'Code de v√©rification manquant.',
                            'auth/missing-verification-id': 'ID de v√©rification manquant.',
                            'auth/code-expired': 'Code expir√©. Veuillez demander un nouveau code.',
                            'auth/invalid-phone-number': 'Num√©ro de t√©l√©phone invalide.',
                            'auth/missing-phone-number': 'Num√©ro de t√©l√©phone manquant.',
                            'auth/quota-exceeded': 'Limite de requ√™tes d√©pass√©e. Veuillez r√©essayer plus tard.',
                            'auth/captcha-check-failed': 'V√©rification CAPTCHA √©chou√©e.',
                            'auth/invalid-app-credential': 'Identifiants d\'application invalides.',
                            'auth/invalid-app-id': 'ID d\'application invalide.',
                            'auth/invalid-user-token': 'Token utilisateur invalide.',
                            'auth/invalid-tenant-id': 'ID de locataire invalide.',
                            'auth/unauthorized-continue-uri': 'URI de continuation non autoris√©e.',
                            'auth/invalid-dynamic-link-domain': 'Domaine de lien dynamique invalide.',
                            'auth/argument-error': 'Erreur d\'argument.',
                            'auth/invalid-persistence-type': 'Type de persistance invalide.',
                            'auth/unsupported-persistence-type': 'Type de persistance non support√©.'
                        };
                        
                        // Retourner la traduction si elle existe, sinon le message original
                        return translations[errorCode] || errorMessage || 'Une erreur inattendue s\'est produite.';
                    },
                    // M√©thodes pour le carrousel
                    nextCarouselImage() {
                        this.currentCarouselIndex = (this.currentCarouselIndex + 1) % 8;
                    },
                    prevCarouselImage() {
                        this.currentCarouselIndex = this.currentCarouselIndex === 0 ? 7 : this.currentCarouselIndex - 1;
                    },
                    goToCarouselImage(index) {
                        this.currentCarouselIndex = index;
                    },
                    startCarouselAutoPlay() {
                        this.carouselInterval = setInterval(() => {
                            this.nextCarouselImage();
                        }, 4000); // Change d'image toutes les 4 secondes
                    },
                    stopCarouselAutoPlay() {
                        if (this.carouselInterval) {
                            clearInterval(this.carouselInterval);
                            this.carouselInterval = null;
                        }
                    },
                    toggleSterilizationDetails() {
                        // Cette m√©thode est appel√©e par les boutons radio dans le formulaire de cr√©ation
                        // Le v-show g√®re automatiquement l'affichage selon newAnimal.sterilization
                    },
                    handleBirthdateTypeChange() {
                        // R√©initialiser les valeurs quand on change de type
                        if (this.newAnimal.birthdateType === 'exact') {
                            this.newAnimal.birthdateApprox = '';
                        } else {
                            this.newAnimal.birthdate = '';
                        }
                    },
                    selectOwner(client) {
                        this.newAnimal.userId = client.id;
                        this.ownerSearch = `${client.firstName} ${client.lastName}`;
                        this.showOwnerDropdown = false;
                    },
                    clearOwnerSelection() {
                        this.newAnimal.userId = '';
                        this.ownerSearch = '';
                    },
                    getSelectedOwnerName() {
                        if (!this.newAnimal.userId) return '';
                        const client = this.allClients.find(c => c.id === this.newAnimal.userId);
                        return client ? `${client.firstName} ${client.lastName} (${client.email})` : '';
                    },
                    getSelectedOwnerNameForEdit(animal) {
                        if (!animal.userId) return '';
                        const client = this.allClients.find(c => c.id === animal.userId);
                        return client ? `${client.firstName} ${client.lastName} (${client.email})` : '';
                    },
                    async sendPasswordResetEmail() {
                        try {
                            // R√©initialiser les messages
                            this.forgotPasswordError = '';
                            this.forgotPasswordSuccess = '';
                            
                            // Valider l'email
                            if (!this.forgotPasswordEmail) {
                                this.forgotPasswordError = 'Veuillez saisir votre adresse email';
                                return;
                            }
                            
                            // Envoyer l'email de r√©initialisation
                            await firebase.auth().sendPasswordResetEmail(this.forgotPasswordEmail);
                            
                            // Message de succ√®s
                            this.forgotPasswordSuccess = 'Un email de r√©initialisation a √©t√© envoy√© √† votre adresse. V√©rifiez votre bo√Æte de r√©ception et vos spams.';
                            
                            // R√©initialiser le champ email
                            this.forgotPasswordEmail = '';
                            
                            // Fermer la modal apr√®s 3 secondes
                            setTimeout(() => {
                                this.showForgotPassword = false;
                                this.forgotPasswordSuccess = '';
                            }, 3000);
                            
                        } catch (error) {
                            console.error('Error sending password reset email:', error);
                            
                            // Traduire les erreurs Firebase
                            let errorMessage = 'Une erreur est survenue lors de l\'envoi de l\'email';
                            
                            switch (error.code) {
                                case 'auth/user-not-found':
                                    errorMessage = 'Aucun compte trouv√© avec cette adresse email';
                                    break;
                                case 'auth/invalid-email':
                                    errorMessage = 'Adresse email invalide';
                                    break;
                                case 'auth/too-many-requests':
                                    errorMessage = 'Trop de tentatives. Veuillez r√©essayer plus tard';
                                    break;
                                default:
                                    errorMessage = 'Erreur lors de l\'envoi de l\'email de r√©initialisation';
                            }
                            
                            this.forgotPasswordError = errorMessage;
                        }
                    },
                toggleMenu() {
                    this.isMenuOpen = !this.isMenuOpen;
                },
                closeMenu() {
                    this.isMenuOpen = false;
                },
                async login() {
                    try {
                        const userCredential = await firebase.auth().signInWithEmailAndPassword(this.email, this.password);
                        
                        // Liste des IDs administrateurs
                        const adminIds = ['4tYIuGIeMMMG7Wbv6OXjkeKOURI3', 'Rdzwjl02KwaNdgbISONjs0rPBQy1'];
                        
                        // V√©rifier si le document utilisateur existe, sinon le cr√©er
                        const userDoc = await db.collection('users').doc(userCredential.user.uid).get();
                        if (!userDoc.exists) {
                            await db.collection('users').doc(userCredential.user.uid).set({
                                email: userCredential.user.email,
                                role: adminIds.includes(userCredential.user.uid) ? 'admin' : 'user',
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }

                        this.isAuthenticated = true;
                        this.userEmail = userCredential.user.email;
                        this.error = '';
                        this.showAuth = false;

                        // V√©rifier si l'utilisateur est admin
                        await this.checkAdminStatus();
                    } catch (error) {
                        this.error = this.translateFirebaseError(error);
                    }
                },

                // M√©thode pour mettre √† jour l'affichage des photos
                updatePhotosDisplay(modal, photos) {
                    const photosGrid = modal.querySelector('.photos-grid');
                    if (photosGrid) {
                        if (photos.length > 0) {
                            photosGrid.innerHTML = photos.map((photo, index) => `
                                <div class="photo-item">
                                    <img src="${photo}" alt="Photo de l'animal" class="animal-photo">
                                    <button type="button" class="btn-remove-photo" data-index="${index}">√ó</button>
                                </div>
                            `).join('');
                            
                            // Ajouter les gestionnaires d'√©v√©nements pour les boutons de suppression
                            const removeButtons = photosGrid.querySelectorAll('.btn-remove-photo');
                            removeButtons.forEach(button => {
                                button.addEventListener('click', (e) => {
                                    e.preventDefault();
                                    const index = parseInt(button.getAttribute('data-index'));
                                    // D√©clencher l'√©v√©nement de suppression
                                    modal.dispatchEvent(new CustomEvent('delete-photo', { detail: index }));
                                });
                            });
                        } else {
                            photosGrid.innerHTML = '<p>Aucune photo</p>';
                        }
                    }
                },
                async logout() {
                    try {
                        // Nettoyer l'abonnement aux mises √† jour en temps r√©el
                        if (this.unsubscribeAnimals) {
                            this.unsubscribeAnimals();
                            this.unsubscribeAnimals = null;
                        }
                        if (this.unsubscribeClients) {
                            this.unsubscribeClients();
                            this.unsubscribeClients = null;
                        }
                        
                        // R√©initialiser les donn√©es
                        this.animals = [];
                        this.isAuthenticated = false;
                        this.isAdmin = false;
                        this.userEmail = '';
                        this.email = '';
                        this.password = '';
                        
                        // Cacher le bouton de notification
                        const bellContainer = document.querySelector('#onesignal-bell-container');
                        if (bellContainer) {
                            bellContainer.classList.remove('show-bell');
                        }
                        
                        // Attendre un court instant pour s'assurer que les donn√©es sont nettoy√©es
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                        // Effectuer la d√©connexion
                        await firebase.auth().signOut();
                        
                        // Rediriger vers la page d'accueil
                        window.location.hash = '';
                        this.currentPage = 'home';
                    } catch (error) {
                        console.error('Error during logout:', error);
                        this.error = this.translateFirebaseError(error);
                    }
                },
                async sendMessage() {
                    // V√©rification des champs requis
                    if (!this.contactForm.name || !this.contactForm.email || !this.contactForm.message) {
                        alert('Veuillez remplir tous les champs du formulaire.');
                        return;
                    }

                    // V√©rification basique du format email
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(this.contactForm.email)) {
                        alert('Veuillez entrer une adresse email valide.');
                        return;
                    }

                    try {
                        const messageData = {
                            name: this.contactForm.name,
                            email: this.contactForm.email,
                            message: this.contactForm.message,
                            status: 'unread',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            userId: firebase.auth().currentUser ? firebase.auth().currentUser.uid : null
                        };

                        // Sauvegarder le message dans Firebase
                        const messageRef = await db.collection('contact_messages').add(messageData);

                        // Envoyer une notification aux administrateurs via OneSignal
                        const notificationData = {
                            app_id: "c1dcb08f-cad7-4f3e-be08-b45671fbde82",
                            contents: {
                                en: `Nouveau message de ${this.contactForm.name}`,
                                fr: `Nouveau message de ${this.contactForm.name}`
                            },
                            headings: {
                                en: "üìß Nouveau message de contact",
                                fr: "üìß Nouveau message de contact"
                            },
                            subtitle: {
                                en: `Email: ${this.contactForm.email}`,
                                fr: `Email: ${this.contactForm.email}`
                            },
                            url: window.location.origin + "/#admin", // Lien vers la section admin
                            // Envoyer √† TOUS les administrateurs via les tags
                            filters: [
                                {"field": "tag", "key": "role", "relation": "=", "value": "admin"}
                            ],
                            // Ajouter des donn√©es personnalis√©es
                            data: {
                                type: "contact_message",
                                messageId: messageRef.id,
                                senderName: this.contactForm.name,
                                senderEmail: this.contactForm.email,
                                timestamp: new Date().toISOString()
                            }
                        };

                        try {
                        // Envoyer la notification via l'API REST de OneSignal
                            const response = await fetch('https://onesignal.com/api/v1/notifications', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                    'Authorization': 'Basic os_v2_app_yholbd6k25ht5pqiwrlhd666qi2l732wdaqepxupxqcpzmldkhlya27onu2hglbn2jqpeyjshfkn4g2nj6zks2o3skyegtdpvs7e3da'
                            },
                            body: JSON.stringify(notificationData)
                        });

                            if (!response.ok) {
                                console.error('OneSignal API error:', response.status, response.statusText);
                                const errorText = await response.text();
                                console.error('OneSignal error details:', errorText);
                            } else {
                                console.log('Notification de contact envoy√©e avec succ√®s');
                            }
                        } catch (notificationError) {
                            console.error('Erreur lors de l\'envoi de la notification:', notificationError);
                            // Ne pas bloquer l'envoi du message si la notification √©choue
                        }

                        alert('Message envoy√© ! Nous vous contacterons bient√¥t.');
                        this.contactForm = {
                            name: '',
                            email: '',
                            message: ''
                        };
                    } catch (error) {
                        console.error('Error sending message:', error);
                        alert('Une erreur est survenue lors de l\'envoi du message. Veuillez r√©essayer plus tard.');
                    }
                },
                // M√©thodes pour la page de profil
                async loadProfileData() {
                    try {
                        const user = firebase.auth().currentUser;
                        if (!user) return;

                        const userDoc = await db.collection('users').doc(user.uid).get();
                        if (userDoc.exists) {
                            const userData = userDoc.data();
                            this.profileForm.firstName = userData.firstName || '';
                            this.profileForm.lastName = userData.lastName || '';
                            this.profileForm.email = userData.email || user.email || '';
                            this.profileForm.address = userData.address || '';
                        }
                    } catch (error) {
                        console.error('Erreur lors du chargement du profil:', error);
                        this.profileError = 'Erreur lors du chargement des donn√©es du profil';
                    }
                },
                async updateProfile() {
                    try {
                        this.isUpdatingProfile = true;
                        this.profileError = '';
                        this.profileSuccess = false;

                        const user = firebase.auth().currentUser;
                        if (!user) {
                            this.profileError = 'Vous devez √™tre connect√© pour modifier votre profil';
                            return;
                        }

                        // Validation des champs requis
                        if (!this.profileForm.firstName || !this.profileForm.lastName || !this.profileForm.email || !this.profileForm.address) {
                            this.profileError = 'Tous les champs sont obligatoires';
                            return;
                        }

                        // Validation du mot de passe si changement demand√©
                        if (this.profileForm.currentPassword || this.profileForm.newPassword || this.profileForm.confirmPassword) {
                            if (!this.profileForm.currentPassword) {
                                this.profileError = 'Le mot de passe actuel est requis pour changer le mot de passe';
                                return;
                            }
                            if (!this.profileForm.newPassword) {
                                this.profileError = 'Le nouveau mot de passe est requis';
                                return;
                            }
                            if (this.profileForm.newPassword !== this.profileForm.confirmPassword) {
                                this.profileError = 'Les mots de passe ne correspondent pas';
                                return;
                            }
                            if (this.profileForm.newPassword.length < 6) {
                                this.profileError = 'Le mot de passe doit contenir au moins 6 caract√®res';
                                return;
                            }
                        }

                        // Mise √† jour des informations utilisateur dans Firestore
                        const userUpdateData = {
                            firstName: this.profileForm.firstName,
                            lastName: this.profileForm.lastName,
                            email: this.profileForm.email,
                            address: this.profileForm.address,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        await db.collection('users').doc(user.uid).update(userUpdateData);

                        // Mise √† jour du mot de passe si demand√©
                        if (this.profileForm.currentPassword && this.profileForm.newPassword) {
                            // R√©authentifier l'utilisateur avant de changer le mot de passe
                            const credential = firebase.auth.EmailAuthProvider.credential(
                                user.email,
                                this.profileForm.currentPassword
                            );
                            await user.reauthenticateWithCredential(credential);
                            
                            // Changer le mot de passe
                            await user.updatePassword(this.profileForm.newPassword);
                        }

                        // Mettre √† jour l'email dans Firebase Auth si n√©cessaire
                        if (this.profileForm.email !== user.email) {
                            await user.updateEmail(this.profileForm.email);
                        }

                        this.profileSuccess = true;
                        
                        // R√©initialiser les champs de mot de passe
                        this.profileForm.currentPassword = '';
                        this.profileForm.newPassword = '';
                        this.profileForm.confirmPassword = '';

                        // Masquer le message de succ√®s apr√®s 3 secondes
                        setTimeout(() => {
                            this.profileSuccess = false;
                        }, 3000);

                    } catch (error) {
                        console.error('Erreur lors de la mise √† jour du profil:', error);
                        if (error.code === 'auth/wrong-password') {
                            this.profileError = 'Le mot de passe actuel est incorrect';
                        } else if (error.code === 'auth/email-already-in-use') {
                            this.profileError = 'Cette adresse email est d√©j√† utilis√©e';
                        } else if (error.code === 'auth/requires-recent-login') {
                            this.profileError = 'Pour des raisons de s√©curit√©, veuillez vous reconnecter avant de modifier votre profil';
                        } else {
                            this.profileError = 'Une erreur est survenue lors de la mise √† jour du profil';
                        }
                    } finally {
                        this.isUpdatingProfile = false;
                    }
                },
                async loadUnavailableSlots() {
                    // D√©terminer quelle date utiliser en fonction du formulaire actif
                    const selectedDate = this.adminAppointmentForm.date || this.appointmentForm.date;
                    
                    if (!selectedDate) {
                        this.availableSlots = [];
                        return;
                    }
                    
                    try {
                        console.log('Loading slots for date:', selectedDate);
                        
                        // Cr√©er les dates de d√©but et fin de la journ√©e s√©lectionn√©e
                        const dateObj = new Date(selectedDate);
                        const startOfDay = new Date(dateObj);
                        startOfDay.setHours(0, 0, 0, 0);
                        const endOfDay = new Date(dateObj);
                        endOfDay.setHours(23, 59, 59, 999);

                        // Nettoyer les anciens √©couteurs
                        if (this.unsubscribeSlots) {
                            this.unsubscribeSlots();
                        }
                        if (this.unsubscribeAppointments) {
                            this.unsubscribeAppointments();
                        }

                        // √âcouter les cr√©neaux pour cette date
                        this.unsubscribeSlots = db.collection('timeSlots')
                            .where('date', '>=', firebase.firestore.Timestamp.fromDate(startOfDay))
                            .where('date', '<=', firebase.firestore.Timestamp.fromDate(endOfDay))
                            .onSnapshot((slotsSnapshot) => {
                                console.log('Slots snapshot:', slotsSnapshot.docs.length, 'slots found');
                                
                                // Si aucun cr√©neau n'est d√©fini pour cette date
                                if (slotsSnapshot.empty) {
                                    this.availableSlots = [];
                                    return;
                                }

                                // R√©cup√©rer les cr√©neaux disponibles (non marqu√©s comme indisponibles)
                                const availableSlots = slotsSnapshot.docs
                                    .filter(doc => !doc.data().unavailable)
                                    .map(doc => doc.data().time);

                                console.log('Available slots before appointments filter:', availableSlots);

                                // √âcouter les rendez-vous pour cette date
                                this.unsubscribeAppointments = db.collection('appointments')
                                    .where('date', '==', selectedDate)
                                    .onSnapshot((appointmentsSnapshot) => {
                                        console.log('Appointments snapshot:', appointmentsSnapshot.docs.length, 'appointments found');
                                        
                                        // R√©cup√©rer les cr√©neaux d√©j√† r√©serv√©s
                                        const bookedSlots = appointmentsSnapshot.docs
                                            .map(doc => doc.data().time);
                                        
                                        console.log('Booked slots:', bookedSlots);
                                            
                                        // Filtrer les cr√©neaux disponibles
                                        this.availableSlots = availableSlots
                                            .filter(slot => !bookedSlots.includes(slot))
                                            .sort((a, b) => {
                                                const [aHours, aMinutes] = a.split(':').map(Number);
                                                const [bHours, bMinutes] = b.split(':').map(Number);
                                                return (aHours * 60 + aMinutes) - (bHours * 60 + bMinutes);
                                            });
                                        
                                        console.log('Final available slots:', this.availableSlots);
                                    }, error => {
                                        console.error('Error in appointments listener:', error);
                                        this.availableSlots = availableSlots;
                                    });
                            }, error => {
                                console.error('Error in slots listener:', error);
                                this.availableSlots = [];
                            });

                    } catch (error) {
                        console.error('Error loading available slots:', error);
                        this.availableSlots = [];
                    }
                },
                isTimeSlotUnavailable(slot) {
                    return this.unavailableSlots.includes(slot);
                },
                async submitAppointment() {
                    try {
                        // V√©rifier si un cr√©neau est s√©lectionn√©
                        if (!this.appointmentForm.time) {
                            this.appointmentError = 'Veuillez s√©lectionner un cr√©neau horaire';
                            return;
                        }

                        // V√©rifier que la date n'est pas aujourd'hui
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const selectedDate = new Date(this.appointmentForm.date);
                        selectedDate.setHours(0, 0, 0, 0);

                        if (selectedDate.getTime() === today.getTime()) {
                            this.appointmentError = 'Les rendez-vous ne peuvent pas √™tre pris pour le jour m√™me. Veuillez s√©lectionner une date ult√©rieure.';
                            return;
                        }

                        // V√©rifier si le cr√©neau est toujours disponible
                        const startOfDay = new Date(this.appointmentForm.date);
                        startOfDay.setHours(0, 0, 0, 0);
                        const endOfDay = new Date(this.appointmentForm.date);
                        endOfDay.setHours(23, 59, 59, 999);

                        // V√©rifier s'il n'y a pas d√©j√† un rendez-vous √† cette date et heure
                        const existingAppointment = await db.collection('appointments')
                            .where('date', '==', this.appointmentForm.date)
                            .where('time', '==', this.appointmentForm.time)
                            .get();

                        if (!existingAppointment.empty) {
                            this.appointmentError = 'Ce cr√©neau vient d\'√™tre r√©serv√© par quelqu\'un d\'autre';
                            await this.loadUnavailableSlots();
                            return;
                        }

                        // Trouver le cr√©neau correspondant dans timeSlots
                        const timeSlotSnapshot = await db.collection('timeSlots')
                            .where('date', '>=', firebase.firestore.Timestamp.fromDate(startOfDay))
                            .where('date', '<=', firebase.firestore.Timestamp.fromDate(endOfDay))
                            .where('time', '==', this.appointmentForm.time)
                            .get();

                        if (timeSlotSnapshot.empty) {
                            this.appointmentError = 'Ce cr√©neau n\'est plus disponible';
                            await this.loadUnavailableSlots();
                            return;
                        }

                        const timeSlotId = timeSlotSnapshot.docs[0].id;

                        // Marquer le cr√©neau comme indisponible
                        await db.collection('timeSlots')
                            .doc(timeSlotId)
                            .update({
                                unavailable: true,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });

                        // Cr√©er le rendez-vous
                        const appointmentData = {
                            ...this.appointmentForm,
                            userId: firebase.auth().currentUser.uid,
                            userEmail: firebase.auth().currentUser.email,
                            timeSlotId: timeSlotId,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'confirmed'
                        };

                        // Si un animal existant est s√©lectionn√©, ajouter son ID et r√©cup√©rer le temps de trajet du client
                        if (this.appointmentForm.selectedAnimalId) {
                            const selectedAnimal = this.animals.find(a => a.id === this.appointmentForm.selectedAnimalId);
                            appointmentData.animalId = this.appointmentForm.selectedAnimalId;
                            
                            // R√©cup√©rer le temps de trajet du client propri√©taire de l'animal
                            if (selectedAnimal && selectedAnimal.userId) {
                                const client = this.allClients ? this.allClients.find(c => c.id === selectedAnimal.userId) : null;
                                if (client && client.travelTime) {
                                    appointmentData.travelTime = client.travelTime;
                                }
                            }
                        }

                        const appointmentRef = await db.collection('appointments').add(appointmentData);

                        // Si un animal existant est s√©lectionn√©, mettre √† jour son historique
                        if (this.appointmentForm.selectedAnimalId) {
                            const animalRef = db.collection('animals').doc(this.appointmentForm.selectedAnimalId);
                            await animalRef.update({
                                appointments: firebase.firestore.FieldValue.arrayUnion({
                                    id: appointmentRef.id,
                                    date: this.appointmentForm.date,
                                    time: this.appointmentForm.time,
                                    notes: this.appointmentForm.notes || '',
                                    travelTime: appointmentData.travelTime || ''
                                })
                            });
                        }

                        // Envoyer une notification aux administrateurs
                        const formattedDate = new Date(this.appointmentForm.date).toLocaleDateString('fr-FR', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });

                        const notificationData = {
                            app_id: "c1dcb08f-cad7-4f3e-be08-b45671fbde82",
                            contents: {
                                en: `Nouveau rendez-vous pour ${this.appointmentForm.animalName} (${this.appointmentForm.animalType})`,
                                fr: `Nouveau rendez-vous pour ${this.appointmentForm.animalName} (${this.appointmentForm.animalType})`
                            },
                            headings: {
                                en: `${formattedDate} √† ${this.appointmentForm.time}`,
                                fr: `${formattedDate} √† ${this.appointmentForm.time}`
                            },
                            subtitle: {
                                en: `Contact: ${this.appointmentForm.phone}`,
                                fr: `Contact: ${this.appointmentForm.phone}`
                            },
                            url: window.location.origin + "/#admin",
                            // Envoyer uniquement aux administrateurs via les tags
                            filters: [
                                {"field": "tag", "key": "role", "relation": "=", "value": "admin"}
                            ],
                            // Ajouter des donn√©es personnalis√©es
                            data: {
                                type: "new_appointment",
                                appointmentId: appointmentRef.id,
                                animalName: this.appointmentForm.animalName,
                                animalType: this.appointmentForm.animalType,
                                date: this.appointmentForm.date,
                                time: this.appointmentForm.time,
                                phone: this.appointmentForm.phone
                            }
                        };

                        try {
                        // Envoyer la notification
                            const response = await fetch('https://onesignal.com/api/v1/notifications', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Basic os_v2_app_yholbd6k25ht5pqiwrlhd666qi2l732wdaqepxupxqcpzmldkhlya27onu2hglbn2jqpeyjshfkn4g2nj6zks2o3skyegtdpvs7e3da'
                            },
                            body: JSON.stringify(notificationData)
                        });

                            if (!response.ok) {
                                console.error('OneSignal API error:', response.status, response.statusText);
                                const errorText = await response.text();
                                console.error('OneSignal error details:', errorText);
                            } else {
                                console.log('Notification de rendez-vous envoy√©e avec succ√®s');
                            }
                        } catch (notificationError) {
                            console.error('Erreur lors de l\'envoi de la notification:', notificationError);
                            // Ne pas bloquer la cr√©ation du rendez-vous si la notification √©choue
                        }

                        // R√©initialiser le formulaire
                        this.appointmentForm = {
                            consultationType: '',
                            animalType: '',
                            animalName: '',
                            date: '',
                            time: '',
                            notes: '',
                            phone: '',
                            selectedAnimalId: ''
                        };
                        this.appointmentSuccess = true;
                        this.appointmentError = '';
                        
                        // Recharger les cr√©neaux disponibles
                        await this.loadUnavailableSlots();
                    } catch (error) {
                        console.error('Error submitting appointment:', error);
                        this.appointmentError = 'Une erreur est survenue lors de la prise de rendez-vous. Veuillez r√©essayer.';
                    }
                },
                onAnimalSelected() {
                    if (this.appointmentForm.selectedAnimalId && this.appointmentForm.selectedAnimalId !== 'autre') {
                        const selectedAnimal = this.animals.find(a => a.id === this.appointmentForm.selectedAnimalId);
                        if (selectedAnimal) {
                            this.appointmentForm.animalName = selectedAnimal.name;
                            this.appointmentForm.animalType = selectedAnimal.species;
                        }
                    } else if (this.appointmentForm.selectedAnimalId === 'autre') {
                        // R√©initialiser les champs si "autre" est s√©lectionn√©
                        this.appointmentForm.animalName = '';
                        this.appointmentForm.animalType = '';
                    }
                },
                scrollToContact() {
                    // Utiliser navigateToSection pour une navigation coh√©rente
                    this.navigateToSection('contact');
                },
                navigateTo(page) {
                    this.closeMenu();
                    // Mettre √† jour l'URL selon la page
                    if (page === 'home') {
                        window.location.hash = '';
                    } else {
                        window.location.hash = page;
                    }
                    // Forcer la mise √† jour de l'√©tat
                    this.$nextTick(() => {
                    this.currentPage = page;
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    if (page === 'admin' && this.isAdmin) {
                        this.loadAllData();
                        } else if (page === 'profile' && this.isAuthenticated) {
                            this.loadProfileData();
                        } else if (['chien', 'chat', 'cheval', 'nac', 'bovins'].includes(page)) {
                            // Les pages d'animaux sont d√©j√† g√©r√©es par les templates
                            // Pas besoin de chargement suppl√©mentaire
                    }
                    });
                },
                async loadAnimals() {
                    try {
                        // Nettoyer l'ancien √©couteur s'il existe
                        if (this.unsubscribeAnimals) {
                            this.unsubscribeAnimals();
                            this.unsubscribeAnimals = null;
                        }

                        // V√©rifier si l'utilisateur est connect√©
                        const user = firebase.auth().currentUser;
                        if (!user) {
                            this.animals = [];
                            return;
                        }

                        const userId = user.uid;
                        console.log('Loading animals for user:', userId);

                        // V√©rification de la connexion √† Firestore
                        if (!db) {
                            throw new Error('Erreur de connexion √† la base de donn√©es');
                        }

                        // Charger d'abord les informations de l'utilisateur
                        const userDoc = await db.collection('users').doc(userId).get();
                        if (userDoc.exists) {
                            this.userEmails[userId] = {
                                email: userDoc.data().email,
                                firstName: userDoc.data().firstName || '',
                                lastName: userDoc.data().lastName || '',
                                address: userDoc.data().address || '',
                                role: userDoc.data().role
                            };
                        }

                        // Utiliser onSnapshot pour les mises √† jour en temps r√©el
                        this.unsubscribeAnimals = db.collection('animals')
                            .where('userId', '==', userId)
                            .orderBy('createdAt', 'desc')
                            .onSnapshot(
                                snapshot => {
                                    console.log('Animals updated:', snapshot.docs.length);
                                    this.animals = snapshot.docs.map(doc => ({
                                        id: doc.id,
                                        ...doc.data()
                                    }));
                                    console.log('Animals loaded:', this.animals);
                                },
                                error => {
                                    if (this.isAuthenticated) {
                                        console.error('Error in real-time update:', error);
                                        alert('Erreur lors de la mise √† jour des animaux: ' + error.message);
                                    }
                                }
                            );
                    } catch (error) {
                        console.error('Error loading animals:', error);
                        this.animals = [];
                        if (this.isAuthenticated) {
                            alert('Erreur lors du chargement des animaux: ' + error.message);
                        }
                    }
                },
                async addAnimal() {
                    // V√©rification des champs obligatoires avec gestion des dates de naissance
                    if (!this.newAnimal.name || !this.newAnimal.species) {
                        alert('Veuillez remplir tous les champs obligatoires');
                        return;
                    }
                    
                    // V√©rification de la date de naissance selon le type
                    if (this.newAnimal.birthdateType === 'exact' && !this.newAnimal.birthdate) {
                        alert('Veuillez saisir une date de naissance exacte');
                        return;
                    }
                    if (this.newAnimal.birthdateType === 'approximate' && !this.newAnimal.birthdateApprox) {
                        alert('Veuillez saisir une date de naissance approximative');
                        return;
                    }

                    // V√©rifier si un propri√©taire est s√©lectionn√© (pour l'admin)
                    if (this.isAdmin && !this.newAnimal.userId) {
                        alert('Veuillez s√©lectionner un propri√©taire');
                        return;
                    }

                    try {
                        console.log('D√©but de l\'ajout de l\'animal');
                        console.log('Documents √† ajouter:', this.newAnimal.documents);



                        const animalData = {
                        name: this.newAnimal.name,
                            species: this.newAnimal.species,
                            race: this.newAnimal.race || '',
                            birthdate: this.newAnimal.birthdateType === 'exact' ? this.newAnimal.birthdate : null,
                            birthdateType: this.newAnimal.birthdateType,
                            birthdateApprox: this.newAnimal.birthdateType === 'approximate' ? this.newAnimal.birthdateApprox : null,
                            sterilization: this.newAnimal.sterilization || false,
                            sterilizationDetails: this.newAnimal.sterilizationDetails || '',
                            diet: this.newAnimal.diet || '',
                            activity: this.newAnimal.activity || '',
                            activityDetails: this.newAnimal.activityDetails || '',
                            medicalHistory: this.newAnimal.medicalHistory || '',
                            treatment: this.newAnimal.treatment || '',
                            behavior: this.newAnimal.behavior || '',
                        notes: this.newAnimal.notes || '',
                            // Utiliser l'ID du client s√©lectionn√© si on est admin, sinon l'ID de l'utilisateur connect√©
                            userId: this.isAdmin ? this.newAnimal.userId : firebase.auth().currentUser.uid,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            documents: this.newAnimal.documents || []
                        };

                    if (this.newAnimal.photosBase64 && this.newAnimal.photosBase64.length > 0) {
                        animalData.photos = this.newAnimal.photosBase64;
                    }

                        console.log('Envoi √† Firestore...');

                        await firebase.firestore().collection('animals').add(animalData);
                        console.log('Animal ajout√© avec succ√®s');
                        
                        // R√©initialiser le formulaire
                            this.showAddAnimalModal = false;
                        this.newAnimal = {
                            name: '',
                            species: '',
                            race: '',
                            birthdate: '',
                            birthdateType: 'exact',
                            birthdateApprox: '',
                            sterilization: false,
                            sterilizationDetails: '',
                            diet: '',
                            activity: '',
                            activityDetails: '',
                            medicalHistory: '',
                            treatment: '',
                            behavior: '',
                                notes: '',
                            photosPreview: [],
                            photosBase64: [],
                            documents: [],
                            userId: '' // Ajout du champ userId
                            };

                        alert('Animal ajout√© avec succ√®s !');
                    } catch (error) {
                        console.error('Erreur d√©taill√©e lors de l\'ajout de l\'animal:', error);
                        alert('Une erreur est survenue lors de l\'ajout de l\'animal: ' + error.message);
                    }
                },
                formatDate(date, birthdateType = null, birthdateApprox = null) {
                    if (birthdateType === 'approximate' && birthdateApprox) {
                        return birthdateApprox;
                    }
                    if (!date) return 'N/A';
                    if (date instanceof firebase.firestore.Timestamp) {
                        date = date.toDate();
                    }
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    return new Date(date).toLocaleDateString('fr-FR', options);
                },
                formatDateFr(dateString) {
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    return new Date(dateString).toLocaleDateString('fr-FR', options);
                },
                viewAnimalDetails(animal) {
                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.innerHTML = `
                        <div class="modal-content" id="animal-details-modal">
                            <h2>D√©tails de ${animal.name}</h2>
                            <div class="animal-details-row">
                                <div class="animal-profile-pic">
                                    ${animal.photos && animal.photos.length > 0 
                                        ? `<div class="animal-photos-grid">
                                            ${animal.photos.map((photo, index) => `
                                                <div class="animal-photo-item">
                                                    <img src="${photo}" alt="${animal.name} - Photo ${index + 1}" class="animal-photo" onclick="this.dispatchEvent(new CustomEvent('view-photo', {detail: {photo: '${photo}', index: ${index}, total: ${animal.photos.length}}, bubbles: true}))">
                                                </div>
                                            `).join('')}
                                           </div>`
                                        : animal.photoBase64 
                                            ? `<img src="${animal.photoBase64}" alt="${animal.name}" class="animal-photo" id="animal-photo-preview">`
                                            : '<div class="animal-photo placeholder"><span>Pas de photo</span></div>'
                                    }
                                </div>
                                <div class="animal-basic-info-right">
                                    <p><strong>Esp√®ce :</strong> <span id="animal-species">${animal.species}</span></p>
                                    <p><strong>Race :</strong> <span id="animal-race">${animal.race || 'Non renseign√©e'}</span></p>
                                    <p><strong>Date de naissance :</strong> <span id="animal-birthdate">${this.formatDate(animal.birthdate, animal.birthdateType, animal.birthdateApprox)}</span></p>
                                    <p><strong>St√©rilisation :</strong> <span id="animal-sterilization">${animal.sterilization ? 'Oui' : 'Non'}</span></p>
                                    ${animal.sterilization && animal.sterilizationDetails ? `<p><strong>D√©tails de la st√©rilisation :</strong> <span id="animal-sterilization-details">${animal.sterilizationDetails}</span></p>` : ''}
                                </div>
                            </div>
                            <div class="animal-details-section">
                                <h3>Informations du propri√©taire</h3>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <h4>Propri√©taire</h4>
                                        <p>${this.getUserFullName(animal.userId)}</p>
                                    </div>
                                    <div class="detail-item">
                                        <h4>Adresse</h4>
                                        <p>${this.userEmails[animal.userId]?.address || 'Non renseign√©e'}</p>
                                    </div>
                                    <div class="detail-item">
                                        <h4>Temps de trajet</h4>
                                        <p>${animal.travelTime || 'Non renseign√©'}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="animal-details-section">
                                <h3>Informations g√©n√©rales</h3>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <h4>Alimentation</h4>
                                        <p>${animal.diet || 'Non renseign√©e'}</p>
                                    </div>
                                    <div class="detail-item">
                                        <h4>Activit√©</h4>
                                        <p>${animal.activity || 'Non renseign√©e'}</p>
                                        ${animal.activityDetails ? `<p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--secondary-color);"><em>${animal.activityDetails}</em></p>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="animal-details-section">
                                <h3>Informations m√©dicales</h3>
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <h4>Ant√©c√©dents m√©dicaux</h4>
                                        <p>${animal.medicalHistory || 'Aucun ant√©c√©dent renseign√©'}</p>
                                    </div>
                                    <div class="detail-item">
                                        <h4>Traitement en cours</h4>
                                        <p>${animal.treatment || 'Aucun traitement en cours'}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="animal-details-section">
                                <h3>Comportement</h3>
                                <p>${animal.behavior || 'Aucune particularit√© comportementale renseign√©e'}</p>
                            </div>
                            <div class="animal-details-section">
                                <h3>Notes suppl√©mentaires</h3>
                                <p>${animal.notes || 'Aucune note suppl√©mentaire'}</p>
                            </div>
                            <div class="body-map-container">
                                <h3>Plan du corps</h3>
                                <div class="body-map" id="bodyMap-${animal.id}">
                                    <img src="images/body_map_${animal.species}.svg" alt="Plan du corps ${animal.species}" style="width: 100%; height: 100%; object-fit: contain;">
                                </div>
                                <div class="body-map-annotations-list" id="annotations-list-${animal.id}">
                                  <h4>Annotations du plan du corps :</h4>
                                  <ul></ul>
                                </div>
                                <button class="btn btn-add-annotation">
                                    Ajouter une annotation
                                </button>
                            </div>
                            <div class="animal-details-section">
                                <h3>Documents</h3>
                                <div class="documents-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                    ${animal.documents && animal.documents.length > 0 
                                        ? animal.documents.map(doc => `
                                            <div class="document-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer;" onclick="this.dispatchEvent(new CustomEvent('view-document', {detail: '${doc.id}', bubbles: true}))">
                                                <img src="${doc.data}" alt="${doc.name}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px; margin-bottom: 0.5rem;">
                                                <p style="font-size: 0.9rem; color: var(--text-color); margin: 0;">${doc.name}</p>
                                                <p style="font-size: 0.8rem; color: var(--secondary-color); margin: 0.2rem 0 0 0;">${this.formatDate(doc.date)}</p>
                                            </div>
                                        `).join('')
                                        : '<p>Aucun document</p>'
                                    }
                                </div>
                            </div>
                            <div class="appointments-history">
                                <h3>Historique des rendez-vous</h3>
                                <div class="appointments-list">
                                    ${animal.appointments && animal.appointments.length > 0 
                                        ? animal.appointments.map(apt => `
                                            <div class="appointment-item">
                                                <p>${this.formatDateFr(apt.date)} - ${apt.time}</p>
                                                ${apt.travelTime ? `<p><strong>Temps de trajet :</strong> ${apt.travelTime}</p>` : ''}
                                                ${apt.notes ? `<p><strong>Notes :</strong> ${apt.notes}</p>` : ''}
                                            </div>
                                        `).join('')
                                        : '<p>Aucun rendez-vous enregistr√©</p>'
                                    }
                                </div>
                            </div>
                            <div class="modal-actions">
                                <button class="btn" id="edit-animal-btn">Modifier</button>
                                <button class="btn secondary" id="close-animal-modal">Fermer</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);

                    // Ajouter le gestionnaire pour l'affichage en grand format
                    modal.addEventListener('view-document', (e) => {
                        const documentId = e.detail;
                        const selectedDoc = animal.documents.find(doc => doc.id === documentId);
                        if (selectedDoc) {
                            const fullscreenModal = window.document.createElement('div');
                            fullscreenModal.className = 'modal';
                            fullscreenModal.style.cssText = 'z-index: 1001; display: flex; align-items: flex-start; justify-content: center; padding: 100px 20px 20px 20px; overflow-y: auto;';
                            fullscreenModal.innerHTML = `
                                <div class="modal-content" style="max-width: 90vw; max-height: calc(100vh - 140px); overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 1.5rem; position: relative;">
                                    <div style="position: relative;">
                                        <div style="display: flex; justify-content: center; min-height: 200px; max-height: calc(90vh - 100px); overflow-y: auto;">
                                            <img src="${selectedDoc.data}" alt="${selectedDoc.name}" style="width: auto; max-width: 100%; height: auto; object-fit: contain;">
                                        </div>
                                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                                            <h3 style="margin: 0; color: var(--primary-color);">${selectedDoc.name}</h3>
                                            <p style="margin: 0.5rem 0 0 0; color: var(--secondary-color);">Ajout√© le ${this.formatDate(selectedDoc.date)}</p>
                                        </div>
                                        <button class="btn secondary" style="position: absolute; top: -10px; right: -10px; border-radius: 50%; width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);" onclick="this.closest('.modal').remove()">√ó</button>
                                    </div>
                                </div>
                            `;
                            window.document.body.appendChild(fullscreenModal);

                            // Ajouter un gestionnaire pour fermer avec la touche Echap
                            const handleEscape = (event) => {
                                if (event.key === 'Escape') {
                                    fullscreenModal.remove();
                                    window.removeEventListener('keydown', handleEscape);
                                }
                            };
                            window.addEventListener('keydown', handleEscape);

                            // Fermer en cliquant en dehors de l'image
                            fullscreenModal.addEventListener('click', (event) => {
                                if (event.target === fullscreenModal) {
                                    fullscreenModal.remove();
                                    window.removeEventListener('keydown', handleEscape);
                                }
                            });
                        }
                    });

                    // Gestion des √©v√©nements de photos
                    modal.addEventListener('view-photo', (e) => {
                        const { photo, index, total } = e.detail;
                        const fullscreenModal = window.document.createElement('div');
                        fullscreenModal.className = 'modal fullscreen-photo-modal';
                        fullscreenModal.style.cssText = 'z-index: 1001; display: flex; align-items: center; justify-content: center; padding: 20px; background: rgba(0,0,0,0.9); position: fixed; top: 0; left: 0; right: 0; bottom: 0;';
                        fullscreenModal.innerHTML = `
                            <div class="modal-content fullscreen-photo-content" style="max-width: 80vw; max-height: 80vh; background: transparent; box-shadow: none; padding: 0; position: relative; display: flex; flex-direction: column; align-items: center;">
                                <button class="close-photo-btn" onclick="this.closest('.fullscreen-photo-modal').remove()" style="position: absolute; top: 20px; right: 20px; background: #ff4444; color: white; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center; z-index: 1002; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">√ó</button>
                                <img src="${photo}" alt="Photo ${index + 1} de ${total}" style="max-width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px;">
                                <div style="margin-top: 15px; background: rgba(0,0,0,0.7); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px;">
                                    Photo ${index + 1} sur ${total}
                                </div>
                            </div>
                        `;
                        document.body.appendChild(fullscreenModal);

                        // Ajouter un gestionnaire pour fermer avec la touche Echap
                        const handleEscape = (event) => {
                            if (event.key === 'Escape') {
                                fullscreenModal.remove();
                                window.removeEventListener('keydown', handleEscape);
                            }
                        };
                        window.addEventListener('keydown', handleEscape);

                        // Fermer en cliquant en dehors de l'image
                        fullscreenModal.addEventListener('click', (event) => {
                            if (event.target === fullscreenModal) {
                                fullscreenModal.remove();
                                window.removeEventListener('keydown', handleEscape);
                            }
                        });

                        // Fermer en cliquant sur le bouton de fermeture
                        const closeBtn = fullscreenModal.querySelector('.close-photo-btn');
                        if (closeBtn) {
                            closeBtn.addEventListener('click', () => {
                                fullscreenModal.remove();
                                window.removeEventListener('keydown', handleEscape);
                            });
                        }
                    });

                    // Ajout de la logique d'√©dition
                    document.getElementById('edit-animal-btn').onclick = () => {
                        this.showEditAnimalForm(animal, modal);
                    };

                    // Ajout de la logique pour l'annotation
                    modal.querySelector('.btn-add-annotation').onclick = () => {
                        this.addBodyAnnotation(animal.id);
                    };

                    // Afficher les annotations apr√®s que le DOM du body map est pr√™t
                    setTimeout(() => {
                        this.displayBodyAnnotations(animal.id);
                    }, 0);

                    // Gestion fermeture (√âchap et retour)
                    const closeModal = () => {
                        modal.remove();
                        window.removeEventListener('keydown', escListener);
                        window.removeEventListener('popstate', popListener);
                        // Ne g√©rer l'historique que si on n'est pas dans l'interface d'administration
                        if (window.location.hash === '#animaldetails' && this.currentPage !== 'admin') {
                            history.back();
                        }
                    };
                    const escListener = (e) => {
                        if (e.key === 'Escape') {
                            closeModal();
                        }
                    };
                    window.addEventListener('keydown', escListener);
                    const popListener = (e) => {
                        closeModal();
                    };
                    window.addEventListener('popstate', popListener);
                    // N'ajouter une entr√©e √† l'historique que si on n'est pas dans l'interface d'administration
                    if (this.currentPage !== 'admin') {
                        history.pushState({ animalModal: true }, '', '#animaldetails');
                    }
                    modal.querySelector('#close-animal-modal').onclick = closeModal;
                },
                showEditAnimalForm(animal, modal) {
                    // Remplacer le contenu de la modal par un formulaire d'√©dition
                    modal.querySelector('.modal-content').innerHTML = `
                        <h2>Modifier ${animal.name}</h2>
                        <form id="edit-animal-form">
                            <div class="animal-details-row">
                                <div class="animal-profile-pic">
                                    <div class="photos-grid">
                                        ${animal.photos && animal.photos.length > 0 
                                            ? animal.photos.map((photo, index) => `
                                                <div class="photo-item">
                                                    <img src="${photo}" alt="${animal.name}" class="animal-photo">
                                                    <button type="button" class="btn-remove-photo" data-index="${index}">√ó</button>
                                                </div>
                                            `).join('')
                                            : '<p>Aucune photo</p>'
                                        }
                                    </div>
                                    <input type="file" id="edit-animal-photos" accept="image/*" multiple style="margin-top:1rem;">
                                    <small style="color: var(--text-color); font-size: 0.8rem;">Format recommand√© : JPG, PNG (max 5MB par image, max 10 images)</small>
                                </div>
                                <div class="animal-basic-info-right">
                                    <div class="form-group">
                                        <label>Propri√©taire :</label>
                                        <div class="searchable-select">
                                            <input 
                                                type="text" 
                                                id="edit-animal-owner-search" 
                                                placeholder="Rechercher un client..."
                                                value="${this.getSelectedOwnerNameForEdit(animal)}"
                                                autocomplete="off">
                                            <div class="select-dropdown" id="edit-owner-dropdown" style="display: none;">
                                                ${this.allClients.map(client => `
                                                    <div class="select-option ${animal.userId === client.id ? 'selected' : ''}" 
                                                         data-value="${client.id}" 
                                                         data-name="${client.firstName} ${client.lastName}"
                                                         data-email="${client.email}"
                                                         data-phone="${client.phone || 'N/A'}">
                                                        <strong>${client.firstName} ${client.lastName}</strong>
                                                        <span class="client-email">${client.email}</span>
                                                        <span class="client-phone">${client.phone || 'N/A'}</span>
                                                    </div>
                                                `).join('')}
                                            </div>
                                            <input type="hidden" id="edit-animal-owner" value="${animal.userId || ''}">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                    <label>Nom :</label>
                                    <input type="text" id="edit-animal-name" value="${animal.name}" required>
                                    </div>
                                    
                                    <div class="form-group">
                                    <label>Esp√®ce :</label>
                                    <select id="edit-animal-species" required>
                                        <option value="chien" ${animal.species === 'chien' ? 'selected' : ''}>Chien</option>
                                        <option value="chat" ${animal.species === 'chat' ? 'selected' : ''}>Chat</option>
                                        <option value="cheval" ${animal.species === 'cheval' ? 'selected' : ''}>Cheval</option>
                                        <option value="autre" ${animal.species === 'autre' ? 'selected' : ''}>Autre</option>
                                    </select>
                                    </div>

                                    <div class="form-group">
                                    <label>Race :</label>
                                    <input type="text" id="edit-animal-race" value="${animal.race || ''}">
                                    </div>
                                    
                                    <div class="form-group">
                                    <label>Date de naissance :</label>
                                        <div class="birthdate-input-container">
                                            <div class="radio-buttons">
                                                <button type="button" class="radio-btn ${animal.birthdateType === 'approximate' ? '' : 'selected'}" data-value="exact">
                                                    Date exacte
                                                </button>
                                                <button type="button" class="radio-btn ${animal.birthdateType === 'approximate' ? 'selected' : ''}" data-value="approximate">
                                                    Date approximative
                                                </button>
                                            </div>
                                            <div class="birthdate-exact" style="display: ${animal.birthdateType === 'approximate' ? 'none' : 'block'};">
                                                <input type="date" id="edit-animal-birthdate" value="${animal.birthdate || ''}">
                                            </div>
                                            <div class="birthdate-approximate" style="display: ${animal.birthdateType === 'approximate' ? 'block' : 'none'};">
                                                <input type="text" id="edit-animal-birthdate-approx" value="${animal.birthdateApprox || ''}" 
                                                       placeholder="Ex: 2018, 2 ans, d√©but 2020, etc.">
                                                <small style="color: var(--text-color); font-size: 0.8rem;">Vous pouvez indiquer l'ann√©e, l'√¢ge approximatif, ou une p√©riode</small>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>St√©rilisation :</label>
                                        <div class="radio-buttons">
                                            <button type="button" class="radio-btn ${animal.sterilization ? 'selected' : ''}" data-value="true">
                                                Oui
                                            </button>
                                            <button type="button" class="radio-btn ${!animal.sterilization ? 'selected' : ''}" data-value="false">
                                                Non
                                            </button>
                                </div>
                                        <input type="hidden" id="edit-animal-sterilization" value="${animal.sterilization}">
                            </div>
                                    
                                    <div class="form-group sterilization-details" style="display: ${animal.sterilization ? 'block' : 'none'};">
                                <label>D√©tails de la st√©rilisation :</label>
                                <textarea id="edit-animal-sterilization-details" rows="2" placeholder="Date de st√©rilisation, type d'intervention, v√©t√©rinaire, etc.">${animal.sterilizationDetails || ''}</textarea>
                                    </div>
                                </div>
                            </div>


                            <div class="form-group">
                                <label>Alimentation :</label>
                                <textarea id="edit-animal-diet" rows="2" placeholder="Type d'alimentation, fr√©quence des repas, etc.">${animal.diet || ''}</textarea>
                            </div>

                            <div class="form-group">
                                <label>Activit√© :</label>
                                <select id="edit-animal-activity" required>
                                    <option value="">S√©lectionnez le niveau d'activit√©</option>
                                    <option value="s√©dentaire" ${animal.activity === 's√©dentaire' ? 'selected' : ''}>S√©dentaire (tr√®s peu d'activit√©)</option>
                                    <option value="peu_actif" ${animal.activity === 'peu_actif' ? 'selected' : ''}>Peu actif (activit√© occasionnelle)</option>
                                    <option value="actif" ${animal.activity === 'actif' ? 'selected' : ''}>Actif (activit√© r√©guli√®re)</option>
                                    <option value="tr√®s_actif" ${animal.activity === 'tr√®s_actif' ? 'selected' : ''}>Tr√®s actif (activit√© intense et fr√©quente)</option>
                                    <option value="sportif" ${animal.activity === 'sportif' ? 'selected' : ''}>Sportif/Comp√©tition</option>
                                </select>
                                <textarea id="edit-animal-activity-details" rows="2" placeholder="D√©tails sur le type d'activit√© (promenades, sport, etc.)">${animal.activityDetails || ''}</textarea>
                            </div>

                            <div class="form-group">
                                <label>Ant√©c√©dents m√©dicaux :</label>
                                <textarea id="edit-animal-medical-history" rows="3" placeholder="Maladies, op√©rations, blessures pass√©es, etc."></textarea>
                            </div>

                            <div class="form-group">
                                <label>Traitement en cours :</label>
                                <textarea id="edit-animal-treatment" rows="2" placeholder="M√©dicaments, posologie, dur√©e, etc."></textarea>
                            </div>



                            <div class="form-group">
                                <label>Particularit√©s comportementales :</label>
                                <textarea id="edit-animal-behavior" rows="2" placeholder="Comportements particuliers, anxi√©t√©, agressivit√©, etc."></textarea>
                            </div>

                            <div class="form-group">
                                <label>Notes suppl√©mentaires :</label>
                                <textarea id="edit-animal-notes" rows="3">${animal.notes || ''}</textarea>
                            </div>

                            <div class="form-group">
                                <label>Documents :</label>
                                <div class="documents-grid">
                                    ${animal.documents && animal.documents.length > 0 
                                        ? animal.documents.map(doc => `
                                            <div class="document-card">
                                                <img src="${doc.data}" alt="${doc.name}">
                                                <p>${doc.name}</p>
                                                <p>${this.formatDate(doc.date)}</p>
                                                <button type="button" class="btn-delete" onclick="this.closest('.document-card').dispatchEvent(new CustomEvent('delete-document', {detail: '${doc.id}', bubbles: true}))">
                                                    Supprimer
                                                </button>
                                            </div>
                                        `).join('')
                                        : '<p>Aucun document</p>'
                                    }
                                </div>
                                <input type="file" id="edit-animal-documents" accept="image/*" multiple style="margin-top: 1rem;">
                                <small style="color: var(--text-color); font-size: 0.8rem;">Formats accept√©s : JPG, PNG</small>
                            </div>

                            <div class="modal-actions">
                                <button type="submit" class="btn primary">Enregistrer</button>
                                <button type="button" class="btn secondary" id="cancel-edit-animal">Annuler</button>
                            </div>
                        </form>
                    `;

                    // Gestion des photos multiples
                    const photosInput = modal.querySelector('#edit-animal-photos');
                    let currentPhotos = animal.photos || [];
                    
                    // Initialiser les gestionnaires d'√©v√©nements pour les boutons de suppression existants
                    const initialRemoveButtons = modal.querySelectorAll('.btn-remove-photo');
                    initialRemoveButtons.forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.preventDefault();
                            const index = parseInt(button.getAttribute('data-index'));
                            currentPhotos.splice(index, 1);
                            this.updatePhotosDisplay(modal, currentPhotos);
                        });
                    });

                    // Gestionnaire pour la suppression de photos (pour les nouvelles photos ajout√©es)
                    modal.addEventListener('delete-photo', (e) => {
                        const index = e.detail;
                        currentPhotos.splice(index, 1);
                        // Mettre √† jour l'affichage
                        this.updatePhotosDisplay(modal, currentPhotos);
                    });
                    
                    photosInput.addEventListener('change', (e) => {
                        const files = Array.from(e.target.files);
                        if (files.length === 0) return;

                        if (files.length > 10) {
                            alert('Vous ne pouvez pas s√©lectionner plus de 10 images √† la fois.');
                                e.target.value = '';
                                return;
                            }

                        files.forEach(file => {
                            if (!file.type.startsWith('image/')) {
                            alert(`Le fichier ${file.name} doit √™tre une image`);
                                    return;
                                }

                            try {
                                // Cr√©er un aper√ßu de l'image
                                const reader = new FileReader();
                                reader.onload = async (ev) => {
                                    // Cr√©er une image pour le redimensionnement
                                    const img = new Image();
                                    img.onload = async () => {
                                        // Cr√©er un canvas pour le redimensionnement
                                        const canvas = document.createElement('canvas');
                                        let width = img.width;
                                        let height = img.height;
                                        
                                        // Calculer les nouvelles dimensions en gardant le ratio
                                        const MAX_WIDTH = 800;
                                        const MAX_HEIGHT = 800;
                                        
                                        if (width > height) {
                                        if (width > MAX_WIDTH) {
                                            height *= MAX_WIDTH / width;
                                            width = MAX_WIDTH;
                                        }
                                        } else {
                                        if (height > MAX_HEIGHT) {
                                            width *= MAX_HEIGHT / height;
                                            height = MAX_HEIGHT;
                                            }
                                        }
                                        
                                        canvas.width = width;
                                        canvas.height = height;
                                        
                                        // Dessiner l'image redimensionn√©e
                                        const ctx = canvas.getContext('2d');
                                        ctx.drawImage(img, 0, 0, width, height);
                                        
                                        // Convertir en base64 avec compression
                                        const resizedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                                        
                                        // V√©rifier la taille finale
                                        const base64Size = resizedBase64.length * 3 / 4;
                                        if (base64Size > 900000) { // ~900KB pour avoir une marge
                                            alert(`L'image ${file.name} est trop grande m√™me apr√®s compression. Veuillez choisir une image plus petite.`);
                                            return;
                                        }
                                        
                                        // Ajouter √† la liste des photos
                                        currentPhotos.push(resizedBase64);
                                        this.updatePhotosDisplay(modal, currentPhotos);
                                    };
                                    img.src = ev.target.result;
                                };
                                reader.readAsDataURL(file);
                            } catch (error) {
                                console.error('Erreur lors du traitement de l\'image:', error);
                                alert(`Erreur lors du traitement de l'image ${file.name}. Veuillez r√©essayer avec une autre image.`);
                        }
                        });
                    });

                    // Annuler l'√©dition
                    modal.querySelector('#cancel-edit-animal').onclick = () => {
                        this.viewAnimalDetails(animal);
                        modal.remove();
                    };

                    // Gestion de l'affichage du champ d√©tails de st√©rilisation
                    
                    // Gestion des boutons stylis√©s pour la date de naissance
                    const birthdateButtons = modal.querySelectorAll('.birthdate-input-container .radio-btn');
                    const birthdateExactDiv = modal.querySelector('.birthdate-exact');
                    const birthdateApproxDiv = modal.querySelector('.birthdate-approximate');
                    
                    birthdateButtons.forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.preventDefault();
                            const value = button.getAttribute('data-value');
                            
                            // Mettre √† jour la s√©lection visuelle
                            birthdateButtons.forEach(btn => btn.classList.remove('selected'));
                            button.classList.add('selected');
                            
                            // Afficher/masquer les champs appropri√©s
                            if (value === 'exact') {
                                birthdateExactDiv.style.display = 'block';
                                birthdateApproxDiv.style.display = 'none';
                                // Vider le champ approximatif
                                modal.querySelector('#edit-animal-birthdate-approx').value = '';
                        } else {
                                birthdateExactDiv.style.display = 'none';
                                birthdateApproxDiv.style.display = 'block';
                                // Vider le champ exact
                                modal.querySelector('#edit-animal-birthdate').value = '';
                            }
                        });
                    });

                    // Gestion du s√©lecteur avec recherche pour le propri√©taire
                    const ownerSearchInput = modal.querySelector('#edit-animal-owner-search');
                    const ownerDropdown = modal.querySelector('#edit-owner-dropdown');
                    const ownerHiddenInput = modal.querySelector('#edit-animal-owner');
                    const ownerOptions = ownerDropdown.querySelectorAll('.select-option');

                    ownerSearchInput.addEventListener('input', (e) => {
                        const searchTerm = e.target.value.toLowerCase();
                        
                        ownerOptions.forEach(option => {
                            const name = option.querySelector('strong').textContent.toLowerCase();
                            const email = option.querySelector('.client-email').textContent.toLowerCase();
                            
                            if (name.includes(searchTerm) || email.includes(searchTerm)) {
                                option.style.display = 'block';
                            } else {
                                option.style.display = 'none';
                            }
                        });
                        
                        // Afficher le dropdown s'il y a des r√©sultats
                        const visibleOptions = Array.from(ownerOptions).filter(option => option.style.display !== 'none');
                        ownerDropdown.style.display = visibleOptions.length > 0 ? 'block' : 'none';
                    });

                    ownerSearchInput.addEventListener('focus', () => {
                        ownerDropdown.style.display = 'block';
                    });

                    ownerSearchInput.addEventListener('blur', () => {
                        setTimeout(() => {
                            ownerDropdown.style.display = 'none';
                        }, 200);
                    });

                    ownerOptions.forEach(option => {
                        option.addEventListener('click', () => {
                            const value = option.getAttribute('data-value');
                            const name = option.getAttribute('data-name');
                            const email = option.getAttribute('data-email');
                            
                            // Mettre √† jour l'input de recherche
                            ownerSearchInput.value = `${name} (${email})`;
                            
                            // Mettre √† jour l'input cach√©
                            ownerHiddenInput.value = value;
                            
                            // Mettre √† jour la s√©lection visuelle
                            ownerOptions.forEach(opt => opt.classList.remove('selected'));
                            option.classList.add('selected');
                            
                            // Masquer le dropdown
                            ownerDropdown.style.display = 'none';
                        });
                    });

                    // Soumission du formulaire
                    modal.querySelector('#edit-animal-form').onsubmit = async (e) => {
                        e.preventDefault();
                        // D√©terminer le type de date de naissance
                        const selectedBirthdateButton = modal.querySelector('.birthdate-input-container .radio-btn.selected');
                        const birthdateType = selectedBirthdateButton ? selectedBirthdateButton.getAttribute('data-value') : 'exact';
                        const birthdate = birthdateType === 'exact' ? modal.querySelector('#edit-animal-birthdate').value : null;
                        const birthdateApprox = birthdateType === 'approximate' ? modal.querySelector('#edit-animal-birthdate-approx').value : null;
                        
                        const updatedAnimal = {
                            userId: modal.querySelector('#edit-animal-owner').value,
                            name: modal.querySelector('#edit-animal-name').value,
                            species: modal.querySelector('#edit-animal-species').value,
                            race: modal.querySelector('#edit-animal-race').value,
                            birthdate: birthdate,
                            birthdateType: birthdateType,
                            birthdateApprox: birthdateApprox,
                            sterilization: modal.querySelector('#edit-animal-sterilization').value === 'true',
                            sterilizationDetails: modal.querySelector('#edit-animal-sterilization-details').value,
                            diet: modal.querySelector('#edit-animal-diet').value,
                            activity: modal.querySelector('#edit-animal-activity').value,
                            activityDetails: modal.querySelector('#edit-animal-activity-details').value,
                            medicalHistory: modal.querySelector('#edit-animal-medical-history').value,
                            treatment: modal.querySelector('#edit-animal-treatment').value,
                            behavior: modal.querySelector('#edit-animal-behavior').value,
                            notes: modal.querySelector('#edit-animal-notes').value,
                            photos: currentPhotos,
                            documents: [...currentDocuments, ...tempDocuments], // Sauvegarder les documents originaux + temporaires
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                            try {
                                await firebase.firestore().collection('animals').doc(animal.id).update(updatedAnimal);
                            
                                alert('Modifications enregistr√©es !');
                                modal.remove();
                                this.loadAnimals();
                            } catch (err) {
                                console.error('Erreur lors de la sauvegarde:', err);
                                alert('Erreur lors de la sauvegarde : ' + err.message);
                        }
                    };

                    // Gestion des documents
                    const documentsInput = modal.querySelector('#edit-animal-documents');
                    let currentDocuments = [...(animal.documents || [])]; // Copie pour √©viter de modifier l'original
                    let tempDocuments = []; // Documents temporaires qui ne seront sauvegard√©s que si on confirme
                    
                    documentsInput.addEventListener('change', async (e) => {
                        const files = Array.from(e.target.files);
                        if (files.length === 0) return;

                        for (const file of files) {
                            try {
                                // V√©rifier le type de fichier
                                if (!file.type.startsWith('image/')) {
                                    alert(`Le fichier ${file.name} doit √™tre une image`);
                                    continue;
                                }

                                // Cr√©er un aper√ßu de l'image
                                const reader = new FileReader();
                                reader.onload = async (e) => {
                                    // Cr√©er une image pour le redimensionnement
                                    const img = new Image();
                                    img.onload = async () => {
                                        // Cr√©er un canvas pour le redimensionnement
                                        const canvas = document.createElement('canvas');
                                        let width = img.width;
                                        let height = img.height;
                                        
                                        // Calculer les nouvelles dimensions en gardant le ratio
                                        const MAX_WIDTH = 1200;
                                        const MAX_HEIGHT = 1200;
                                        
                                        if (width > height) {
                                            if (width > MAX_WIDTH) {
                                                height *= MAX_WIDTH / width;
                                                width = MAX_WIDTH;
                                            }
                                        } else {
                                            if (height > MAX_HEIGHT) {
                                                width *= MAX_HEIGHT / height;
                                                height = MAX_HEIGHT;
                                            }
                                        }
                                        
                                        canvas.width = width;
                                        canvas.height = height;
                                        
                                        // Dessiner l'image redimensionn√©e
                                        const ctx = canvas.getContext('2d');
                                        ctx.drawImage(img, 0, 0, width, height);
                                        
                                        // Convertir en base64 avec compression adapt√©e
                                        const resizedBase64 = canvas.toDataURL('image/jpeg', 0.8);
                                        
                                        // Cr√©er un nouvel objet document
                                        const newDocument = {
                                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                                            name: file.name,
                                            date: new Date().toISOString(),
                                            data: resizedBase64
                                        };

                                        // Ajouter le document √† la liste temporaire
                                        tempDocuments.push(newDocument);

                                        // Mettre √† jour l'affichage avec tous les documents (originaux + temporaires)
                                        const allDocuments = [...currentDocuments, ...tempDocuments];
                                        const documentsGrid = modal.querySelector('.documents-grid');
                                        documentsGrid.innerHTML = allDocuments.map(doc => `
                                            <div class="document-card">
                                                <img src="${doc.data}" alt="${doc.name}">
                                                <p>${doc.name}</p>
                                                <p>${this.formatDate(doc.date)}</p>
                                                <button type="button" class="btn-delete" onclick="this.closest('.document-card').dispatchEvent(new CustomEvent('delete-document', {detail: '${doc.id}', bubbles: true}))">
                                                    Supprimer
                                                </button>
                                            </div>
                                        `).join('');
                                    };
                                    img.src = e.target.result;
                                };
                                reader.readAsDataURL(file);
                            } catch (error) {
                                console.error('Erreur lors du traitement du document:', error);
                                alert(`Erreur lors du traitement du document ${file.name}. Veuillez r√©essayer.`);
                            }
                        }
                        
                        // R√©initialiser l'input
                        e.target.value = '';
                    });

                    // Gestion de la suppression des documents
                    modal.addEventListener('delete-document', async (e) => {
                        const documentId = e.detail;
                        try {
                            // Supprimer le document de la liste appropri√©e
                            const isTempDocument = tempDocuments.some(doc => doc.id === documentId);
                            if (isTempDocument) {
                                tempDocuments = tempDocuments.filter(doc => doc.id !== documentId);
                            } else {
                                currentDocuments = currentDocuments.filter(doc => doc.id !== documentId);
                            }

                            // Mettre √† jour l'affichage avec tous les documents
                            const allDocuments = [...currentDocuments, ...tempDocuments];
                            const documentsGrid = modal.querySelector('.documents-grid');
                            if (allDocuments.length > 0) {
                                documentsGrid.innerHTML = allDocuments.map(doc => `
                                    <div class="document-card">
                                        <img src="${doc.data}" alt="${doc.name}">
                                        <p>${doc.name}</p>
                                        <p>${this.formatDate(doc.date)}</p>
                                        <button type="button" class="btn-delete" onclick="this.closest('.document-card').dispatchEvent(new CustomEvent('delete-document', {detail: '${doc.id}', bubbles: true}))">
                                            Supprimer
                                        </button>
                                    </div>
                                `).join('');
                            } else {
                                documentsGrid.innerHTML = '<p>Aucun document</p>';
                            }
                        } catch (error) {
                            console.error('Erreur lors de la suppression du document:', error);
                            alert('Erreur lors de la suppression du document. Veuillez r√©essayer.');
                        }
                    });

                    // Gestion des boutons radio stylis√©s
                    const radioButtons = modal.querySelectorAll('.radio-btn');
                    const sterilizationDetailsDiv = modal.querySelector('.sterilization-details');
                    
                    radioButtons.forEach(btn => {
                        btn.addEventListener('click', function() {
                            // Retirer la s√©lection de tous les boutons
                            radioButtons.forEach(b => b.classList.remove('selected'));
                            // Ajouter la s√©lection au bouton cliqu√©
                            this.classList.add('selected');
                            // Mettre √† jour la valeur cach√©e
                            const hiddenInput = modal.querySelector('#edit-animal-sterilization');
                            hiddenInput.value = this.dataset.value;
                            
                            // Afficher/masquer le champ de d√©tails selon la s√©lection
                            if (this.dataset.value === 'true') {
                                sterilizationDetailsDiv.style.display = 'block';
                            } else {
                                // Vider le champ de d√©tails AVANT de le masquer
                                const detailsTextarea = modal.querySelector('#edit-animal-sterilization-details');
                                if (detailsTextarea) {
                                    detailsTextarea.value = '';
                                }
                                // Masquer le champ de d√©tails
                                sterilizationDetailsDiv.style.display = 'none';
                            }
                        });
                    });
                },
                async checkAdminStatus() {
                    if (!firebase.auth().currentUser) {
                        this.isAdmin = false;
                        // Cacher le bouton de notification
                        const bellContainer = document.querySelector('#onesignal-bell-container');
                        if (bellContainer) {
                            bellContainer.classList.remove('show-bell');
                        }
                        return;
                    }
                    try {
                        const userDoc = await db.collection('users')
                            .doc(firebase.auth().currentUser.uid)
                            .get();
                        this.isAdmin = userDoc.exists && userDoc.data().role === 'admin';
                        
                        // Initialiser OneSignal uniquement si ce n'est pas d√©j√† fait
                        if (this.isAdmin) {
                            if (!window.OneSignal.initialized) {
                                window.OneSignal.push(function() {
                                    OneSignal.init({
                                        appId: "c1dcb08f-cad7-4f3e-be08-b45671fbde82",
                                        safari_web_id: "web.onesignal.auto.xxx",
                                        // Configuration am√©lior√©e pour la compatibilit√©
                                        allowLocalhostAsSecureOrigin: true,
                                        autoRegister: true,
                                        autoResubscribe: true,
                                        persistNotification: true,
                                        // Utiliser le service worker par d√©faut d'OneSignal
                                        // Configuration des notifications
                                        notifyButton: {
                                            enable: true,
                                            size: 'medium',
                                            theme: 'default',
                                            position: 'bottom-right',
                                            offset: {
                                                bottom: '20px',
                                                right: '20px'
                                            },
                                            prenotify: true,
                                            showCredit: false,
                                            text: {
                                                'tip.state.unsubscribed': 'Activer les notifications administrateur',
                                                'tip.state.subscribed': 'Notifications administrateur activ√©es',
                                                'tip.state.blocked': 'Notifications administrateur bloqu√©es',
                                                'message.prenotify': 'Cliquez pour activer les notifications administrateur',
                                                'message.action.subscribed': 'Merci ! Vous recevrez les notifications administrateur',
                                                'message.action.resubscribed': 'Notifications administrateur r√©activ√©es',
                                                'message.action.unsubscribed': 'Notifications administrateur d√©sactiv√©es',
                                                'dialog.main.title': 'Notifications Administrateur',
                                                'dialog.main.button.subscribe': 'ACTIVER',
                                                'dialog.main.button.unsubscribe': 'D√âSACTIVER',
                                                'dialog.blocked.title': 'D√©bloquer les notifications',
                                                'dialog.blocked.message': 'Suivez ces instructions pour autoriser les notifications:'
                                            }
                                        },
                                        // Configuration des prompts
                                        promptOptions: {
                                            slidedown: {
                                                prompts: [
                                                    {
                                                        type: "push",
                                                        autoPrompt: true,
                                                        text: {
                                                            actionMessage: "Voulez-vous recevoir les notifications administrateur ?",
                                                            acceptButton: "Autoriser",
                                                            cancelButton: "Plus tard"
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        // Configuration pour les anciens navigateurs
                                        welcomeNotification: {
                                            disable: false,
                                            title: "Notifications activ√©es !",
                                            message: "Vous recevrez maintenant les notifications administrateur"
                                        },
                                        // Configuration des permissions
                                        permissionDialog: {
                                            enable: true,
                                            title: "Notifications Emmy Vasse",
                                            message: "Recevez les notifications importantes de votre activit√© d'ost√©opathe animalier",
                                            acceptButtonText: "Autoriser",
                                            cancelButtonText: "Plus tard"
                                        }
                                    });
                                    
                                    // Attendre que OneSignal soit pr√™t
                                    OneSignal.on('subscriptionChange', function(isSubscribed) {
                                        console.log('OneSignal subscription changed:', isSubscribed);
                                    });
                                    
                                    OneSignal.on('notificationPermissionChange', function(permission) {
                                        console.log('OneSignal permission changed:', permission);
                                    });
                                    
                                    // Afficher le prompt apr√®s un d√©lai
                                    setTimeout(() => {
                                        OneSignal.showSlidedownPrompt();
                                    }, 2000);
                                    
                                    // Tagger l'utilisateur si c'est un admin
                                    if (this.isAdmin) {
                                        OneSignal.push(function() {
                                            OneSignal.sendTag('role', 'admin');
                                            console.log('Utilisateur tagu√© comme admin');
                                            
                                            // V√©rifier les tags apr√®s 2 secondes
                                            setTimeout(() => {
                                                OneSignal.getTags().then(tags => {
                                                    console.log('Tags actuels:', tags);
                                                });
                                            }, 2000);
                                        });
                                    } else {
                                        // Tagger les utilisateurs non-admin avec 'user'
                                        OneSignal.push(function() {
                                            OneSignal.sendTag('role', 'user');
                                            console.log('Utilisateur tagu√© comme user');
                                            
                                            // V√©rifier les tags apr√®s 2 secondes
                                            setTimeout(() => {
                                                OneSignal.getTags().then(tags => {
                                                    console.log('Tags actuels:', tags);
                                                });
                                            }, 2000);
                                        });
                                    }
                                    
                                    window.OneSignal.initialized = true;
                                });
                                

                                
                                // Fonction pour envoyer une notification √† des appareils sp√©cifiques
                                window.sendNotificationToSpecificDevices = async function(deviceIds, title, message, url = null) {
                                    const notificationData = {
                                        app_id: "c1dcb08f-cad7-4f3e-be08-b45671fbde82",
                                        contents: {
                                            en: message,
                                            fr: message
                                        },
                                        headings: {
                                            en: title,
                                            fr: title
                                        },
                                        include_player_ids: deviceIds,
                                        data: {
                                            type: "custom_notification",
                                            customUrl: url
                                        }
                                    };

                                    if (url) {
                                        notificationData.url = url;
                                    }

                                    try {
                                        const response = await fetch('https://onesignal.com/api/v1/notifications', {
                                            method: 'POST',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'Authorization': 'Basic os_v2_app_yholbd6k25ht5pqiwrlhd666qi2l732wdaqepxupxqcpzmldkhlya27onu2hglbn2jqpeyjshfkn4g2nj6zks2o3skyegtdpvs7e3da'
                                            },
                                            body: JSON.stringify(notificationData)
                                        });

                                        if (!response.ok) {
                                            console.error('OneSignal API error:', response.status, response.statusText);
                                            const errorText = await response.text();
                                            console.error('OneSignal error details:', errorText);
                                        } else {
                                            console.log('Notification envoy√©e aux appareils sp√©cifi√©s');
                                        }
                                    } catch (error) {
                                        console.error('Erreur lors de l\'envoi de la notification:', error);
                                    }
                                };
                            }
                            // Afficher le bouton de notification
                            setTimeout(() => {
                                const bellContainer = document.querySelector('#onesignal-bell-container');
                                if (bellContainer) {
                                    bellContainer.classList.add('show-bell');
                                }
                            }, 1000);
                        } else {
                            // Cacher le bouton de notification pour les non-admins
                            const bellContainer = document.querySelector('#onesignal-bell-container');
                            if (bellContainer) {
                                bellContainer.classList.remove('show-bell');
                            }
                        }
                    } catch (error) {
                        console.error('Error checking admin status:', error);
                        this.isAdmin = false;
                        // Cacher le bouton en cas d'erreur
                        const bellContainer = document.querySelector('#onesignal-bell-container');
                        if (bellContainer) {
                            bellContainer.classList.remove('show-bell');
                        }
                    }
                },
                async loadAllData() {
                    if (!this.isAdmin) return;
                    try {
                        // Charger tous les utilisateurs d'abord
                        const usersSnapshot = await db.collection('users').get();
                        this.userEmails = {};
                        usersSnapshot.docs.forEach(doc => {
                            this.userEmails[doc.id] = {
                                email: doc.data().email,
                                firstName: doc.data().firstName || '',
                                lastName: doc.data().lastName || '',
                                address: doc.data().address || '',
                                travelTime: doc.data().travelTime || '',
                                role: doc.data().role
                            };
                        });

                        // Mettre en place l'√©coute en temps r√©el pour les animaux
                        if (this.unsubscribeAdminAnimals) {
                            this.unsubscribeAdminAnimals();
                        }

                        this.unsubscribeAdminAnimals = db.collection('animals')
                            .orderBy('createdAt', 'desc')
                            .onSnapshot(snapshot => {
                                this.allAnimals = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                                console.log('Liste des animaux mise √† jour en temps r√©el');
                            }, error => {
                                console.error('Erreur dans l\'√©coute des animaux:', error);
                            });

                        // Charger tous les rendez-vous
                        const appointmentsSnapshot = await db.collection('appointments').get();
                        this.allAppointments = appointmentsSnapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));

                        // Charger tous les clients (users)
                        this.allClients = usersSnapshot.docs
                            .filter(doc => doc.data().role !== 'admin')
                            .map(doc => ({
                                id: doc.id,
                                firstName: doc.data().firstName || '',
                                lastName: doc.data().lastName || '',
                                email: doc.data().email,
                                phone: doc.data().phone || '',
                                address: doc.data().address || '',
                                travelTime: doc.data().travelTime || '',
                                createdAt: doc.data().createdAt || firebase.firestore.FieldValue.serverTimestamp(),
                                animalsCount: this.allAnimals.filter(animal => animal.userId === doc.id).length
                            }));

                        // Mettre en place l'√©coute en temps r√©el pour les clients
                        if (this.unsubscribeClients) {
                            this.unsubscribeClients();
                        }

                        this.unsubscribeClients = db.collection('users')
                            .where('role', '!=', 'admin')
                            .onSnapshot(snapshot => {
                                this.allClients = snapshot.docs.map(doc => ({
                                    id: doc.id,
                                    firstName: doc.data().firstName || '',
                                    lastName: doc.data().lastName || '',
                                    email: doc.data().email,
                                    phone: doc.data().phone || '',
                                    address: doc.data().address || '',
                                    travelTime: doc.data().travelTime || '',
                                    createdAt: doc.data().createdAt || firebase.firestore.FieldValue.serverTimestamp(),
                                    animalsCount: this.allAnimals.filter(animal => animal.userId === doc.id).length
                                }));
                                console.log('Liste des clients mise √† jour en temps r√©el');
                            }, error => {
                                console.error('Erreur dans l\'√©coute des clients:', error);
                            });

                        await this.loadMessages();
                    } catch (error) {
                        console.error('Error loading admin data:', error);
                    }
                },
                getUserFullName(userId) {
                    const user = this.userEmails[userId];
                    if (!user) return 'Client non trouv√©';
                    return `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'Client non trouv√©';
                },


                async editAppointment(appointment) {
                    this.editingAppointment = { ...appointment };
                    await this.loadUnavailableSlots();
                    this.showEditAppointmentModal = true;
                },
                async updateAppointment() {
                    try {
                        // V√©rifier si le cr√©neau est toujours disponible
                        if (this.isTimeSlotUnavailable(this.editingAppointment.time) && 
                            this.editingAppointment.time !== this.editingAppointment.originalTime) {
                            alert('Ce cr√©neau n\'est plus disponible');
                            return;
                        }

                        await db.collection('appointments').doc(this.editingAppointment.id).update({
                            date: this.editingAppointment.date,
                            time: this.editingAppointment.time,
                            phone: this.editingAppointment.phone,
                            notes: this.editingAppointment.notes,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // Mettre √† jour la liste locale
                        const index = this.allAppointments.findIndex(a => a.id === this.editingAppointment.id);
                        if (index !== -1) {
                            this.allAppointments[index] = { ...this.editingAppointment };
                        }

                        this.showEditAppointmentModal = false;
                        this.editingAppointment = null;
                        alert('Rendez-vous modifi√© avec succ√®s');
                    } catch (error) {
                        console.error('Error updating appointment:', error);
                        alert('Erreur lors de la modification: ' + error.message);
                    }
                },
                async deleteAnimal(animal) {
                    if (!confirm(`√ätes-vous s√ªr de vouloir supprimer ${animal.name} ?`)) return;
                    try {
                        await db.collection('animals').doc(animal.id).delete();
                        this.allAnimals = this.allAnimals.filter(a => a.id !== animal.id);
                        alert('Animal supprim√© avec succ√®s');
                    } catch (error) {
                        console.error('Error deleting animal:', error);
                        alert('Erreur lors de la suppression');
                    }
                },
                async deleteAppointment(appointment) {
                    if (!confirm(`√ätes-vous s√ªr de vouloir supprimer ce rendez-vous ?`)) return;
                    try {
                        // Trouver le cr√©neau correspondant
                        const appointmentDate = new Date(appointment.date);
                        const startOfDay = new Date(appointmentDate);
                        startOfDay.setHours(0, 0, 0, 0);
                        const endOfDay = new Date(appointmentDate);
                        endOfDay.setHours(23, 59, 59, 999);

                        console.log('DEBUG - Searching for slot to update:', {
                            date: appointment.date,
                            time: appointment.time
                        });

                        // Rechercher le cr√©neau correspondant
                        const timeSlotSnapshot = await db.collection('timeSlots')
                            .where('date', '>=', firebase.firestore.Timestamp.fromDate(startOfDay))
                            .where('date', '<=', firebase.firestore.Timestamp.fromDate(endOfDay))
                            .where('time', '==', appointment.time)
                            .get();

                        // Supprimer le rendez-vous de l'historique de l'animal s'il existe
                        if (appointment.animalId) {
                            const animalRef = db.collection('animals').doc(appointment.animalId);
                            const animalDoc = await animalRef.get();
                            
                            if (animalDoc.exists) {
                                const animalData = animalDoc.data();
                                const updatedAppointments = animalData.appointments.filter(apt => apt.id !== appointment.id);
                                
                                await animalRef.update({
                                    appointments: updatedAppointments
                                });
                            }
                        }

                        // Supprimer le rendez-vous
                        await db.collection('appointments').doc(appointment.id).delete();

                        // Mettre √† jour le cr√©neau si trouv√©
                        if (!timeSlotSnapshot.empty) {
                            console.log('DEBUG - Found slot to update:', timeSlotSnapshot.docs[0].id);
                            await db.collection('timeSlots')
                                .doc(timeSlotSnapshot.docs[0].id)
                                .update({
                                    unavailable: false,
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                        }

                        // Mettre √† jour la liste locale
                        this.allAppointments = this.allAppointments.filter(a => a.id !== appointment.id);
                        alert('Rendez-vous supprim√© avec succ√®s');

                        // Recharger les cr√©neaux si on est sur la page admin des cr√©neaux
                        if (this.adminActiveTab === 'slots') {
                            await this.loadSlots();
                        }
                    } catch (error) {
                        console.error('Error deleting appointment:', error);
                        alert('Erreur lors de la suppression: ' + error.message);
                    }
                },
                previousMonth() {
                    if (this.currentMonth === 0) {
                        this.currentMonth = 11;
                        this.currentYear--;
                    } else {
                        this.currentMonth--;
                    }
                },
                nextMonth() {
                    if (this.currentMonth === 11) {
                        this.currentMonth = 0;
                        this.currentYear++;
                    } else {
                        this.currentMonth++;
                    }
                },
                isToday(date) {
                    const today = new Date();
                    return date.getDate() === today.getDate() &&
                           date.getMonth() === today.getMonth() &&
                           date.getFullYear() === today.getFullYear();
                },
                isCurrentMonth(date) {
                    return date.getMonth() === this.currentMonth &&
                           date.getFullYear() === this.currentYear;
                },
                hasSlots(date) {
                    return this.slots.some(slot => 
                        slot.date.toDateString() === date.toDateString()
                    );
                },
                getSlotsCount(date) {
                    return this.slots.filter(slot => 
                        slot.date.toDateString() === date.toDateString()
                    ).length;
                },
                selectDate(date) {
                    if (this.isCurrentMonth(date)) {
                        this.selectedDate = date;
                    }
                },
                getDateSlots(date) {
                    return this.slots.filter(slot => 
                        slot.date.toDateString() === date.toDateString()
                    );
                },
                async addSlots() {
                    try {
                        const slotsToAdd = [];
                        const startDate = new Date(this.newSlot.date);
                        const endDate = this.newSlot.recurrence !== 'none' ? new Date(this.newSlot.endDate) : startDate;

                        // Validation de base
                        if (!this.newSlot.time || !this.newSlot.date) {
                            throw new Error('La date et l\'heure sont requises');
                        }

                        // G√©n√©rer tous les cr√©neaux √† ajouter
                        if (this.newSlot.recurrence === 'none') {
                            const slotDate = new Date(startDate);
                            const [hours, minutes] = this.newSlot.time.split(':');
                            slotDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                            
                            slotsToAdd.push({
                                date: firebase.firestore.Timestamp.fromDate(slotDate),
                                time: this.newSlot.time,
                                duration: parseInt(this.newSlot.duration),
                                unavailable: false
                            });
                        } else {
                            let currentDate = new Date(startDate);
                            while (currentDate <= endDate) {
                                const slotDate = new Date(currentDate);
                                const [hours, minutes] = this.newSlot.time.split(':');
                                slotDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                                
                                slotsToAdd.push({
                                    date: firebase.firestore.Timestamp.fromDate(slotDate),
                                    time: this.newSlot.time,
                                    duration: parseInt(this.newSlot.duration),
                                    unavailable: false
                                });
                                
                                // Passer √† la date suivante selon la r√©currence
                                switch(this.newSlot.recurrence) {
                                    case 'daily':
                                        currentDate.setDate(currentDate.getDate() + 1);
                                        break;
                                    case 'weekly':
                                        currentDate.setDate(currentDate.getDate() + 7);
                                        break;
                                    case 'monthly':
                                        currentDate.setMonth(currentDate.getMonth() + 1);
                                        break;
                                }
                            }
                        }

                        // V√©rifier les doublons pour tous les cr√©neaux d'un coup
                        const conflictingSlots = [];
                        for (const slot of slotsToAdd) {
                            const dateStr = slot.date.toDate().toISOString().split('T')[0];
                            const existingSlots = await db.collection('timeSlots')
                                .where('date', '>=', slot.date)
                                .where('date', '<=', slot.date)
                                .get();

                            const hasConflict = existingSlots.docs.some(doc => doc.data().time === slot.time);
                            if (hasConflict) {
                                const formattedDate = slot.date.toDate().toLocaleDateString('fr-FR', {
                                    weekday: 'long',
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                });
                                conflictingSlots.push(`${formattedDate} √† ${slot.time}`);
                            }
                        }

                        // S'il y a des conflits, afficher tous les cr√©neaux en conflit
                        if (conflictingSlots.length > 0) {
                            throw new Error(
                                'Des cr√©neaux existent d√©j√† aux dates suivantes :\n' +
                                conflictingSlots.join('\n')
                            );
                        }
                        
                        // Si aucun conflit, ajouter tous les cr√©neaux
                        const batch = db.batch();
                        for (const slot of slotsToAdd) {
                            const newSlotRef = db.collection('timeSlots').doc();
                            batch.set(newSlotRef, {
                                ...slot,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                        await batch.commit();
                        
                        this.showAddSlotModal = false;
                        this.newSlot = {
                            time: '',
                            date: '',
                            duration: '60',
                            recurrence: 'none',
                            endDate: ''
                        };
                        await this.loadSlots();
                        
                        // Message de succ√®s avec le nombre de cr√©neaux ajout√©s
                        const message = slotsToAdd.length === 1
                            ? 'Cr√©neau ajout√© avec succ√®s'
                            : `${slotsToAdd.length} cr√©neaux ajout√©s avec succ√®s`;
                        alert(message);
                    } catch (error) {
                        console.error('Error adding slots:', error);
                        alert(error.message || 'Erreur lors de l\'ajout des cr√©neaux');
                    }
                },
                async toggleSlotAvailability(slot) {
                    try {
                        await db.collection('timeSlots').doc(slot.id).update({
                            unavailable: !slot.unavailable,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        await this.loadSlots();
                    } catch (error) {
                        console.error('Error toggling slot availability:', error);
                        alert('Erreur lors de la modification du cr√©neau: ' + error.message);
                    }
                },
                async deleteSlot(slot) {
                    if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce cr√©neau ?')) return;
                    try {
                        await db.collection('timeSlots').doc(slot.id).delete();
                        await this.loadSlots();
                        alert('Cr√©neau supprim√© avec succ√®s');
                    } catch (error) {
                        console.error('Error deleting slot:', error);
                        alert('Erreur lors de la suppression du cr√©neau: ' + error.message);
                    }
                },
                async loadSlots() {
                    try {
                        console.log('Loading admin slots...');
                        
                        // Nettoyer l'ancien √©couteur
                        if (this.unsubscribeAdminSlots) {
                            this.unsubscribeAdminSlots();
                            this.unsubscribeAdminSlots = null;
                        }

                        // V√©rifier que l'utilisateur est admin
                        if (!this.isAdmin) {
                            console.log('User is not admin, skipping slots load');
                            return;
                        }

                        this.unsubscribeAdminSlots = db.collection('timeSlots')
                            .orderBy('date')
                            .onSnapshot(snapshot => {
                                console.log('Admin slots snapshot:', snapshot.docs.length, 'slots found');
                                
                                this.slots = snapshot.docs.map(doc => ({
                                    id: doc.id,
                                    ...doc.data(),
                                    date: doc.data().date.toDate()
                                }));
                                
                                console.log('Processed slots:', this.slots.length);
                                console.log('Slots data:', this.slots);
                            }, error => {
                                console.error('Error in admin slots listener:', error);
                                this.slots = [];
                            });
                    } catch (error) {
                        console.error('Error loading slots:', error);
                        this.slots = [];
                    }
                },
                async syncTimeSlots() {
                    if (!this.isAuthenticated) {
                        console.log('Synchronisation des cr√©neaux ignor√©e : utilisateur non connect√©');
                        return;
                    }

                    try {
                        console.log('D√©but de la synchronisation des cr√©neaux...');
                        
                        // R√©cup√©rer tous les rendez-vous
                        const appointmentsSnapshot = await db.collection('appointments')
                            .where('date', '>=', firebase.firestore.Timestamp.fromDate(new Date()))
                            .get();
                        
                        // Traiter les rendez-vous par lots de 10 pour √©viter les limitations
                        const appointments = appointmentsSnapshot.docs;
                        for (let i = 0; i < appointments.length; i += 10) {
                            const batch = appointments.slice(i, i + 10);
                            await Promise.all(batch.map(async (appointmentDoc) => {
                                const appointment = appointmentDoc.data();
                                const appointmentDate = new Date(appointment.date);
                                const startOfDay = new Date(appointmentDate);
                                startOfDay.setHours(0, 0, 0, 0);
                                const endOfDay = new Date(appointmentDate);
                                endOfDay.setHours(23, 59, 59, 999);

                                try {
                                    // Trouver le cr√©neau correspondant
                                    const timeSlotSnapshot = await db.collection('timeSlots')
                                        .where('date', '>=', firebase.firestore.Timestamp.fromDate(startOfDay))
                                        .where('date', '<=', firebase.firestore.Timestamp.fromDate(endOfDay))
                                        .where('time', '==', appointment.time)
                                        .get();

                                    if (!timeSlotSnapshot.empty) {
                                        // Mettre √† jour le cr√©neau
                                        await db.collection('timeSlots')
                                            .doc(timeSlotSnapshot.docs[0].id)
                                            .update({
                                                unavailable: true,
                                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                            });
                                    }
                                } catch (error) {
                                    console.warn(`Erreur lors de la mise √† jour du cr√©neau pour le rendez-vous ${appointmentDoc.id}:`, error);
                                }
                            }));
                        }
                        
                        console.log('Synchronisation des cr√©neaux termin√©e avec succ√®s');
                    } catch (error) {
                        if (error.code === 'permission-denied') {
                            console.warn('Synchronisation des cr√©neaux ignor√©e : permissions insuffisantes');
                        } else {
                            console.error('Erreur lors de la synchronisation des cr√©neaux:', error);
                        }
                    }
                },
                async loadAvailableDates() {
                    try {
                        console.log('Loading available dates...');
                        this.isLoadingDates = true;
                        
                        // Calculer la date de d√©but (demain)
                        const tomorrow = new Date();
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        tomorrow.setHours(0, 0, 0, 0);
                        
                        const thirtyDaysFromNow = new Date();
                        thirtyDaysFromNow.setDate(tomorrow.getDate() + 30);
                        thirtyDaysFromNow.setHours(23, 59, 59, 999);

                        console.log('Date range:', tomorrow.toISOString(), 'to', thirtyDaysFromNow.toISOString());

                        // Nettoyer l'ancien √©couteur
                        if (this.unsubscribeAvailableDates) {
                            this.unsubscribeAvailableDates();
                        }

                        this.unsubscribeAvailableDates = db.collection('timeSlots')
                            .where('date', '>=', firebase.firestore.Timestamp.fromDate(tomorrow))
                            .where('date', '<=', firebase.firestore.Timestamp.fromDate(thirtyDaysFromNow))
                            .where('unavailable', '==', false)
                            .onSnapshot(snapshot => {
                                console.log('Available dates snapshot:', snapshot.docs.length, 'slots found');
                                
                                // Extraire les dates uniques des cr√©neaux disponibles
                                const availableDatesSet = new Set();
                                snapshot.forEach(doc => {
                                    const slotDate = doc.data().date.toDate();
                                    const dateString = slotDate.toISOString().split('T')[0];
                                    availableDatesSet.add(dateString);
                                });

                                this.availableDates = Array.from(availableDatesSet).sort();
                                console.log('Available dates:', this.availableDates);
                                this.isLoadingDates = false;
                            }, error => {
                                console.error('Error loading available dates:', error);
                                this.isLoadingDates = false;
                                this.availableDates = [];
                            });

                    } catch (error) {
                        console.error('Error setting up available dates listener:', error);
                        this.isLoadingDates = false;
                        this.availableDates = [];
                    }
                },
                async handlePhotosUpload(event) {
                    const files = Array.from(event.target.files);
                    if (files.length === 0) return;

                    // V√©rifier le nombre maximum d'images
                    if (files.length > 10) {
                        alert('Vous ne pouvez pas s√©lectionner plus de 10 images √† la fois.');
                            event.target.value = '';
                            return;
                    }

                    // Initialiser les tableaux si n√©cessaire
                    if (!this.newAnimal.photosPreview) this.newAnimal.photosPreview = [];
                    if (!this.newAnimal.photosBase64) this.newAnimal.photosBase64 = [];

                    for (const file of files) {
                        // V√©rifier le type de fichier
                        if (!file.type.startsWith('image/')) {
                            alert(`Le fichier ${file.name} doit √™tre une image`);
                            continue;
                        }

                        try {
                            // Cr√©er un aper√ßu de l'image
                            const reader = new FileReader();
                            reader.onload = async (e) => {
                                // Cr√©er une image pour le redimensionnement
                                const img = new Image();
                                img.onload = async () => {
                                    // Cr√©er un canvas pour le redimensionnement
                                    const canvas = document.createElement('canvas');
                                    let width = img.width;
                                    let height = img.height;
                                    
                                    // Calculer les nouvelles dimensions en gardant le ratio
                                    const MAX_WIDTH = 800;
                                    const MAX_HEIGHT = 800;
                                    
                                    if (width > height) {
                                        if (width > MAX_WIDTH) {
                                            height *= MAX_WIDTH / width;
                                            width = MAX_WIDTH;
                                        }
                                    } else {
                                        if (height > MAX_HEIGHT) {
                                            width *= MAX_HEIGHT / height;
                                            height = MAX_HEIGHT;
                                        }
                                    }
                                    
                                    canvas.width = width;
                                    canvas.height = height;
                                    
                                    // Dessiner l'image redimensionn√©e
                                    const ctx = canvas.getContext('2d');
                                    ctx.drawImage(img, 0, 0, width, height);
                                    
                                    // Convertir en base64 avec compression
                                    const resizedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                                    
                                    // V√©rifier la taille finale
                                    const base64Size = resizedBase64.length * 3 / 4;
                                    if (base64Size > 900000) { // ~900KB pour avoir une marge
                                        alert(`L'image ${file.name} est trop grande m√™me apr√®s compression. Veuillez choisir une image plus petite.`);
                                        return;
                                    }
                                    
                                    // Ajouter √† la liste des photos
                                    this.newAnimal.photosPreview.push(resizedBase64);
                                    this.newAnimal.photosBase64.push(resizedBase64);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        } catch (error) {
                            console.error('Erreur lors du traitement de l\'image:', error);
                            alert(`Erreur lors du traitement de l'image ${file.name}. Veuillez r√©essayer avec une autre image.`);
                        }
                    }
                },
                removePhoto(index) {
                    if (this.newAnimal.photosPreview && this.newAnimal.photosBase64) {
                        this.newAnimal.photosPreview.splice(index, 1);
                        this.newAnimal.photosBase64.splice(index, 1);
                    }
                },
                async handleDocumentUpload(event) {
                    const files = Array.from(event.target.files);
                    if (files.length === 0) return;

                    if (files.length > 10) {
                        alert('Vous ne pouvez pas s√©lectionner plus de 10 documents √† la fois.');
                        event.target.value = '';
                        return;
                    }

                    for (const file of files) {
                        try {
                            console.log('D√©but du traitement du document:', file.name);

                        if (!file.type.startsWith('image/')) {
                                alert(`Le fichier ${file.name} doit √™tre une image`);
                                continue;
                        }

                        const reader = new FileReader();
                        reader.onload = (e) => {
                                const img = new Image();
                                img.onload = async () => {
                                    console.log('Image charg√©e, d√©but du redimensionnement');
                                    const canvas = document.createElement('canvas');
                                    let width = img.width;
                                    let height = img.height;
                                    
                                    // Redimensionnement si n√©cessaire
                                    const MAX_WIDTH = 1400;
                                    const MAX_HEIGHT = 1400;
                                    
                                    if (width > MAX_WIDTH) {
                                        height *= MAX_WIDTH / width;
                                        width = MAX_WIDTH;
                                    }
                                    
                                    if (height > MAX_HEIGHT) {
                                        width *= MAX_HEIGHT / height;
                                        height = MAX_HEIGHT;
                                    }
                                    
                                    canvas.width = width;
                                    canvas.height = height;
                                    
                                    const ctx = canvas.getContext('2d');
                                    ctx.drawImage(img, 0, 0, width, height);
                                    
                                    const resizedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                                    console.log('Image redimensionn√©e, taille:', resizedBase64.length);
                                    
                                    const newDocument = {
                                        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                                        name: file.name,
                                        date: new Date().toISOString(),
                                        data: resizedBase64
                                    };
                                    
                                    console.log('Document cr√©√© avec ID:', newDocument.id);
                                    
                                    if (!this.newAnimal.documents) {
                                        this.newAnimal.documents = [];
                                        console.log('Initialisation du tableau documents');
                                    }
                                    
                                    this.newAnimal.documents.push(newDocument);
                                    console.log('Document ajout√©, nombre total:', this.newAnimal.documents.length);
                                    console.log('Documents actuels:', JSON.stringify(this.newAnimal.documents));
                                    
                                    this.$forceUpdate();
                                };
                                img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                        } catch (error) {
                            console.error('Erreur d√©taill√©e lors du traitement du document:', error);
                            alert(`Erreur lors du traitement du document ${file.name}. Veuillez r√©essayer.`);
                        }
                    }
                    
                    // R√©initialiser l'input pour permettre de s√©lectionner les m√™mes fichiers
                    event.target.value = '';
                },
                removeDocument(index) {
                    if (this.newAnimal.documents && this.newAnimal.documents.length > index) {
                        this.newAnimal.documents.splice(index, 1);
                        this.$forceUpdate();
                    }
                },
                // Ajout d'une m√©thode pour g√©rer les annotations sur le plan du corps
                addBodyAnnotation(animalId) {
                    // Trouver le SVG du body map
                    const svgContainer = document.querySelector(`#bodyMap-${animalId}`);
                    if (!svgContainer) return;
                    const svg = svgContainer.querySelector('img');
                    if (!svg) return;

                    // Ajouter un overlay pour capter le clic
                    let overlay = svgContainer.querySelector('.annotation-overlay');
                    if (!overlay) {
                        overlay = document.createElement('div');
                        overlay.className = 'annotation-overlay';
                        overlay.style.position = 'absolute';
                        overlay.style.top = 0;
                        overlay.style.left = 0;
                        overlay.style.width = '100%';
                        overlay.style.height = '100%';
                        overlay.style.cursor = 'crosshair';
                        overlay.style.zIndex = 10;
                        svgContainer.style.position = 'relative';
                        svgContainer.appendChild(overlay);
                    }

                    overlay.onclick = (e) => {
                        // Calculer la position relative au SVG
                        const rect = svg.getBoundingClientRect();
                        const x = ((e.clientX - rect.left) / rect.width);
                        const y = ((e.clientY - rect.top) / rect.height);

                        // Cr√©er un mini-formulaire √† la position du clic
                        const form = document.createElement('form');
                        form.className = 'annotation-form';
                        form.style.position = 'absolute';
                        form.style.left = `${x * 100}%`;
                        form.style.top = `${y * 100}%`;
                        form.style.transform = 'translate(-50%, -50%)';
                        form.innerHTML = `
                            <input type="text" placeholder="Texte de l'annotation" required style="padding:0.3rem 0.7rem; border-radius:6px; border:1px solid #ccc; font-size:1rem;">
                            <button type="submit" style="margin-left:0.5rem; background:var(--primary-color); color:white; border:none; border-radius:6px; padding:0.3rem 0.8rem; font-weight:600;">OK</button>
                        `;
                        overlay.appendChild(form);
                        form.querySelector('input').focus();

                        form.onsubmit = async (ev) => {
                            ev.preventDefault();
                            const text = form.querySelector('input').value;
                            // Charger les annotations existantes
                            const animalRef = firebase.firestore().collection('animals').doc(animalId);
                            const animalDoc = await animalRef.get();
                            let annotations = animalDoc.data().annotations || [];
                            annotations.push({ x, y, text });
                            await animalRef.update({ annotations });
                            form.remove();
                            overlay.remove();
                            // Rafra√Æchir l'affichage des annotations
                            this.displayBodyAnnotations(animalId);
                        };

                        // Un seul formulaire √† la fois
                        overlay.onclick = null;
                    };
                },

                displayBodyAnnotations(animalId) {
                    const svgContainer = document.querySelector(`#bodyMap-${animalId}`);
                    if (!svgContainer) return;
                    svgContainer.style.position = 'relative';
                    const img = svgContainer.querySelector('img');
                    if (!img) return;
                    if (!img.complete) {
                        img.onload = () => {
                            setTimeout(() => {
                                this.displayBodyAnnotations(animalId);
                            }, 50);
                        };
                        return;
                    }
                    svgContainer.querySelectorAll('.annotation-point').forEach(el => el.remove());
                    firebase.firestore().collection('animals').doc(animalId).get().then(doc => {
                        const annotations = doc.data().annotations || [];
                        const points = [];
                        const lines = [];
                        annotations.forEach((ann, idx) => {
                            const point = document.createElement('div');
                            point.className = 'annotation-point';
                            point.style.position = 'absolute';
                            point.style.left = `${ann.x * 100}%`;
                            point.style.top = `${ann.y * 100}%`;
                            point.style.transform = 'translate(-50%, -50%)';
                            point.style.width = '18px';
                            point.style.height = '18px';
                            point.style.background = 'var(--accent-color)';
                            point.style.border = '2px solid white';
                            point.style.borderRadius = '50%';
                            point.style.zIndex = 20;
                            point.style.cursor = 'pointer';
                            point.title = ann.text;
                            point.onmouseenter = null;
                            point.onmouseleave = null;
                            svgContainer.appendChild(point);
                            points.push(point);
                        });
                        // Remplir la liste sous le SVG
                        const listContainer = document.getElementById(`annotations-list-${animalId}`);
                        if (listContainer) {
                            const ul = listContainer.querySelector('ul');
                            ul.innerHTML = '';
                            if (annotations.length === 0) {
                                const li = document.createElement('li');
                                li.textContent = 'Aucune annotation';
                                ul.appendChild(li);
                            } else {
                                annotations.forEach((ann, idx) => {
                                    const li = document.createElement('li');
                                    const dot = document.createElement('span');
                                    dot.className = 'annotation-dot';
                                    li.appendChild(dot);
                                    li.appendChild(document.createTextNode(ann.text));
                                    // Bouton suppression
                                    const delBtn = document.createElement('button');
                                    delBtn.className = 'annotation-delete-btn';
                                    delBtn.title = 'Supprimer cette annotation';
                                    delBtn.innerHTML = '&times;';
                                    delBtn.onclick = async (e) => {
                                        e.stopPropagation();
                                        annotations.splice(idx, 1);
                                        await firebase.firestore().collection('animals').doc(animalId).update({ annotations });
                                        this.displayBodyAnnotations(animalId);
                                    };
                                    li.appendChild(delBtn);
                                    ul.appendChild(li);
                                    lines.push(li);
                                });
                            }
                        }
                        // Synchronisation du survol
                        points.forEach((point, idx) => {
                            point.addEventListener('mouseenter', () => {
                                lines[idx]?.classList.add('active');
                            });
                            point.addEventListener('mouseleave', () => {
                                lines[idx]?.classList.remove('active');
                            });
                        });
                        lines.forEach((li, idx) => {
                            li.addEventListener('mouseenter', () => {
                                points[idx]?.classList.add('active');
                            });
                            li.addEventListener('mouseleave', () => {
                                points[idx]?.classList.remove('active');
                            });
                        });
                    });
                },
                async editClient(client) {
                    this.editingClient = { 
                        ...client,
                        address: client.address || '', // S'assurer que l'adresse est d√©finie
                        phone: client.phone || '', // S'assurer que le t√©l√©phone est d√©fini
                        travelTime: client.travelTime || '' // S'assurer que le temps de trajet est d√©fini
                    };
                    this.showEditClientModal = true;
                },
                async updateClient() {
                    try {
                        await db.collection('users').doc(this.editingClient.id).update({
                            firstName: this.editingClient.firstName,
                            lastName: this.editingClient.lastName,
                            email: this.editingClient.email,
                            phone: this.editingClient.phone,
                            address: this.editingClient.address,
                            travelTime: this.editingClient.travelTime || '',
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        

                        
                        this.showEditClientModal = false;
                        alert('Client modifi√© avec succ√®s');
                    } catch (error) {
                        console.error('Error updating client:', error);
                        alert('Erreur lors de la modification: ' + error.message);
                    }
                },
                async addClient() {
                    try {
                        // Validation des champs requis
                        if (!this.newClient.firstName || !this.newClient.lastName || !this.newClient.email || !this.newClient.phone || !this.newClient.address || !this.newClient.password) {
                            alert('Tous les champs obligatoires doivent √™tre remplis');
                            return;
                        }

                        // Validation du mot de passe
                        if (this.newClient.password.length < 6) {
                            alert('Le mot de passe doit contenir au moins 6 caract√®res');
                            return;
                        }

                        // Sauvegarder l'√©tat actuel de l'admin
                        const currentUser = firebase.auth().currentUser;
                        const adminEmail = currentUser ? currentUser.email : null;

                        // Cr√©er le compte Firebase Auth
                        const userCredential = await firebase.auth().createUserWithEmailAndPassword(this.newClient.email, this.newClient.password);

                        // Cr√©er le document utilisateur dans Firestore
                        await db.collection('users').doc(userCredential.user.uid).set({
                            email: this.newClient.email,
                            firstName: this.newClient.firstName,
                            lastName: this.newClient.lastName,
                            phone: this.newClient.phone,
                            address: this.newClient.address,
                            travelTime: this.newClient.travelTime || '',
                            role: 'user',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // D√©connecter imm√©diatement le compte client cr√©√©
                        await firebase.auth().signOut();

                        // Reconnecter l'admin avec ses propres identifiants
                        if (adminEmail) {
                            // Demander √† l'admin de se reconnecter
                            this.showAddClientModal = false;
                            this.showAuth = true;
                            this.error = 'Compte client cr√©√© avec succ√®s ! Veuillez vous reconnecter en tant qu\'administrateur.';
                            
                            // Sauvegarder les informations avant de r√©initialiser
                            const clientEmail = this.newClient.email;
                            const clientPassword = this.newClient.password;

                            // R√©initialiser le formulaire
                        this.newClient = {
                            firstName: '',
                            lastName: '',
                            email: '',
                            phone: '',
                            address: '',
                            travelTime: '',
                            password: ''
                        };

                            // Afficher les informations de connexion
                            alert(`Client cr√©√© avec succ√®s !\n\nEmail: ${clientEmail}\nMot de passe: ${clientPassword}\n\nCes identifiants peuvent √™tre transmis au client.\n\nVous devez maintenant vous reconnecter en tant qu'administrateur.`);
                        }
                    } catch (error) {
                        console.error('Error creating client:', error);
                        
                        // G√©rer les erreurs sp√©cifiques
                        if (error.code === 'auth/email-already-in-use') {
                            alert('Un compte avec cet email existe d√©j√†');
                        } else if (error.code === 'auth/invalid-email') {
                            alert('Format d\'email invalide');
                        } else if (error.code === 'auth/weak-password') {
                            alert('Le mot de passe est trop faible');
                        } else {
                            alert('Erreur lors de la cr√©ation du client: ' + this.translateFirebaseError(error));
                        }
                    }
                },

                async deleteClient(client) {
                    if (!confirm(`√ätes-vous s√ªr de vouloir supprimer le client ${client.firstName} ${client.lastName} ? Cette action supprimera √©galement tous ses animaux, rendez-vous ET son compte de connexion.`)) return;
                    try {
                        // Commencer une transaction batch
                        const batch = db.batch();

                        // 1. Supprimer tous les animaux du client
                        const animalsSnapshot = await db.collection('animals')
                            .where('userId', '==', client.id)
                            .get();
                        animalsSnapshot.docs.forEach(doc => {
                            batch.delete(doc.ref);
                        });

                        // 2. Supprimer tous les rendez-vous du client
                        const appointmentsSnapshot = await db.collection('appointments')
                            .where('userId', '==', client.id)
                            .get();
                        appointmentsSnapshot.docs.forEach(doc => {
                            batch.delete(doc.ref);
                        });

                        // 3. Supprimer tous les messages du client
                        const messagesSnapshot = await db.collection('contact_messages')
                            .where('userId', '==', client.id)
                            .get();
                        messagesSnapshot.docs.forEach(doc => {
                            batch.delete(doc.ref);
                        });

                        // 4. Supprimer le document utilisateur
                        batch.delete(db.collection('users').doc(client.id));

                        // Ex√©cuter toutes les op√©rations de suppression Firestore
                        await batch.commit();

                        // 5. Supprimer le compte d'authentification Firebase via Cloud Function
                        try {
                            const deleteUserFunction = firebase.functions().httpsCallable('deleteUserAccount');
                            await deleteUserFunction({ userId: client.id });
                            console.log('Compte d\'authentification supprim√© avec succ√®s');
                        } catch (authError) {
                            console.warn('Erreur lors de la suppression du compte d\'authentification:', authError);
                            // Continuer m√™me si la suppression du compte auth √©choue
                        }

                        // Mettre √† jour la liste locale des clients
                        this.allClients = this.allClients.filter(c => c.id !== client.id);
                        alert('Client et toutes ses donn√©es associ√©es supprim√©s avec succ√®s');

                        // Recharger les donn√©es pour mettre √† jour les autres listes
                        this.loadAllData();
                    } catch (error) {
                        console.error('Error deleting client:', error);
                        alert('Erreur lors de la suppression: ' + error.message);
                    }
                },
                viewClientAnimals(client) {
                    this.selectedClient = client;
                    this.clientAnimals = this.allAnimals.filter(animal => animal.userId === client.id);
                    this.showClientAnimalsModal = true;
                },
                async loadMessages() {
                    if (!this.isAdmin) return;
                    
                    if (this.unsubscribeMessages) {
                        this.unsubscribeMessages();
                    }

                    this.unsubscribeMessages = db.collection('contact_messages')
                        .orderBy('createdAt', 'desc')
                        .onSnapshot(snapshot => {
                            this.messages = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            this.unreadMessagesCount = this.messages.filter(m => m.status === 'unread').length;
                        });
                },
                async toggleMessageStatus(message) {
                    try {
                        await db.collection('contact_messages').doc(message.id).update({
                            status: message.status === 'unread' ? 'read' : 'unread'
                        });
                    } catch (error) {
                        console.error('Error updating message status:', error);
                        alert('Erreur lors de la mise √† jour du statut du message');
                    }
                },
                async deleteMessage(message) {
                    if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce message ?')) return;
                    try {
                        await db.collection('contact_messages').doc(message.id).delete();
                    } catch (error) {
                        console.error('Error deleting message:', error);
                        alert('Erreur lors de la suppression du message');
                    }
                },
                // M√©thodes pour le tutoriel
                startTutorial() {
                    this.currentTutorialStepIndex = 0;
                    this.showTutorial = true;
                    // Ouvrir le menu burger sur mobile
                    if (window.innerWidth <= 768) {
                        this.isMenuOpen = true;
                    }
                    this.highlightCurrentElement();
                },
                skipTutorial() {
                    this.showTutorial = false;
                    this.removeHighlights();
                    // Fermer le menu burger si on √©tait sur mobile
                    if (window.innerWidth <= 768) {
                        this.isMenuOpen = false;
                    }
                },
                nextTutorialStep() {
                    // Retirer les highlights pr√©c√©dents
                    this.removeHighlights();
                    
                    if (this.currentTutorialStepIndex < this.tutorialSteps.length - 1) {
                        this.currentTutorialStepIndex++;
                        
                        // Ouvrir le menu burger sur mobile pour les √©tapes concern√©es
                        if (window.innerWidth <= 768) {
                            if ([1, 2, 4].includes(this.currentTutorialStepIndex)) {
                                this.isMenuOpen = true;
                            }
                        }
                        
                        // Attendre un peu que le DOM soit mis √† jour avant de highlight
                        setTimeout(() => {
                        this.highlightCurrentElement();
                        }, 100);
                    }
                },
                highlightCurrentElement() {
                    // Retirer les highlights pr√©c√©dents
                    this.removeHighlights();
                    
                    let elementToHighlight;
                    const isMobile = window.innerWidth <= 768;
                    let retryCount = 0;
                    
                    const tryHighlight = () => {
                        // Retirer les highlights avant de chercher le nouvel √©l√©ment
                        this.removeHighlights();
                        
                        switch(this.currentTutorialStepIndex) {
                            case 0: // Bienvenue
                                // Pas de highlight
                                break;
                            case 1: // Connexion/D√©connexion
                                // Chercher d'abord le bouton de d√©connexion, puis le bouton de connexion
                                elementToHighlight = document.querySelector('.nav-logout') || document.querySelector('.nav-login');
                                break;
                            case 2: // Dossier de vos animaux
                                elementToHighlight = Array.from(document.querySelectorAll('.nav-links a')).find(a => a.textContent.includes('Dossier Animaux'));
                                break;
                            case 3: // Contacter Emmy VASSE
                                elementToHighlight = Array.from(document.querySelectorAll('.nav-links a')).find(a => a.textContent.includes('Contact'));
                                break;
                            case 4: // Prendre rendez-vous
                                elementToHighlight = Array.from(document.querySelectorAll('.nav-links a')).find(a => a.textContent.includes('Prendre RDV'));
                                break;
                            case 5: // Profil
                                elementToHighlight = Array.from(document.querySelectorAll('.nav-links a')).find(a => a.textContent.includes('Profil'));
                                break;
                        }
                        
                        if (elementToHighlight) {
                            // Ajouter le highlight avec un petit d√©lai pour s'assurer que le DOM est pr√™t
                            setTimeout(() => {
                            elementToHighlight.classList.add('tutorial-highlight');
                            if (isMobile) {
                                    elementToHighlight.scrollIntoView({
                                        behavior: 'smooth',
                                        block: 'center'
                                    });
                            }
                            }, 100);
                        } else if (retryCount < 3) {
                            retryCount++;
                            setTimeout(tryHighlight, 200);
                        } else {
                            console.warn('Aucun √©l√©ment √† surligner pour l\'√©tape du tutoriel', this.currentTutorialStepIndex);
                        }
                    };
                    
                    // D√©marrer avec un petit d√©lai pour s'assurer que le DOM est pr√™t
                    setTimeout(tryHighlight, 50);
                },
                removeHighlights() {
                    document.querySelectorAll('.tutorial-highlight').forEach(el => {
                        el.classList.remove('tutorial-highlight');
                    });
                },
                async loadBlogPosts() {
                    try {
                        if (this.unsubscribeBlogPosts) {
                            this.unsubscribeBlogPosts();
                        }

                        this.unsubscribeBlogPosts = db.collection('blog_posts')
                            .orderBy('date', 'desc')
                            .onSnapshot(snapshot => {
                                // G√©rer les modifications en temps r√©el
                                snapshot.docChanges().forEach(change => {
                                    const post = {
                                        id: change.doc.id,
                                        ...change.doc.data()
                                    };

                                    if (change.type === 'added') {
                                        // Nouveau post
                                        const index = this.blogPosts.findIndex(p => p.id === post.id);
                                        if (index === -1) {
                                            this.blogPosts.push(post);
                                        }
                                    } else if (change.type === 'modified') {
                                        // Post modifi√©
                                        const index = this.blogPosts.findIndex(p => p.id === post.id);
                                        if (index !== -1) {
                                            this.blogPosts.splice(index, 1, post);
                                        }
                                    } else if (change.type === 'removed') {
                                        // Post supprim√©
                                        const index = this.blogPosts.findIndex(p => p.id === post.id);
                                        if (index !== -1) {
                                            this.blogPosts.splice(index, 1);
                                        }
                                    }
                                });

                                // Trier les posts par date
                                this.blogPosts.sort((a, b) => b.date.seconds - a.date.seconds);
                            }, error => {
                                console.error('Error loading blog posts:', error);
                            });
                    } catch (error) {
                        console.error('Error setting up blog posts listener:', error);
                    }
                },
                async addBlogPost() {
                    try {
                        if (!this.newPost.title || !this.newPost.content) {
                            alert('Veuillez remplir tous les champs obligatoires');
                            return;
                        }

                        // V√©rifier qu'une image est s√©lectionn√©e (sauf pour la modification si l'image existe d√©j√†)
                        if (!this.newPost.imageBase64 && !this.newPost.imageUrl) {
                            alert('Veuillez s√©lectionner une image pour l\'article');
                            return;
                        }

                        const postData = {
                            title: this.newPost.title,
                            content: this.newPost.content,
                            excerpt: this.newPost.excerpt,
                            date: firebase.firestore.Timestamp.fromDate(new Date(this.newPost.date)),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        // Utiliser l'image base64 si disponible, sinon garder l'URL existante
                        if (this.newPost.imageBase64) {
                            postData.imageUrl = this.newPost.imageBase64;
                        } else if (this.newPost.imageUrl) {
                            postData.imageUrl = this.newPost.imageUrl;
                        }

                        if (this.editingPost) {
                            // Mise √† jour d'un article existant
                            await db.collection('blog_posts').doc(this.editingPost.id).update(postData);
                        } else {
                            // Cr√©ation d'un nouvel article
                            postData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                            await db.collection('blog_posts').add(postData);
                        }

                        this.showAddPostModal = false;
                        this.resetBlogForm();
                    } catch (error) {
                        console.error('Error saving blog post:', error);
                        alert('Erreur lors de l\'enregistrement de l\'article');
                    }
                },
                showPostDetails(post) {
                    const formattedContent = post.content.replace(/\n/g, '<br>');
                    const modal = document.createElement('div');
                    modal.className = 'modal blog-modal';
                    modal.innerHTML = `
                        <div class="modal-content blog-post-modal">
                            <div class="blog-post-header">
                                <h2>${post.title}</h2>
                                <div class="blog-post-date">${this.formatDate(post.date)}</div>
                            </div>
                            <img src="${post.imageUrl}" alt="${post.title}" class="blog-post-full-image">
                            <div class="blog-post-full-content">${formattedContent}</div>
                            <div class="modal-actions">
                                ${this.isAdmin ? `
                                    <button class="btn primary" onclick="this.closest('.modal').dispatchEvent(new CustomEvent('edit-post'))">Modifier</button>
                                    <button class="btn secondary" onclick="this.closest('.modal').dispatchEvent(new CustomEvent('delete-post'))">Supprimer</button>
                                ` : ''}
                                <button class="btn secondary" id="close-blog-modal">Fermer</button>
                            </div>
                        </div>
                    `;

                    // Ajouter les styles sp√©cifiques pour le modal de blog
                    const style = document.createElement('style');
                    style.textContent = `
                        .blog-post-modal {
                            max-width: 800px;
                            padding: 2rem;
                        }

                        .blog-post-header {
                            margin-bottom: 1.5rem;
                            text-align: center;
                        }

                        .blog-post-header h2 {
                            color: var(--primary-color);
                            font-family: 'Playfair Display', serif;
                            font-size: 2.5rem;
                            margin-bottom: 0.5rem;
                        }

                        .blog-post-full-image {
                            width: 100%;
                            height: 400px;
                            object-fit: cover;
                            border-radius: 15px;
                            margin-bottom: 2rem;
                            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
                        }

                        .blog-post-full-content {
                            font-size: 1.1rem;
                            line-height: 1.8;
                            color: var(--text-color);
                            margin-bottom: 2rem;
                            white-space: pre-line;
                        }

                        @media (max-width: 768px) {
                            .blog-post-modal {
                                padding: 1rem;
                            }

                            .blog-post-header h2 {
                                font-size: 2rem;
                            }

                            .blog-post-full-image {
                                height: 250px;
                            }
                        }
                    `;
                    modal.appendChild(style);

                    // Fonction pour fermer le modal proprement
                    const closeModal = () => {
                        modal.remove();
                        window.removeEventListener('keydown', escListener);
                        window.removeEventListener('popstate', popListener);
                        // Si on a ajout√© une entr√©e √† l'historique, on la retire
                        if (window.location.hash === '#blogpost') {
                            history.back();
                        }
                    };

                    // Listener pour la touche √âchap
                    const escListener = (e) => {
                        if (e.key === 'Escape') {
                            closeModal();
                        }
                    };
                    window.addEventListener('keydown', escListener);

                    // Listener pour le bouton retour du t√©l√©phone
                    const popListener = (e) => {
                        closeModal();
                    };
                    window.addEventListener('popstate', popListener);

                    // Ajoute une entr√©e √† l'historique pour g√©rer le bouton retour
                    history.pushState({ blogModal: true }, '', '#blogpost');

                    // Bouton fermer
                    modal.querySelector('#close-blog-modal').onclick = closeModal;

                    if (this.isAdmin) {
                        modal.addEventListener('edit-post', () => {
                            this.editPost(post);
                            closeModal();
                        });
                        modal.addEventListener('delete-post', () => {
                            this.deletePost(post);
                            closeModal();
                        });
                    }

                    document.body.appendChild(modal);
                },
                resetBlogForm() {
                    this.editingPost = null;
                    this.newPost = {
                        title: '',
                        content: '',
                        excerpt: '',
                        imageUrl: '',
                        imagePreview: '',
                        imageBase64: '',
                        date: new Date().toISOString().split('T')[0]
                    };
                },
                async handleBlogImageUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    // V√©rifier le type de fichier
                    if (!file.type.startsWith('image/')) {
                        alert('Le fichier doit √™tre une image');
                        event.target.value = '';
                            return;
                        }

                    // V√©rifier la taille du fichier (5MB max)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('L\'image ne doit pas d√©passer 5MB');
                        event.target.value = '';
                        return;
                    }

                    try {
                        // Cr√©er un aper√ßu de l'image
                        const reader = new FileReader();
                        reader.onload = async (e) => {
                            // Cr√©er une image pour le redimensionnement
                            const img = new Image();
                            img.onload = async () => {
                                // Cr√©er un canvas pour le redimensionnement
                                const canvas = document.createElement('canvas');
                                let width = img.width;
                                let height = img.height;
                                
                                // Calculer les nouvelles dimensions en gardant le ratio
                                const MAX_WIDTH = 800;
                                const MAX_HEIGHT = 600;
                                
                                if (width > height) {
                                    if (width > MAX_WIDTH) {
                                        height *= MAX_WIDTH / width;
                                        width = MAX_WIDTH;
                                    }
                                } else {
                                    if (height > MAX_HEIGHT) {
                                        width *= MAX_HEIGHT / height;
                                        height = MAX_HEIGHT;
                                    }
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                
                                // Dessiner l'image redimensionn√©e
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                // Convertir en base64 avec compression
                                const resizedBase64 = canvas.toDataURL('image/jpeg', 0.8);
                                
                                // V√©rifier la taille finale
                                const base64Size = resizedBase64.length * 3 / 4;
                                if (base64Size > 500000) { // ~500KB pour avoir une marge
                                    alert('L\'image est trop grande m√™me apr√®s compression. Veuillez choisir une image plus petite.');
                                    event.target.value = '';
                                    return;
                                }
                                
                                // Stocker l'image
                                this.newPost.imagePreview = resizedBase64;
                                this.newPost.imageBase64 = resizedBase64;
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } catch (error) {
                        console.error('Erreur lors du traitement de l\'image:', error);
                        alert('Erreur lors du traitement de l\'image. Veuillez r√©essayer avec une autre image.');
                        event.target.value = '';
                    }
                },
                removeBlogImage() {
                    this.newPost.imagePreview = '';
                    this.newPost.imageBase64 = '';
                    this.newPost.imageUrl = '';
                    // R√©initialiser l'input file
                    const fileInput = document.getElementById('postImage');
                    if (fileInput) {
                        fileInput.value = '';
                    }
                },
                async editPost(post) {
                    this.resetBlogForm(); // R√©initialiser d'abord
                    this.editingPost = post;
                    this.newPost = {
                        title: post.title,
                        content: post.content,
                        excerpt: post.excerpt,
                        imageUrl: post.imageUrl,
                        imagePreview: post.imageUrl, // Afficher l'image existante dans l'aper√ßu
                        imageBase64: '',
                        date: post.date.toDate().toISOString().split('T')[0]
                    };
                    this.showAddPostModal = true;

                    // Modifier la m√©thode addBlogPost pour g√©rer aussi les modifications
                    const modal = document.querySelector('.modal');
                    if (modal) {
                        modal.remove();
                    }
                },
                async deletePost(post) {
                    if (confirm('√ätes-vous s√ªr de vouloir supprimer cet article ?')) {
                        try {
                            await db.collection('blog_posts').doc(post.id).delete();
                            alert('Article supprim√© avec succ√®s');
                        } catch (error) {
                            console.error('Error deleting blog post:', error);
                            alert('Erreur lors de la suppression de l\'article');
                        }
                    }
                },
                viewAnimalDocuments(animal) {
                    if (!animal.documents || animal.documents.length === 0) return;

                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.style.zIndex = '1000';
                    modal.innerHTML = `
                        <div class="modal-content documents-modal">
                            <h2>Documents de ${animal.name}</h2>
                            <div class="documents-grid">
                                ${animal.documents.map(doc => `
                                    <div class="document-card" onclick="this.dispatchEvent(new CustomEvent('view-document', {detail: '${doc.id}', bubbles: true}))">
                                        <img src="${doc.data}" alt="${doc.name}">
                                        <div class="document-info">
                                            <p class="document-name">${doc.name}</p>
                                            <p class="document-date">${this.formatDate(doc.date)}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="modal-actions">
                                <button class="btn secondary" onclick="this.closest('.modal').remove()">Fermer</button>
                            </div>
                        </div>
                    `;

                    // Ajouter les styles sp√©cifiques pour la modal des documents
                    const style = document.createElement('style');
                    style.textContent = `
                        .documents-modal {
                            max-width: 900px;
                            padding: 2rem;
                            z-index: 1000;
                        }

                        .documents-modal h2 {
                            color: var(--primary-color);
                            font-family: 'Playfair Display', serif;
                            text-align: center;
                            margin-bottom: 2rem;
                        }

                        .documents-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fill, minmax(250px, 300px));
                            gap: 1.5rem;
                            margin-bottom: 2rem;
                            justify-content: center;
                        }

                        .document-card {
                            background: white;
                            border-radius: 12px;
                            overflow: hidden;
                            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                            cursor: pointer;
                            transition: transform 0.3s ease;
                        }

                        .document-card:hover {
                            transform: translateY(-5px);
                            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
                        }

                        .document-card img {
                            width: 100%;
                            height: 200px;
                            object-fit: cover;
                        }

                        .document-info {
                            padding: 1rem;
                        }

                        .document-name {
                            color: var(--primary-color);
                            font-weight: 500;
                            margin-bottom: 0.5rem;
                        }

                        .document-date {
                            color: var(--secondary-color);
                            font-size: 0.9rem;
                        }

                        @media (max-width: 768px) {
                            .documents-modal {
                                padding: 1rem;
                                margin: 1rem;
                                width: calc(100% - 2rem);
                            }

                            .documents-grid {
                                grid-template-columns: 1fr;
                                gap: 1rem;
                            }
                        }
                    `;
                    modal.appendChild(style);

                    // Gestion de l'affichage en plein √©cran des documents
                    modal.addEventListener('view-document', (e) => {
                        const documentId = e.detail;
                        const selectedDoc = animal.documents.find(doc => doc.id === documentId);
                        if (selectedDoc) {
                            const fullscreenModal = window.document.createElement('div');
                            fullscreenModal.className = 'modal';
                            fullscreenModal.style.cssText = 'z-index: 1001; display: flex; align-items: flex-start; justify-content: center; padding: 100px 20px 20px 20px; overflow-y: auto;';
                            fullscreenModal.innerHTML = `
                                <div class="modal-content" style="max-width: 90vw; max-height: calc(100vh - 140px); overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 1.5rem; position: relative;">
                                    <div style="position: relative;">
                                        <div style="display: flex; justify-content: center; min-height: 200px; max-height: calc(90vh - 100px); overflow-y: auto;">
                                            <img src="${selectedDoc.data}" alt="${selectedDoc.name}" style="width: auto; max-width: 100%; height: auto; object-fit: contain;">
                                        </div>
                                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                                            <h3 style="margin: 0; color: var(--primary-color);">${selectedDoc.name}</h3>
                                            <p style="margin: 0.5rem 0 0 0; color: var(--secondary-color);">Ajout√© le ${this.formatDate(selectedDoc.date)}</p>
                                        </div>
                                        <button class="btn secondary" style="position: absolute; top: -10px; right: -10px; border-radius: 50%; width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);" onclick="this.closest('.modal').remove()">√ó</button>
                                    </div>
                                </div>
                            `;
                            window.document.body.appendChild(fullscreenModal);

                            // Fermer avec √âchap
                            const handleEscape = (event) => {
                                if (event.key === 'Escape') {
                                    fullscreenModal.remove();
                                    window.removeEventListener('keydown', handleEscape);
                                }
                            };
                            window.addEventListener('keydown', handleEscape);

                            // Fermer en cliquant en dehors
                            fullscreenModal.addEventListener('click', (event) => {
                                if (event.target === fullscreenModal) {
                                    fullscreenModal.remove();
                                    window.removeEventListener('keydown', handleEscape);
                                }
                            });
                        }
                    });

                    document.body.appendChild(modal);

                    // Gestion de la fermeture avec √âchap
                    const handleEscape = (e) => {
                        if (e.key === 'Escape') {
                            modal.remove();
                            window.removeEventListener('keydown', handleEscape);
                        }
                    };
                    window.addEventListener('keydown', handleEscape);
                },
                sortAppointments(field) {
                    if (this.sortField === field) {
                        this.sortOrder = this.sortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        this.sortField = field;
                        this.sortOrder = 'asc';
                    }
                },
                async submitAdminAppointment() {
                    try {
                        if (!this.adminAppointmentForm.userId || !this.adminAppointmentForm.selectedAnimalId || !this.adminAppointmentForm.phone || !this.adminAppointmentForm.date || !this.adminAppointmentForm.time) {
                            alert('Veuillez remplir tous les champs obligatoires');
                            return;
                        }

                        const appointmentData = {
                            userId: this.adminAppointmentForm.userId,
                            selectedAnimalId: this.adminAppointmentForm.selectedAnimalId,
                            phone: this.adminAppointmentForm.phone,
                            date: this.adminAppointmentForm.date,
                            time: this.adminAppointmentForm.time,
                            notes: this.adminAppointmentForm.notes,
                            status: 'pending',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        const appointmentRef = await db.collection('appointments').add(appointmentData);

                        // Mettre √† jour l'historique de l'animal
                        const animalRef = db.collection('animals').doc(this.adminAppointmentForm.selectedAnimalId);
                        await animalRef.update({
                            appointments: firebase.firestore.FieldValue.arrayUnion({
                                id: appointmentRef.id,
                                date: this.adminAppointmentForm.date,
                                time: this.adminAppointmentForm.time,
                                notes: this.adminAppointmentForm.notes,
                                status: 'pending'
                            })
                        });

                        this.showAdminNewAppointmentModal = false;
                        this.adminAppointmentForm = {
                            userId: '',
                            selectedAnimalId: '',
                            phone: '',
                            date: '',
                            time: '',
                            notes: ''
                        };
                        alert('Rendez-vous ajout√© avec succ√®s');
                    } catch (error) {
                        console.error('Error submitting admin appointment:', error);
                        alert('Erreur lors de l\'ajout du rendez-vous');
                    }
                },
                cancelAdminAppointment() {
                    this.showAdminNewAppointmentModal = false;
                    this.adminAppointmentForm = {
                        userId: '',
                        selectedAnimalId: '',
                        phone: '',
                        date: '',
                        time: '',
                        notes: ''
                    };
                },
                loadClientAnimals() {
                    this.clientAnimals = this.allAnimals.filter(animal => animal.userId === this.adminAppointmentForm.userId);
                },
                switchToSlotsTab() {
                    this.adminActiveTab = 'slots';
                    // Forcer le rechargement des cr√©neaux
                    setTimeout(() => {
                        this.loadSlots();
                    }, 100);
                },
                switchAdminTab(tab) {
                    this.adminActiveTab = tab;
                    // R√©initialiser les recherches lors du changement d'onglet
                    this.animalsSearch = '';
                    this.appointmentsSearch = '';
                    this.clientsSearch = '';
                    this.messagesSearch = '';
                },
                // Fonction pour le d√©filement fluide vers les sections
                smoothScrollTo(targetId) {
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        // Utiliser scrollIntoView avec des options plus pr√©cises
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start',
                            inline: 'nearest'
                        });
                        
                        // Fermer le menu mobile si ouvert
                        this.isMenuOpen = false;
                    }
                },
                
                // Fonction pour naviguer vers une section (g√®re le changement de page si n√©cessaire)
                navigateToSection(sectionId) {
                    // Si on n'est pas sur la page d'accueil, d'abord y aller
                    if (this.currentPage !== 'home') {
                        this.currentPage = 'home';
                        // Mettre √† jour l'URL pour refl√©ter la navigation vers la section
                        window.location.hash = sectionId;
                        // Attendre que la page soit charg√©e avant de faire le scroll
                        this.$nextTick(() => {
                            setTimeout(() => {
                                this.smoothScrollTo(sectionId);
                            }, 100);
                        });
                    } else {
                        // Si on est d√©j√† sur la page d'accueil, faire le scroll directement
                        window.location.hash = sectionId;
                        this.smoothScrollTo(sectionId);
                    }
                },
            },
            mounted() {
                // Gestion de la navigation par hash
                const handleHashChange = () => {
                    const hash = window.location.hash.slice(1);
                    
                    // Si l'utilisateur n'est pas connect√©, il ne peut acc√©der qu'√† la page d'accueil et ses sections
                    if (!this.isAuthenticated && (hash === 'appointment' || hash === 'dossier' || hash === 'admin' || hash === 'profile')) {
                        window.location.hash = '';
                        this.currentPage = 'home';
                        return;
                    }

                    // Si l'utilisateur n'est pas admin, il ne peut pas acc√©der √† la page admin
                    if (hash === 'admin' && !this.isAdmin) {
                        window.location.hash = '';
                        this.currentPage = 'home';
                        return;
                    }

                    // Gestion des pages sp√©cifiques
                    switch(hash) {
                        case 'appointment':
                            this.currentPage = 'appointment';
                            if (this.isAuthenticated) {
                                this.loadAnimals();
                                this.syncTimeSlots();
                                this.loadAvailableDates();
                            }
                            break;
                        case 'dossier':
                            this.currentPage = 'dossier';
                            if (this.isAuthenticated) {
                                this.loadAnimals();
                            }
                            break;
                        case 'admin':
                            if (this.isAdmin) {
                                this.currentPage = 'admin';
                                this.loadAllData();
                                setTimeout(() => {
                                    this.loadSlots();
                                }, 100);
                                this.loadAvailableDates();
                            }
                            break;
                        case 'profile':
                            if (this.isAuthenticated) {
                                this.currentPage = 'profile';
                                this.loadProfileData();
                            }
                            break;
                        case 'chien':
                        case 'chat':
                        case 'cheval':
                        case 'nac':
                        case 'bovins':
                            this.currentPage = hash;
                            break;
                        default:
                            this.currentPage = 'home';
                            const element = document.getElementById(hash);
                            if (element) {
                                element.scrollIntoView({ behavior: 'smooth' });
                            }
                    }
                };

                window.addEventListener('hashchange', handleHashChange);
                handleHashChange();

                // D√©marrer le d√©filement automatique du carrousel
                this.startCarouselAutoPlay();

                // √âcouteur d'authentification Firebase
                firebase.auth().onAuthStateChanged(async (user) => {
                    if (user) {
                        this.isAuthenticated = true;
                        this.userEmail = user.email;
                        await this.checkAdminStatus();
                        
                        // Charger les animaux d√®s la connexion
                        await this.loadAnimals();
                        
                        // Si on est sur la page de rendez-vous, charger les donn√©es n√©cessaires
                        if (this.currentPage === 'appointment') {
                            await this.loadAvailableDates();
                            // Attendre un peu avant de synchroniser
                            setTimeout(() => {
                                this.syncTimeSlots();
                            }, 500);
                        } else if (this.currentPage === 'admin' && this.isAdmin) {
                            await this.loadAllData();
                            setTimeout(() => {
                                this.loadSlots();
                            }, 100);
                            await this.loadAvailableDates();
                        }
                    } else {
                        if (this.unsubscribeAnimals) {
                            this.unsubscribeAnimals();
                        }
                        this.isAuthenticated = false;
                        this.isAdmin = false;
                        this.userEmail = '';
                        this.travelTime = '';
                        this.animals = [];
                        if (window.location.hash === '#appointment' || window.location.hash === '#dossier' || window.location.hash === '#admin' || window.location.hash === '#profile') {
                            window.location.hash = '';
                            this.currentPage = 'home';
                        }
                    }
                });

                // Gestion du responsive et du zoom
                const checkZoomAndResponsive = () => {
                    this.isMobile = window.innerWidth <= 768;
                    
                    // D√©tecter le niveau de zoom de mani√®re plus pr√©cise
                    const zoomLevel = window.outerWidth / window.innerWidth;
                    const navContainer = document.querySelector('.nav-container');
                    
                    if (navContainer) {
                        // Activer le menu burger quand le zoom d√©passe 110% (1.1)
                        if (zoomLevel > 1.1 && window.innerWidth > 768) {
                            navContainer.classList.add('nav-zoomed');
                        } else {
                            navContainer.classList.remove('nav-zoomed');
                        }
                    }
                };
                
                window.addEventListener('resize', checkZoomAndResponsive);
                window.addEventListener('load', checkZoomAndResponsive);
                checkZoomAndResponsive();

                this.loadBlogPosts();
                
                // Si on est d√©j√† sur l'onglet Cr√©neaux, charger les cr√©neaux
                if (this.currentPage === 'admin' && this.adminActiveTab === 'slots' && this.isAdmin) {
                    setTimeout(() => {
                        this.loadSlots();
                    }, 500);
                }
            },
            beforeUnmount() {
                // Nettoyer tous les √©couteurs en temps r√©el
                if (this.unsubscribeAnimals) {
                    this.unsubscribeAnimals();
                }
                if (this.unsubscribeSlots) {
                    this.unsubscribeSlots();
                }
                if (this.unsubscribeAppointments) {
                    this.unsubscribeAppointments();
                }
                        if (this.unsubscribeAdminSlots) {
                            this.unsubscribeAdminSlots();
                }
                if (this.unsubscribeAvailableDates) {
                    this.unsubscribeAvailableDates();
                }
                if (this.unsubscribeMessages) {
                    this.unsubscribeMessages();
                }
                if (this.unsubscribeBlogPosts) {
                    this.unsubscribeBlogPosts();
                }
                if (this.unsubscribeAdminAnimals) {
                    this.unsubscribeAdminAnimals();
                }
                // Arr√™ter le d√©filement automatique du carrousel
                this.stopCarouselAutoPlay();
            }
        }).mount('#app')

        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission().then(function(permission) {
                console.log('Notification permission:', permission);
            });
        }
    </script>
</body>
</html> 